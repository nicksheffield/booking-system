<page-header text="All Bookings">
	<div class="btn-group">
		<button class="btn btn-primary btn-icon btn-sm" ng-click="advFilter.toggleOpen()">
			<i class="fa fa-filter"></i>
			Filter
		</button>
		<button type="button" class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			<span class="sr-only">Toggle Dropdown</span>
		</button>
		<div class="dropdown-menu dropdown-menu-right">
			<span class="dropdown-item btn-icon" ng-click="advFilter.clear()">
				<i class="fa fa-undo"></i>
				Reset
			</span>
		</div>
	</div>
</page-header>

<div class="page-advanced-filter" ng-class="{'filter-open': advFilter.open}" ng-show="advFilter.open">

	<div class="filter-drawer">

		<div layout="row" justify="between" class="pad-down">
			<h2>Filter</h2>

			<btn type="success" icon="check" ng-click="advFilter.apply()" ng-show="advFilter.open">Apply</btn>
		</div>

		<div layout="col">
			<div layout="row" ratio="1">
				<label class="item checkbox-item">
					<input type="checkbox" ng-model="advFilter.props.overdue"> Show overdue
				</label>
				<label class="item checkbox-item">
					<input type="checkbox" ng-model="advFilter.props.closed"> Show closed
				</label>
				<label class="item checkbox-item">
					<input type="checkbox" ng-model="advFilter.props.issued"> Show issued
				</label>
				<label class="item checkbox-item">
					<input type="checkbox" ng-model="advFilter.props.booked"> Show booked
				</label>
			</div>

			<div layout="row" ratio="1">
				<div class="item">
					<label>After</label>
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">
							<i class="fa fa-calendar"></i>
						</span>
						<input type="date" ng-model="advFilter.props.after" class="form-control">
					</div>
				</div>
				<div class="item">
					<label>Before</label>
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">
							<i class="fa fa-calendar"></i>
						</span>
						<input type="date" ng-model="advFilter.props.before" class="form-control">
					</div>
				</div>
			</div>
			<div layout="row">
				<div class="item has-select-clearer" ratio="1">
					<label>User</label>
					<ui-select select-unit-on-close select-dark ng-model="advFilter.props.user">
						<ui-select-match allow-clear="false" placeholder="â€‹">
							<span ng-bind="$select.selected.name" class="setheight"></span>
						</ui-select-match>
						<ui-select-choices repeat="user in (users | filter: $select.search)">
							<div ng-bind-html="user.name | highlight: $select.search"></div>
							<small ng-bind-html="user.group.code | highlight: $select.search"></small>
						</ui-select-choices>
					</ui-select>
					<button class="close" ng-click="advFilter.clearUser()" ng-show="advFilter.props.user">
						<i class="fa fa-times-circle"></i>
					</button>
				</div>

				<div class="item" ratio="1">
					<label>Limit</label>
					<!-- <input type="number" ng-model="advFilter.props.limit" class="form-control"> -->
					<div layout="row">
						<input type="range" class="form-control" ng-model="advFilter.props.limit" step="15" min="10" max="100">
						<output>{{ advFilter.props.limit }}</output>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="page-content">
		
	<pager current="page" limit="advFilter.props.limit" data="bookings" filtered="filtered" filter="filter" ng-show="!filter && bookings.length >= advFilter.props.limit && !loading"></pager>

	<div ng-show="bookings.length && !loading">
		<a ng-repeat="booking in bookings | page: page : advFilter.props.limit : 30 as filtered" href="booking/{{ booking.id }}" class="booking filterable-row list-item" layout="row sm-col" align="center sm-stretch">
			<div class="col-username filterable-cell" ratio="1">
				<div class="title">User</div>
				<div class="content">{{ booking.user.name }}</div>
			</div>
			<div class="col-groupcode filterable-cell" ratio="1">
				<div class="title">Class</div>
				<div class="content">{{ booking.user.group.code }}</div>
			</div>
			<div class="col-status status-{{ booking._status.toLowerCase() }}" ratio="1">
				<div class="title">Status</div>
				<div class="content">
					{{ booking._status }}
				</div>
			</div>
			<div class="col-status2" ratio="1" ng-show="booking._overdue && booking._priority == 2">
				<div class="title">
					Late by
				</div>
				<div class="content" ng-class="{late: booking._overdue && booking._priority == 2}">
					{{ booking._timeoverdue + (booking._timeoverdue == 1 ? ' day' : ' days') }}
					<span ng-show="booking._priority == 3"> ago</span>
				</div>
			</div>
			<div class="col-status2" ratio="1" ng-show="!booking._overdue && booking._priority == 2">
				<div class="title">
					Due at
				</div>
				<div class="content">
					{{ timediff(booking.due_at, 'days') }} days
				</div>
			</div>
			<div class="col-status2" ratio="1" ng-show="booking._priority == 1">
				<div class="title">
					Pickup in
				</div>
				<div class="content">
					{{ timediff(booking.pickup_at, 'days') }} days
				</div>
			</div>
			<div class="col-status2" ratio="1" ng-show="booking._priority == 3">
				<div class="title">
					Closed
				</div>
				<div class="content">
					{{ timediff(booking.closed_at, 'days') }} days ago
				</div>
			</div>
			<!-- <div class="col-buttons button-row" layout="row" justify="end" ratio="3">
				<btn url="booking/{{ booking.id }}" type="info" icon="arrow-right" small>View</btn>
			</div> -->
		</a>
	</div>

	<div ng-show="!bookings.length && !loading">
		<alert type="danger" icon="exclamation-triangle" text="No bookings match your filter critera"></alert>
	</div>
		
	<pager current="page" limit="advFilter.props.limit" data="bookings" filtered="filtered" filter="filter" ng-show="!filter && bookings.length >= 30 && !loading"></pager>

	<div class="loading" ng-show="loading" layout="row" justify="center">
		<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>
	</div>
	
</div>