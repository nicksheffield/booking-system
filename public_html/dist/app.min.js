'use strict';

angular.module('app.controllers', []);
angular.module('app.directives', []);
angular.module('app.resources', []);
angular.module('app.services', []);
angular.module('app.filters', []);
angular.module('app.routes', []);
angular.module('app.views', []);
angular.module('app.auth', []);

angular.module('app', ['ngResource', 'ngSanitize', 'ngIdle', 'ui.router', 'ui.tinymce', 'satellizer', '19degrees.ngSweetAlert2', 'app.controllers', 'app.directives', 'app.resources', 'app.services', 'app.filters', 'app.routes', 'app.views', 'app.auth']);

console.log('version:', 0.7);
'use strict';

angular.module('app.auth').config(["$authProvider", function ($authProvider) {
	$authProvider.loginUrl = '/api/auth';
}]).run(["$rootScope", "$q", "$state", "$auth", "$store", "$load", "$invalidate", "$location", "$title", "$pretend", function ($rootScope, $q, $state, $auth, $store, $load, $invalidate, $location, $title, $pretend) {
	$rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {
		event.preventDefault();

		if (toState.data && toState.data.title) {
			$title(toState.data.title);
		}

		// if($store.user && $store.user.new_user && toState.url !== '/set_password') {
		// 	console.log('no!')
		// 	$location.path('/set_password')
		// 	return
		// }

		$rootScope.bodyClass = 'page-' + toState.name;

		var invalids = $invalidate.load();

		if (invalids.length) invalids.push($pretend.wait(1000));
		// invalids.push($pretend.wait(1000))

		$rootScope.loader = true;

		$q.all(invalids).then(function () {
			var conditions = toState.data && toState.data.conditions ? toState.data.conditions : [];

			var redirectTo = null;

			conditions.forEach(function (c) {
				if (c == 'auth') {
					if (!$auth.isAuthenticated()) {
						redirectTo = 'login';
					}
				}

				if (c == 'guest_only') {
					if ($auth.isAuthenticated()) {
						redirectTo = 'home';
					}
				}

				if (c == 'manager_only') {
					if (!$auth.isAuthenticated()) {
						redirectTo = 'login';
					} else {
						if ($auth.getPayload().admin !== 2) {
							redirectTo = 'home';
						}
					}
				}

				if (c == 'staff_only') {
					if (!$auth.isAuthenticated()) {
						redirectTo = 'login';
					} else {
						if (!$auth.getPayload().admin) {
							redirectTo = 'home';
						}
					}
				}

				if (c == 'student_only') {
					if (!$auth.isAuthenticated()) {
						redirectTo = 'login';
					} else {
						if ($auth.getPayload().admin) {
							redirectTo = 'home';
						}
					}
				}
			});

			if (redirectTo) {
				console.log('kicked to', redirectTo);

				$rootScope.loader = false;
				$location.path(redirectTo);
			}

			if (!redirectTo) {

				// https://github.com/angular-ui/ui-router/issues/1158
				$state.go(toState.name, toParams, { notify: false }).then(function () {
					$rootScope.loader = false;
					$rootScope.$broadcast('$stateChangeSuccess', toState, toParams, fromState, fromParams);
				});
			}
		});
	});
}]);
'use strict';

angular.module('app.routes').config(["$stateProvider", "$urlRouterProvider", "$locationProvider", function ($stateProvider, $urlRouterProvider, $locationProvider) {

	$locationProvider.hashPrefix('');
	$locationProvider.html5Mode(true);

	$urlRouterProvider.otherwise('/');

	var states = {

		// ------------------------------------------------------------
		// Home
		// ------------------------------------------------------------

		'home': {
			url: '/',
			templateUrl: 'pages/misc/home/home.html',
			controller: 'homeCtrl',
			data: {
				conditions: ['auth'],
				title: 'Home'
			}
		},

		'edit_profile': {
			url: '/home/edit-profile',
			templateUrl: 'pages/manage/users/edit/edit.html',
			controller: 'userEditCtrl',
			data: {
				conditions: ['auth'],
				title: 'Edit Profile',
				edit_profile: true
			}
		},

		'set_password': {
			url: '/set_password',
			templateUrl: 'pages/manage/users/password/password.html',
			controller: 'userPasswordCtrl',
			data: {
				conditions: ['auth'],
				title: 'Set Password'
			}
		},

		// ------------------------------------------------------------
		// Guest
		// ------------------------------------------------------------

		'login': {
			url: '/login',
			templateUrl: 'pages/misc/login/login.html',
			controller: 'loginCtrl',
			data: {
				conditions: ['guest_only'],
				title: 'Login'
			}
		},

		'logout': {
			url: '/logout',
			controller: ['$auth', '$location', '$store', '$http', function ($auth, $location, $store, $http) {
				$auth.logout().then(function () {
					$store.user = {};
					$store.resetBooking();
					$http.get('/api/logout');
					$location.path('login');
				});
			}]
		},

		'reset_password': {
			url: '/reset-password',
			templateUrl: 'pages/misc/reset/reset.html',
			controller: 'resetCtrl',
			data: {
				conditions: ['guest_only'],
				title: 'Reset Password'
			}
		},

		// ------------------------------------------------------------
		// Manager only
		// ------------------------------------------------------------

		'site_settings': {
			url: '/site-settings',
			templateUrl: 'pages/misc/site-settings/site-settings.html',
			controller: 'siteSettingsCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				title: 'Site Settings'
			}
		},

		// ------------------------------------------------------------
		// Booking
		// ------------------------------------------------------------

		'make_booking': {
			url: '/book',
			templateUrl: 'pages/booking/make/make.html',
			controller: 'makeCtrl',
			data: {
				conditions: ['auth'],
				title: 'Book Equipment'
			}
		},

		'confirm_booking': {
			url: '/book/confirm',
			templateUrl: 'pages/booking/confirm/confirm.html',
			controller: 'confirmCtrl',
			data: {
				conditions: ['auth'],
				title: 'Confirm booking',
				crumb_parent: 'make_booking'
			}
		},

		'success_booking': {
			url: '/book/success',
			templateUrl: 'pages/booking/success/success.html',
			controller: 'successCtrl',
			data: {
				conditions: ['auth'],
				title: 'Booking Made'
			}
		},

		'manage_bookings': {
			url: '/bookings?user&group&after&before&closed&returned&booked&issued&overdue&limit&page',
			templateUrl: 'pages/booking/manage/manage.html',
			controller: 'bookingsManageCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'All Bookings'
			}
		},

		'view_booking': {
			url: '/booking/:id',
			templateUrl: 'pages/booking/view/view.html',
			controller: 'viewBookingCtrl',
			data: {
				conditions: ['auth'],
				title: 'View Booking',
				crumb_parent: 'manage_bookings'
			}
		},

		'issue_booking': {
			url: '/booking/:id/issue',
			templateUrl: 'pages/booking/issue/issue.html',
			controller: 'issueCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'Issue Equipment',
				crumb_parent: 'view_booking'
			}
		},

		'return_booking': {
			url: '/booking/:id/return',
			templateUrl: 'pages/booking/return/return.html',
			controller: 'returnCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'Return Equipment',
				crumb_parent: 'view_booking'
			}
		},

		'edit_booking': {
			url: '/booking/:id/edit',
			templateUrl: 'pages/booking/edit/edit.html',
			controller: 'editBookingCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'Edit Booking',
				crumb_parent: 'view_booking'
			}
		},

		// ------------------------------------------------------------
		// Manage
		// ------------------------------------------------------------

		'manage': {
			url: '/manage',
			templateUrl: 'pages//manage/manage.html',
			controller: 'manageCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'Manage'
			}
		},

		// ------------------------------------------------------------
		// Manage Users
		// ------------------------------------------------------------

		'manage_users': {
			url: '/user',
			templateUrl: 'pages/manage/users/manage/manage.html',
			controller: 'userManageCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				title: 'All Users'
			}
		},

		'new_user': {
			url: '/user/new?class',
			templateUrl: 'pages/manage/users/new/new.html',
			controller: 'userNewCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_users',
				title: 'New User'
			}
		},

		'import_users': {
			url: '/user/import',
			templateUrl: 'pages/manage/users/import/import.html',
			controller: 'userImportCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_users',
				title: 'Import Users'
			}
		},

		'export_users': {
			url: '/user/export',
			templateUrl: 'pages/manage/users/export/export.html',
			controller: 'userExportCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_users',
				title: 'Export Users'
			}
		},

		'view_user': {
			url: '/user/:id',
			templateUrl: 'pages/manage/users/view/view.html',
			controller: 'userViewCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_users',
				title: 'View User'
			}
		},

		'edit_user': {
			url: '/user/:id/edit',
			templateUrl: 'pages/manage/users/edit/edit.html',
			controller: 'userEditCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'view_user',
				title: 'Edit User'
			}
		},

		'new_note': {
			url: '/user/:id/note/new',
			templateUrl: 'pages/manage/users/new_note/new_note.html',
			controller: 'userNewNoteCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'view_user',
				title: 'New Note'
			}
		},

		'view_note': {
			url: '/user/:id/note/:id2',
			templateUrl: 'pages/manage/users/view_note/view_note.html',
			controller: 'userViewNoteCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'view_user',
				title: 'View Note'
			}
		},

		'edit_note': {
			url: '/user/:id/note/:id2/edit',
			templateUrl: 'pages/manage/users/edit_note/edit_note.html',
			controller: 'userEditNoteCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'view_user',
				title: 'Edit Note'
			}
		},

		// ------------------------------------------------------------
		// Manage Class Types
		// ------------------------------------------------------------

		'manage_class_types': {
			url: '/class-type',
			templateUrl: 'pages/manage/class-types/manage/manage.html',
			controller: 'classTypeManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_class',
				title: 'All Class Types'
			}
		},

		'new_class_type': {
			url: '/class-type/new',
			templateUrl: 'pages/manage/class-types/new/new.html',
			controller: 'classTypeNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_class_types',
				title: 'New Class Type'
			}
		},

		'view_class_type': {
			url: '/class-type/:id',
			templateUrl: 'pages/manage/class-types/view/view.html',
			controller: 'classTypeViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_class_types',
				title: 'View Class Type'
			}
		},

		'edit_class_type': {
			url: '/class-type/:id/edit',
			templateUrl: 'pages/manage/class-types/edit/edit.html',
			controller: 'classTypeEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_class_type',
				title: 'Edit Class Type'
			}
		},

		'allow_products_for_class_type': {
			url: '/class-type/:id/products',
			templateUrl: 'pages/manage/class-types/allowed_products/allowed_products.html',
			controller: 'classTypeProductCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_class_type',
				title: 'Allow Products'
			}
		},

		// ------------------------------------------------------------
		// Manage Classes
		// ------------------------------------------------------------

		'manage_class': {
			url: '/class',
			templateUrl: 'pages/manage/classes/manage/manage.html',
			controller: 'classManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				title: 'All Classes'
			}
		},

		'new_class': {
			url: '/class/new?type&code',
			templateUrl: 'pages/manage/classes/new/new.html',
			controller: 'classNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_class',
				title: 'New Class'
			}
		},

		'view_class': {
			url: '/class/:id',
			templateUrl: 'pages/manage/classes/view/view.html',
			controller: 'classViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_class',
				title: 'View Class'
			}
		},

		'edit_class': {
			url: '/class/:id/edit',
			templateUrl: 'pages/manage/classes/edit/edit.html',
			controller: 'classEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_class',
				title: 'Edit Class'
			}
		},

		// ------------------------------------------------------------
		// Manage Product Types
		// ------------------------------------------------------------

		'manage_product_type': {
			url: '/product-type',
			templateUrl: 'pages/manage/product-types/manage/manage.html',
			controller: 'productTypeManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_product',
				title: 'All Product Types'
			}
		},

		'new_product_type': {
			url: '/product-type/new',
			templateUrl: 'pages/manage/product-types/new/new.html',
			controller: 'productTypeNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_product_type',
				title: 'New Product Type'
			}
		},

		'view_product_type': {
			url: '/product-type/:id',
			templateUrl: 'pages/manage/product-types/view/view.html',
			controller: 'productTypeViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_product_type',
				title: 'View Product Type'
			}
		},

		'edit_product_type': {
			url: '/product-type/:id/edit',
			templateUrl: 'pages/manage/product-types/edit/edit.html',
			controller: 'productTypeEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_product_type',
				title: 'Edit Product Type'
			}
		},

		// ------------------------------------------------------------
		// Manage Products
		// ------------------------------------------------------------

		'manage_product': {
			url: '/product',
			templateUrl: 'pages/manage/products/manage/manage.html',
			controller: 'productManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				title: 'All Products'
			}
		},

		'new_product': {
			url: '/product/new?type&name',
			templateUrl: 'pages/manage/products/new/new.html',
			controller: 'productNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_product',
				title: 'New Product'
			}
		},

		'view_product': {
			url: '/product/:id',
			templateUrl: 'pages/manage/products/view/view.html',
			controller: 'productViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_product',
				title: 'View Product'
			}
		},

		'edit_product': {
			url: '/product/:id/edit',
			templateUrl: 'pages/manage/products/edit/edit.html',
			controller: 'productEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_product',
				title: 'Edit Product'
			}
		},

		// ------------------------------------------------------------
		// Manage Units
		// ------------------------------------------------------------

		'manage_unit': {
			url: '/unit',
			templateUrl: 'pages/manage/units/manage/manage.html',
			controller: 'unitManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				title: 'All Units'
			}
		},

		'new_unit': {
			url: '/unit/new?product',
			templateUrl: 'pages/manage/units/new/new.html',
			controller: 'unitNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_unit',
				title: 'New Unit'
			}
		},

		'import_units': {
			url: '/unit/import',
			templateUrl: 'pages/manage/units/import/import.html',
			controller: 'unitImportCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_units',
				title: 'Import Units'
			}
		},

		'export_units': {
			url: '/unit/export',
			templateUrl: 'pages/manage/units/export/export.html',
			controller: 'unitExportCtrl',
			data: {
				conditions: ['auth', 'staff_only'],
				crumb_parent: 'manage_units',
				title: 'Export Units'
			}
		},

		'view_unit': {
			url: '/unit/:id',
			templateUrl: 'pages/manage/units/view/view.html',
			controller: 'unitViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_unit',
				title: 'View Unit'
			}
		},

		'edit_unit': {
			url: '/unit/:id/edit',
			templateUrl: 'pages/manage/units/edit/edit.html',
			controller: 'unitEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_unit',
				title: 'Edit Unit'
			}
		},

		// ------------------------------------------------------------
		// Manage Units
		// ------------------------------------------------------------

		'manage_kit': {
			url: '/kit',
			templateUrl: 'pages/manage/kits/manage/manage.html',
			controller: 'kitManageCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				title: 'All Kits'
			}
		},

		'new_kit': {
			url: '/kit/new?product',
			templateUrl: 'pages/manage/kits/new/new.html',
			controller: 'kitNewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_kit',
				title: 'New Kit'
			}
		},

		'view_kit': {
			url: '/kit/:id',
			templateUrl: 'pages/manage/kits/view/view.html',
			controller: 'kitViewCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'manage_kit',
				title: 'View Kit'
			}
		},

		'edit_kit': {
			url: '/kit/:id/edit',
			templateUrl: 'pages/manage/kits/edit/edit.html',
			controller: 'kitEditCtrl',
			data: {
				conditions: ['auth', 'manager_only'],
				crumb_parent: 'view_kit',
				title: 'Edit Kit'
			}
		}
	};

	for (var stateName in states) {
		var state = states[stateName];

		if (state.data && state.data.crumb_parent) {
			state.data.crumb_parent = states[state.data.crumb_parent];
		}

		$stateProvider.state(stateName, state);
	}
}]);
'use strict';

angular.module('app.directives').directive('alert', function () {
	return {
		restrict: 'E',
		replace: true,
		transclude: true,
		templateUrl: 'directives/alert/alert.html',
		scope: {
			type: '@',
			text: '@',
			icon: '@'
		}
	};
});
'use strict';

angular.module('app.directives').directive('boxChecker', function () {
	function link(scope, el, attrs) {
		el.on('mouseover', function (e) {
			if (boxChecker.mousedown && boxChecker.shift) {
				scope.boxChecker = boxChecker.setState;
				scope.$apply();
			}
		}).on('mousedown', function (e) {
			boxChecker.setState = !scope.boxChecker;
			boxChecker.mousedown = true;
			scope.boxChecker = boxChecker.setState;
			scope.$apply();
		}).on('click', function (e) {
			return e.preventDefault();
		}).on('mouseup', function () {
			return boxChecker.mousedown = false;
		});
	}

	return {
		restrict: 'A',
		link: link,
		scope: {
			'boxChecker': '='
		}
	};
});

var boxChecker = {
	mousedown: false,
	setState: false
};

$(document).on('mouseup', function () {
	boxChecker.mousedown = false;
}).on('keydown', function (e) {
	if (e.which == 16) {
		boxChecker.shift = true;
	}
}).on('keyup', function (e) {
	if (e.which == 16) {
		boxChecker.shift = false;
	}
});
'use strict';

angular.module('app.directives').directive('breadcrumbs', ["$state", "$location", "$stateParams", function ($state, $location, $stateParams) {
	function link(scope, el, attrs) {
		scope.state = $state;
		scope.current_url = $location.path();

		scope.crumbs = [];(function getCrumbs(state) {
			if (state.data.crumb_parent) {
				scope.crumbs.push(state.data.crumb_parent);

				getCrumbs(state.data.crumb_parent);
			}
		})($state.current);

		scope.crumbs.reverse();

		scope.fix = function (url) {
			if (url.indexOf(':') != -1) {
				return url.split('/').map(function (segment) {
					if (segment[0] != ':') {
						return segment;
					} else {
						if ($stateParams[segment.slice(1)]) {
							return $stateParams[segment.slice(1)];
						} else {
							return segment;
						}
					}
				}).join('/').split('?')[0];
			} else {
				return url.split('?')[0];
			}
		};
	}

	return {
		restrict: 'E',
		replace: true,
		transclude: false,
		link: link,
		templateUrl: 'directives/breadcrumbs/breadcrumbs.html',
		scope: {}
	};
}]);
'use strict';

angular.module('app.directives').directive('btn', ["$state", "$store", "$auth", function ($state, $store, $auth) {
	function link(scope, el, attrs, ctrl, $transclude) {
		scope.small = attrs.small !== undefined ? true : false;
		scope.large = attrs.large !== undefined ? true : false;
		scope.spin = attrs.spin !== undefined ? true : false;
		scope.circle = attrs.circle !== undefined ? true : false;

		if (!scope.type) scope.type = 'primary';

		// http://stackoverflow.com/questions/21547781/detect-if-a-transclude-content-has-been-given-for-a-angularjs-directive
		$transclude(function (clone) {
			if (clone.length) {
				scope.hasTranscluded = true;
			}
		});
	}

	return {
		restrict: 'E',
		replace: true,
		transclude: true,
		link: link,
		templateUrl: 'directives/btn/btn.html',
		scope: {
			icon: '@',
			type: '@',
			url: '@',
			disable: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('myTable', ["$filter", function ($filter) {
	function link(scope, el, attrs) {

		window.dataTable = scope;
		scope.items = scope.data.items;
		scope.filtered = [];

		scope.data.page = 1;

		scope.limits = scope.data.limits || [10, 25, 50, 100];
		scope.data.limit = scope.data.limit || scope.limits[0];
		scope.data.buttons = scope.data.buttons ? scope.data.buttons : [];

		scope.buttons = scope.data.buttons.reduce(function (s, name) {
			s[name] = true;
			return s;
		}, {});

		scope.cols = scope.data.cols.map(function (col) {
			col.getProp = function (item) {
				//goto
				if (!item) return;
				// return String(col.getter ? col.getter(item) : item[col.prop])
				var val = typeof col.prop === 'function' ? col.prop(item) : item[col.prop];
				return String(val);
			};

			col.sorter = { dir: null };

			col.sorter.switch = function () {
				scope.cols.filter(function (c) {
					return c !== col;
				}).forEach(function (c) {
					return c.sorter.dir = null;
				});
				col.sorter.dir = !col.sorter.dir ? '+' : col.sorter.dir === '+' ? '-' : null;
			};

			if (!col.filter) col.filter = { type: 'string' };
			if (typeof col.filter.value === 'undefined') col.filter.value = '';

			return col;
		});

		scope.simplifyItems = function () {
			scope.simplifiedItems = scope.data.items.map(function (x) {
				var obj = {};

				if (!x.id) return { 'error': 'No id on item given to data-table', 'object': x };

				obj.id = x.id;

				scope.data.cols.forEach(function (col) {
					var val = col.getProp(x);

					obj[col.name] = val ? isNaN(val) ? val : parseFloat(val) : '';
				});

				if (scope.data.additionalProps) {
					scope.data.additionalProps.forEach(function (col) {
						var val = typeof col.prop === 'function' ? col.prop(x) : x[col.prop];

						obj[col.name] = val ? isNaN(val) ? val : parseFloat(val) : '';
					});
				}

				return obj;
			});

			return scope.simplifiedItems;
		};

		scope.getRealItem = function (obj) {
			return scope.data.items.find(function (x) {
				return x.id === obj.id;
			});
		};

		scope.filters = scope.cols.map(function (col) {
			return col.getProp();
		});

		scope.allSorts = function () {
			var col = scope.cols.find(function (col) {
				return !!col.sorter.dir;
			});
			if (col) return col.sorter.dir + '\'' + col.name + '\'';
			if (scope.data.orderBys) return scope.data.orderBys;
			return [];
		};

		scope.allFilters = function (item, index, array) {
			var passFilter = true;

			// check everything about this item against all active filters
			scope.cols.filter(function (col) {
				return col.filter.value;
			}).forEach(function (col) {
				// if this filter is a dropdown
				if (col.filter.type === 'dropdown2') {
					// if this filter is a multi-value dropdown
					if (col.filter.config.multiple) {
						// if this filter has been applied, and this item has no value
						if (!item[col.name] && col.filter.value.length !== col.filter.items.length) {
							// then the item doesn't pass the filter
							passFilter = false;
							// if this filter has NOT been applied, and this item has no value
						} else {
							if (col.filter.value.length) {
								// if none of the filter values contain this items value...
								var pass = void 0;

								if (col.filter.value.length !== col.filter.items.length) {
									pass = col.filter.value.reduce(function (s, x) {
										return s || lookIn(item[col.name], x[col.filter.config.text]);
									}, false);
								} else {
									pass = true;
								}

								// then the item doesn't pass the filter
								if (!pass) passFilter = false;
							}
						}
						// if this filter is a single-value dropdown
					} else {
						// if the items value for this column doesn't contain the value chosen in the dropdown
						if (!lookIn(item[col.name], col.filter.value[col.filter.config.text])) {
							// then the item doesn't pass the filter
							passFilter = false;
						}
					}
					// if this column's filter is a text input
				} else {
					// if this items property doesn't contain the filter value
					if (!lookIn(item[col.name], col.filter.value)) {
						// then the item doesn't pass the filter
						passFilter = false;
					}
				}
			});

			return passFilter;
		};

		var lookIn = function lookIn(haystack, needle) {
			haystack = String(haystack).toLowerCase();
			needle = String(needle).toLowerCase();

			return haystack.indexOf(needle) !== -1;
		};

		var doFilter = function doFilter() {
			scope.data.page = 1;
			var filter = $filter('filter');
			var orderBy = $filter('orderBy');
			scope.filtered = orderBy(filter(scope.simplifiedItems, scope.allFilters), scope.allSorts());
		};

		scope.data.allSorts = scope.allSorts;
		scope.data.allFilters = scope.allFilters;

		if (scope.data.items && scope.data.items.hasOwnProperty('$resolved')) {
			scope.data.items.$promise.then(doFilter);
		}

		scope.$watch('data.items', scope.simplifyItems, true);
		scope.$watch('data.items', doFilter, true);
		scope.$watch('data.cols', doFilter, true);
	}

	return {
		restrict: 'E',
		link: link,
		replace: true,
		templateUrl: 'directives/data-table/data-table.html',
		scope: {
			data: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('dateInput', ["$rootScope", function ($rootScope) {
	function link(scope, el, attrs) {
		scope.dateOptions = {
			showWeeks: false,
			format: 'd MMM yyyy'
		};

		scope.open = false;

		scope.toggle = function () {
			scope.open = !scope.open;
		};

		scope.clear = function () {
			scope.model = '';
		};
	}

	return {
		restrict: 'E',
		link: link,
		replace: true,
		templateUrl: 'directives/date-input/date-input.html',
		scope: {
			model: '=ngModel',
			change: '=ngChange'
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('dropdown', ["$timeout", function ($timeout) {
	function link(scope, el, attrs) {

		scope.nullable = attrs.nullable !== undefined;
		scope.small = attrs.small !== undefined;
		scope.checkboxes = attrs.checkboxes !== undefined && attrs.checkboxes !== "false";
		scope.listDown = true;
		scope.filter_val = '';
		scope.filter_text = '';
		scope.short = attrs.short !== undefined;
		scope.placeholder = attrs.placeholder !== undefined ? attrs.placeholder : 'Search...';

		scope.primaryFilter = function (value, index, array) {
			if (scope.display.primary) {
				if (value[scope.display.primary].indexOf(scope.filter_val) !== -1) return true;
			} else {
				return true;
			}
		};

		var elem = el[0];
		var dropdownList = el.find('.ns-dropdown-list');
		var ignoreBlur = false;

		$('html').on('click', function (e) {
			if (!$(e.target).closest('.ns-dropdown').length) {

				ignoreBlur = false;

				el.find('input').trigger('blur');

				dropdownList.addClass('ns-dropdown-hide');

				$timeout(function () {
					scope.filter_text = scope.makeCommaString(scope.data);
				});
			}
		});

		function checkHeight() {
			var offset = $(elem).offset();

			dropdownList.removeClass('ns-dropdown-hide');
			var listHeight = dropdownList.height();

			if (window.innerHeight > offset.top + el.height() + listHeight) {
				dropdownList.removeClass('ns-dropdown-list-up');
			} else {
				dropdownList.addClass('ns-dropdown-list-up');
			}
		}

		scope.orderFunc = function (i) {
			if (scope.orderBy) {
				return scope.orderBy(i);
			} else {
				return false;
			}
		};

		scope.hideFunc = function (item, index, array) {
			if (scope.hide) {
				return scope.hide(item, index, array);
			} else {
				return {};
			}
		};

		scope.text = function (item) {
			if (!scope.display.text) return '';
			if (typeof scope.display.text === 'function') {
				return scope.display.text(item);
			} else {
				return item[scope.display.text];
			}
		};

		scope.subtext = function (item) {
			if (!scope.display.subtext) return '';
			if (typeof scope.display.subtext === 'function') {
				return scope.display.subtext(item);
			} else {
				return item[scope.display.subtext];
			}
		};

		scope.makeCommaString = function (items) {
			return items.reduce(function (s, i) {
				if (i.checked) s.push(scope.text(i));
				return s;
			}, []).join(', ');
		};

		$timeout(function () {
			if (scope.checkboxes) {
				scope.ngModel = scope.data;
				scope.filter_text = scope.makeCommaString(scope.data);
			}
		});

		scope.select = function (item) {
			if (scope.checkboxes) {
				el.find('.ns-dropdown-item.focused').removeClass('focused');

				item.checked = !item.checked;

				return;
			}

			dropdownList.addClass('ns-dropdown-hide');

			var target = el.find('[data-id=' + item.id + ']');

			el.find('.ns-dropdown-item.focused').removeClass('focused');
			target.addClass('focused');

			$timeout(function () {
				if (!scope.checkboxes) scope.ngModel = attrs.clone !== undefined ? _.clone(item) : item;

				if (typeof scope.change === 'function') scope.change(item);

				scope.filter_val = '';
				scope.filter_text = scope.text(item);
			});
		};

		scope.clear = function () {
			if (!scope.checkboxes) scope.ngModel = null;
			scope.data.forEach(function (i) {
				return i.checked = false;
			});
			scope.filter_text = '';
			dropdownList.addClass('ns-dropdown-hide');
		};

		scope.$watch('ngModel', function (newVal) {
			if (newVal) {
				if (!scope.checkboxes) scope.filter_text = scope.text(scope.ngModel);
			} else {
				if (scope.checkboxes) {
					scope.filter_text = scope.makeCommaString(scope.data);
				} else {
					scope.filter_text = '';
				}
			}
		});

		el.on('mousedown', '.ns-dropdown-list', function (e) {
			ignoreBlur = true;
		}).on('mouseup', '.ns-dropdown-checkbox', function (e) {
			ignoreBlur = true;
		}).on('focus', 'input', function (e) {
			scope.$apply(function () {
				scope.filter_text = '';
				dropdownList.removeClass('ns-dropdown-hide');
				ignoreBlur = false;
				checkHeight();

				$timeout(function () {
					if (el.find('.ns-dropdown-item.focused').length === 0) {
						el.find('.ns-dropdown-item').first().addClass('focused');
					}

					if (el.find('.ns-dropdown-item.focused')[0]) {
						el.find('.ns-dropdown-list')[0].scrollTop = el.find('.ns-dropdown-item.focused')[0].offsetTop;
					}
				});
			});
		}).on('blur', 'input', function (e) {
			if (!ignoreBlur) {
				scope.$apply(function () {
					if (scope.ngModel) {
						scope.filter_text = scope.text(scope.ngModel);
					} else {
						scope.filter_text = '';
					}

					if (scope.checkboxes) {
						scope.filter_text = scope.makeCommaString(scope.data);
					}

					dropdownList.addClass('ns-dropdown-hide');
				});

				if (!scope.checkboxes) scope.filter_val = '';
			}
		}).on('keydown', 'input', function (e) {
			var focused = el.find('.ns-dropdown-item.focused');
			var index = focused.index();

			$timeout(function () {
				scope.filter_val = scope.filter_text;

				if (el.find('.ns-dropdown-item.focused').length === 0) {
					el.find('.ns-dropdown-item').first().addClass('focused');
				}
			});

			if (e.which === 13) {
				// enter
				e.preventDefault();
				if (scope.filtered.length) {
					scope.select(scope.filtered[index]);
					$(this).trigger('blur');
				}
			}

			if (e.which === 27) {
				// esc
				e.preventDefault();
				$(this).trigger('blur');
				if (!scope.checkboxes) scope.filter_text = '';
			}

			if (e.which === 38) {
				// up
				e.preventDefault();
				if (index >= 0) {
					el.find('.ns-dropdown-item.focused').removeClass('focused').prev().addClass('focused');
				}
			}

			if (e.which === 40) {
				// down
				e.preventDefault();
				if (index < scope.filtered.length - 1) {
					el.find('.ns-dropdown-item.focused').removeClass('focused').next().addClass('focused');
				}
			}

			if (e.which === 38 || e.which === 40) {
				// up or down
				var target = el.find('.ns-dropdown-item.focused')[0];
				var list = el.find('.ns-dropdown-list')[0];

				if (target && target.offsetTop < list.scrollTop) {
					// above the top edge
					list.scrollTop = target.offsetTop;
				} else if (target && target.offsetTop + target.clientHeight > list.clientHeight + list.scrollTop) {
					// below the bottom edge
					list.scrollTop = target.offsetTop + target.clientHeight - list.clientHeight;
				}
			}

			if (e.which === 9) {
				// tab
				var highlighted = el.find('.focused');
				var id = highlighted.data('id');

				var item = scope.filtered.find(function (i) {
					return i.id === id;
				});

				if (!item) item = scope.filtered[0];

				scope.select(item);
			}
		});
	}

	return {
		link: link,
		restrict: 'E',
		replace: true,
		templateUrl: 'directives/dropdown/dropdown.html',
		scope: {
			'data': '=',
			'ngModel': '=',
			'display': '=',
			'orderBy': '=',
			'hide': '=',
			'change': '=',
			'icon': '@'
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('dropdown2', function () {
	function link(scope, element, attrs) {
		var config = scope.config;
		var items = scope.items;

		window.dropdown = scope;

		scope.unique = parseInt(Math.random() * 99999);

		scope.selected = config.multiple ? [] : null;

		scope.config.orders = scope.config.orders ? scope.config.orders : [];

		scope.context = 'blurred';

		scope.simplify = function (item) {
			return {
				id: item[config.id],
				text: item[config.text]
			};
		};

		scope.simpleItems = scope.items.map(function (item) {
			return scope.simplify(item);
		});

		scope.initialize = function () {
			if (config.multiple) {
				if (scope.ngModel) {
					scope.selected = scope.ngModel.map(function (realItem) {
						return scope.simpleItems.find(function (simpleItem) {
							return simpleItem.id === realItem[config.id];
						});
					});
				}

				if (!scope.selected.length) {
					scope.ngModel = scope.items;
				}
			} else {
				if (scope.ngModel) {
					scope.selected = scope.simplify(scope.ngModel);
				}
			}

			scope.updateInput();
		};

		scope.focus = function () {
			scope.context = 'focused';
			scope.updateInput();
		};

		scope.blur = function () {
			scope.context = 'blurred';
			scope.updateInput();
		};

		scope.isFocused = function () {
			return scope.context === 'focused';
		};

		scope.isBlurred = function () {
			return scope.context === 'blurred';
		};

		scope.isSelected = function (item) {
			if (config.multiple) {
				return !!scope.selected.find(function (i) {
					return i === item;
				});
			} else {
				return scope.selected === item;
			}
		};

		scope.hasSelected = function () {
			if (config.multiple) {
				return !!scope.selected.length;
			} else {
				return !!scope.selected;
			}
		};

		scope.getRealSelected = function (item) {
			return scope.items.find(function (y) {
				return y[config.id] === item.id;
			});
		};

		scope.updateInput = function () {
			if (scope.context === 'blurred') {
				if (config.multiple) {
					scope.input = '';
				} else {
					scope.input = scope.selected ? scope.selected.text : '';
				}
			}

			if (scope.context === 'focused' && !config.multiple) {
				scope.input = '';
			}

			if (config.multiple) {
				config.placeholder = [scope.selected.length, scope.selected.length === 1 ? 'item' : 'items', 'selected'].join(' ');
			}
		};

		scope.choose = function (item) {
			scope.select(item);

			if (config.multiple) {
				scope.updateInput();
			} else {
				scope.blur();
			}
		};

		scope.select = function (item) {
			if (config.multiple) {
				if (scope.isSelected(item)) {
					scope.selected = scope.selected.filter(function (x) {
						return x !== item;
					});
				} else {
					scope.selected.push(item);
				}

				if (!scope.selected.length) {
					scope.ngModel = scope.items;
				} else {
					scope.ngModel = scope.selected.map(function (x) {
						return scope.getRealSelected(x);
					});
				}
			} else {
				scope.selected = item;
				scope.ngModel = scope.getRealSelected(item);
			}
		};

		scope.clear = function () {
			if (config.multiple) {
				scope.selected = [];

				scope.ngModel = scope.items;
			} else {
				scope.selected = null;
				scope.ngModel = null;
			}

			scope.updateInput();
		};

		element.on('focus', '.ns-dropdown2-input', function () {
			scope.$apply(scope.focus);
		});

		angular.element('html').on('click', function (e) {
			var target = angular.element(e.target);

			if (scope.isFocused() && target.closest('#dropdown-' + scope.unique).length === 0) {
				scope.$apply(function () {
					return scope.blur();
				});
			}
		});

		scope.initialize();
	}

	return {
		link: link,
		restrict: 'E',
		replace: true,
		templateUrl: 'directives/dropdown2/dropdown2.html',
		scope: {
			'ngModel': '=',
			'items': '=',
			'config': '='
		}
	};
});
'use strict';

angular.module('app.directives').directive('fileread', function () {
	return {
		scope: {
			fileread: '=',
			loader: '='
		},
		link: function link(scope, element, attributes) {
			var file = null;

			if (!scope.loader) scope.loader = {};

			element.bind('change', function (changeEvent) {
				file = changeEvent.target.files[0];
				scope.loader.load();
			});

			scope.loader.load = function () {
				var reader = new FileReader();

				var xlsxMode = false;

				if (file.name.split('.').indexOf('xlsx') !== -1) {
					xlsxMode = true;
					reader.readAsBinaryString(file);
				} else {
					reader.readAsText(file);
				}

				reader.onload = function (loadEvent) {
					scope.$apply(function () {
						scope.fileread = loadEvent.target.result;
						scope.loader.loaded(loadEvent.target.result, xlsxMode ? 'xlsx' : 'csv');
					});
				};
			};
		}
	};
});
'use strict';

angular.module('app.directives').directive('filter', ["$rootScope", function ($rootScope) {
	function link(scope, el, attrs) {
		window.onkeyup = function (e) {
			if (e.which == 70 && e.ctrlKey === true) {
				el.find('input').focus();
			}
		};
	}

	return {
		restrict: 'E',
		replace: true,
		link: link,
		templateUrl: 'directives/filter/filter.html',
		scope: {
			model: '=',
			filtered: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('loader', ["$rootScope", function ($rootScope) {
	function link(scope, el, attrs) {
		scope.loader = $rootScope.loader;
	}

	return {
		restrict: 'E',
		replace: false,
		link: link,
		templateUrl: 'directives/loader/loader.html'
	};
}]);
'use strict';

angular.module('app.directives').directive('navLink', ["$location", "$state", "$rootScope", function ($location, $state, $rootScope) {
	function link(scope, el, attrs) {
		$rootScope.$on('$stateChangeSuccess', function (event, toState, toStateParams) {
			render(toState);
		});

		function render(state) {
			if ($location.path() == scope.url.replace('#', '')) {
				el.addClass('current');
			} else {
				el.removeClass('current');
			}

			scope.crumbs = [];

			getCrumbs(state);

			function getCrumbs(state) {
				if (state.data && state.data.crumb_parent) {
					scope.crumbs.push(state.data.crumb_parent);

					getCrumbs(state.data.crumb_parent);
				}
			}

			_.forEach(scope.crumbs, function (crumb) {
				var url = crumb.url;

				if (url.indexOf('?') > -1) {
					url = url.substring(0, url.indexOf('?'));
				}

				if (scope.url.replace('#', '') == url) {
					el.addClass('current');
				}
			});
		}

		render($state.current);
	}

	return {
		restrict: 'A',
		replace: false,
		transclude: false,
		link: link,
		templateUrl: 'directives/navLink/navLink.html',
		scope: {
			'navLink': '@',
			'url': '@',
			'icon': '@',
			'number': '@',
			'loading': '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('pageHeader', ["$rootScope", function ($rootScope) {
	function link(scope, el, attrs) {
		scope.showBreadcrumbs = scope.breadcrumbs !== undefined ? scope.breadcrumbs : true;
	}

	return {
		restrict: 'E',
		replace: true,
		link: link,
		transclude: true,
		templateUrl: 'directives/pageHeader/pageHeader.html',
		scope: {
			text: '@',
			breadcrumbs: '=',
			count: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('pager', ["$state", "$store", "$auth", "$queryString", function ($state, $store, $auth, $queryString) {
	function link(scope, el, attrs) {
		var old = null;

		scope.getLimit = function () {
			return scope.filter ? 99 : scope.limit;
		};

		function calculate() {
			scope.pages = [];
			scope.allpages = [];

			scope.current = scope.current ? scope.current : old ? old : 1;

			var range = 2;
			var max = range * 2 + 1;

			scope.totalpages = Math.ceil((scope.filter ? scope.filtered.length : scope.data.length) / scope.getLimit());

			var start = scope.getCurrent() - range > 1 ? scope.getCurrent() - range : 1;

			if (start > scope.totalpages - max + 1) {
				start = scope.totalpages - max + 1;
			}

			start = start <= 1 ? 1 : start;

			for (var i = start; i <= scope.totalpages; i++) {
				if (i > scope.getCurrent() - range && i < scope.getCurrent() + range || scope.pages.length < max) {
					scope.pages.push(i);
				}
			}

			for (var j = 1; j <= scope.totalpages; j++) {
				scope.allpages.push(j);
			}
		}

		scope.$watch('data', calculate, true);
		scope.$watch('current', calculate);
		scope.$watch('filter', calculate);
		scope.$watch('limit', calculate);

		scope.setCurrent = function (val) {
			scope.current = val;

			scope.updateOld();
		};

		scope.updateOld = function () {
			if (scope.current === null) return;

			old = scope.current;
		};

		scope.getCurrent = function () {
			return scope.filter ? 1 : scope.current ? scope.current : old ? old : 1;
		};
	}

	return {
		restrict: 'E',
		replace: true,
		link: link,
		templateUrl: 'directives/pager/pager.html',
		scope: {
			current: '=',
			limit: '=',
			data: '=',
			filtered: '=',
			filter: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('pagination', ["$state", "$store", "$auth", "$queryString", function ($state, $store, $auth, $queryString) {
	function link(scope, el, attrs) {

		window.pagination = scope;

		scope.totalPages = [];
		scope.pages = [];

		var calculatePagesAmount = function calculatePagesAmount() {
			var arr = [];
			var n = Math.ceil(scope.data.length / scope.limit);

			for (var i = 0; i < n; i++) {
				arr.push({ number: i + 1 });
			}

			return arr;
		};

		var setPages = function setPages() {
			var displayedPages = [];

			scope.totalPages.forEach(function (p) {
				var currentPage = scope.page;

				var pageToAdd = p.number;

				var distance = 1;

				if (currentPage === 1 || currentPage === scope.totalPages.length) {
					distance = 2;
				}

				if (pageToAdd >= currentPage - distance && pageToAdd <= currentPage + distance) {
					displayedPages.push(p);
				}
			});

			return displayedPages;
		};

		var calculatePages = function calculatePages() {
			scope.totalPages = calculatePagesAmount();
			scope.pages = setPages();
		};

		scope.$watch('data', calculatePages);
		scope.$watch('limit', calculatePages);

		scope.goto = function (p) {
			if (!p) return;

			scope.page = p.number;
			calculatePages();
		};

		scope.first = function (arr) {
			return arr[0];
		};
		scope.last = function (arr) {
			return arr[arr.length - 1];
		};

		scope.next = function (p) {
			return scope.totalPages[scope.totalPages.indexOf(scope.totalPages.find(function (page) {
				return page.number === p;
			})) + 1];
		};
		scope.prev = function (p) {
			return scope.totalPages[scope.totalPages.indexOf(scope.totalPages.find(function (page) {
				return page.number === p;
			})) - 1];
		};
	}

	return {
		restrict: 'E',
		replace: true,
		link: link,
		templateUrl: 'directives/pagination/pagination.html',
		scope: {
			page: '=',
			limit: '=',
			data: '='
		}
	};
}]);
'use strict';

angular.module('app.directives').directive('sidebar', ["$store", "$state", "$auth", "$load", "$location", "$rootScope", "$http", "$timeout", function ($store, $state, $auth, $load, $location, $rootScope, $http, $timeout) {
	function link(scope, el, attrs) {
		scope.auth = $auth;
		scope.user = $store.user;
		scope.store = $store;

		$load.listen('user', function (user) {
			scope.user = user;
			scope.loading_bookings = true;

			// no idea if this little part actually works
			if (!$auth.isAuthenticated() && $state.current.data.conditions.indexOf('auth') !== -1) {
				$location.path('/');
			}
		});

		$load.listen('booking_count', function (res) {
			scope.bookings_count = parseInt(res.data.total);
			scope.loading_bookings = false;
		});
	}

	return {
		restrict: 'E',
		replace: true,
		transclude: false,
		link: link,
		templateUrl: 'directives/sidebar/sidebar.html',
		scope: {}
	};
}]);
'use strict';

angular.module('app.directives').directive('selectDark', function () {
	function link(scope, element, attrs, $select) {
		element.addClass('ui-select-dark');
	}

	return {
		restrict: 'A',
		require: 'uiSelect',
		link: link
	};
});
'use strict';

angular.module('app.directives').directive('selectUnitOnClose', function () {
	function link(scope, element, attrs, $select) {
		angular.element($select.searchInput).on('keyup', function () {
			var search = this.value;

			_.forEach($select.items, function (item) {
				var a = item.unit_number;

				if (search == a) {
					$select.select(item);
				}
			});
		});
	}

	return {
		restrict: 'A',
		require: 'uiSelect',
		link: link
	};
});
'use strict';

angular.module('app.filters').filter('page', ["$filter", function ($filter) {
	return function (input, page, limit) {
		return $filter('limitTo')(input, limit, (page - 1) * limit);
	};
}]);
'use strict';

angular.module('app.controllers').controller('confirmCtrl', ["$scope", "$store", "$location", "$http", "$invalidate", function ($scope, $store, $location, $http, $invalidate) {
	if (!$store.booking.pickup_at) {
		$location.path('/book');
	}

	window.$scope = $scope;

	$scope.user = $store.user;
	$scope.booking = $store.booking;
	$scope.allowedProducts = [];
	$scope.overallAllowed = true;
	$scope.terms = $store.get('settings', { key: 'terms' });
	$scope.reasons = [];

	$scope.product = function (id) {
		return $store.get('products', id);
	};

	_.forEach($scope.booking.products, function (product) {

		$scope.booking.pickup_at = moment($scope.booking.pickup_at).startOf('day')._d;

		if (product.limitless) {
			$scope.allowedProducts.push(product.id);
			return;
		}

		$http.post('/api/product/' + product.id + '/check', {
			pickup_at: $scope.booking.pickup_at,
			due_at: $scope.booking.due_at,
			quantity: product.quantity
		}).then(function (res) {
			if (res.data.allowed) {
				$scope.allowedProducts.push(parseInt(res.data.id));
			} else {
				$scope.overallAllowed = false;
				$scope.reasons.push({ id: parseInt(res.data.id), reason: res.data.reason });
			}
		});
	});

	$scope.allowed = function (id) {
		return $scope.allowedProducts.indexOf(id) >= 0;
	};
	$scope.reason = function (id) {
		var reason = $scope.reasons.find(function (x) {
			return x.id === id;
		});
		return reason ? reason.reason : '';
	};

	$scope.confirm = function () {
		if (!$scope.user.can_book) {
			return;
		}

		$store.booking.pickup_at = new Date($store.booking.pickup_at);
		$store.booking.due_at = new Date($store.booking.due_at);

		$http.post('/api/booking', $store.booking).then(function (res) {
			$store.resetBooking();

			$invalidate.add('booking_count');
			$location.path('/book/success');
		});
	};

	$scope.disableSubmit = function () {
		return !$scope.overallAllowed || !$scope.booking.due_at || !$scope.booking.pickup_at || !$scope.booking.products.length || !$scope.readTerms;
	};
}]);
'use strict';

angular.module('app.controllers').controller('editBookingCtrl', ["$scope", "$stateParams", "$store", "$location", "$http", "$invalidate", "$load", "$prepare", "$timeout", "sweetAlert", function ($scope, $stateParams, $store, $location, $http, $invalidate, $load, $prepare, $timeout, sweetAlert) {
	$scope.booking = $load.booking($stateParams.id);
	$scope.allProducts = $store.products;
	$scope.errors = [];
	$scope.products = [];
	$scope.status = '';

	$scope.unit_number = function (u) {
		return parseInt(u.unit_number);
	};

	$scope.booking.$promise.then(function (b) {
		$scope.products = b._products.map($scope.setupUnits).map($scope.setupUnit).map($scope.keepPivotID);

		$scope.status = $scope.booking._status;
	}, function (err) {
		$scope.errors.push({ message: err.data.error });
	});

	$scope.keepPivotID = function (p, i) {
		p.pivot = {
			id: $scope.booking.products[i].pivot.id
		};

		return p;
	};

	$scope.setupUnit = function (p, i) {
		if ($scope.booking.products[i].pivot) {
			p._unit = p._units.filter(function (u) {
				return u.id == $scope.booking.products[i].pivot.unit_id;
			})[0];
		}

		return p;
	};

	$scope.setupUnits = function (p) {
		if (p.units) {
			p._units = p.units.map(function (u) {
				return { id: u.id, unit_number: u.unit_number };
			});
		} else {
			p._units = $store.units.filter(function (u) {
				return u.product_id === p.id;
			}).map(function (u) {
				return { id: u.id, unit_number: u.unit_number };
			});
		}

		return _.clone(p);
	};

	$scope.setupAllUnits = function () {
		$timeout(function () {
			return $scope.products = $scope.products.map($scope.setupUnits);
		});
	};

	$scope.addProduct = function () {
		$scope.products.push(null);
	};

	$scope.removeProduct = function (product, index) {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.products.splice(index, 1);

			if (!$scope.products.length) $scope.products.push(null);

			$scope.$apply();
		});
	};

	$scope.save = function () {
		if ($scope.booking._priority == 1) $scope.saveBooked();
		if ($scope.booking._priority == 2) $scope.saveIssued();
	};

	$scope.saveBooked = function () {
		$scope.booking._req_type = 'edit_booked';

		$scope.booking.products = $scope.products;

		$http.put('/api/booking/' + $scope.booking.id, $scope.booking).then(function (res) {
			$location.path('/booking/' + $scope.booking.id);
		});
	};

	$scope.saveIssued = function () {
		$scope.booking.taken_at = new Date();
		$scope.booking.issued_by_id = $store.user.id;

		$scope.booking.products = $scope.products;

		$scope.booking._req_type = 'edit_issued';

		$http.put('/api/booking/' + $scope.booking.id, $scope.booking).then(function (res) {
			$location.path('/booking/' + $scope.booking.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('issueCtrl', ["$scope", "$stateParams", "$store", "$location", "$http", "$invalidate", "$load", "$prepare", "$timeout", "sweetAlert", function ($scope, $stateParams, $store, $location, $http, $invalidate, $load, $prepare, $timeout, sweetAlert) {

	$scope.booking = $store.get('bookings', $stateParams.id);
	$scope.allProducts = $store.products;
	$scope.errors = [];
	$scope.products = [];

	$scope.unit_number = function (u) {
		return parseInt(u.unit_number);
	};

	if (!$scope.booking) {
		$scope.booking = $load.booking($stateParams.id);
	}

	$scope.booking.$promise.then(function (b) {
		$scope.products = b._products.map($scope.setupUnits);
	}, function (err) {
		$scope.errors.push({ message: err.data.error });
	});

	$scope.setupUnits = function (p) {
		if (p.units) {
			p._units = p.units.map(function (u) {
				return { id: u.id, unit_number: u.unit_number };
			});
		} else {
			p._units = $store.units.filter(function (u) {
				return u.product_id === p.id;
			}).map(function (u) {
				return { id: u.id, unit_number: u.unit_number };
			});
		}

		return _.clone(p);
	};

	$scope.setupAllUnits = function () {
		$timeout(function () {
			return $scope.products = $scope.products.map($scope.setupUnits);
		});
	};

	$scope.addProduct = function () {
		$scope.products.push(null);
	};

	$scope.removeProduct = function (product, index) {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.products.splice(index, 1);

			if (!$scope.products.length) $scope.products.push(null);

			$scope.$apply();
		});
	};

	$scope.issue = function () {
		var allChosen = true;

		$scope.products.forEach(function (p) {
			if (!p) return;
			if (!p._unit && !p._taken) allChosen = false;
		});

		if (allChosen) {
			$scope.booking.taken_at = new Date();
			$scope.booking.issued_by_id = $store.user.id;

			$scope.booking.products = $scope.products;

			$scope.booking._req_type = 'issue';

			$http.put('/api/booking/' + $scope.booking.id, $scope.booking).then(function (res) {
				// console.log('res', res)
				// return

				$location.path('/bookings');
			});
		} else {
			if (_.findIndex($scope.errors, { code: 1 }) === -1) {
				$scope.errors.push({ code: 1, message: 'You need to assign a unit for every product.' });
			}
		}
	};
}]);
'use strict';

angular.module('app.controllers').controller('makeCtrl', ["$scope", "$store", "$location", "sweetAlert", function ($scope, $store, $location, sweetAlert) {

	$scope.selectedProducts = [{ quantity: 1 }];
	$scope.user = $store.user;
	$scope.booking = $store.booking;
	$scope.kits = $store.kits;

	window.$scope = $scope;

	if ($store.user.admin) {
		$scope.users = $store.users;
	} else {
		$scope.users = [];
	}

	$scope.user_group = function (user) {
		return user.group ? user.group.code : '';
	};
	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.filterAdded = function (value, index, array) {
		if (value.limitless) return true;
		var found = false;

		$scope.selectedProducts.forEach(function (v) {
			if (v.product && v.product.id == value.id) {
				found = true;
			}
		});

		return !found;
	};

	if (!$scope.booking._user) {
		$scope.booking._user = $store.user;
	}

	if (!$scope.booking.pickup_at) {
		$scope.booking.pickup_at = new Date();
	} else if ($scope.booking.due_at && $scope.booking.pickup_at.valueOf() > $scope.booking.due_at.valueOf()) {
		$scope.booking.pickup_at = new Date();
		$scope.booking.due_at = '';
	}

	$scope.reset = function () {
		$store.resetBooking();
		$scope.booking.pickup_at = new Date();
		$scope.booking.due_at = undefined;
		$scope.booking._user = $store.user;
		$scope.selectedProducts = [{ quantity: 1 }];
	};

	$scope.addProduct = function () {
		$scope.selectedProducts.push({ quantity: 1 });
	};

	$scope.removeProduct = function (product, index) {
		$scope.selectedProducts.splice(index, 1);

		if (!$scope.selectedProducts.length) {
			$scope.addProduct();
		}
	};

	$scope.trimProducts = function () {
		$scope.selectedProducts = $scope.selectedProducts.filter(function (p) {
			return !!p.product;
		});

		if (!$scope.selectedProducts.length) {
			$scope.selectedProducts.push({ quantity: 1 });
		}
	};

	$scope.addKit = function () {
		var kitsList = {};

		$scope.kits.forEach(function (k) {
			kitsList[k.id] = k.name;
		});

		sweetAlert.swal({
			title: 'Which kit?',
			text: 'Any products in a kit that you aren\'t allowed will be ignored',
			showCancelButton: true,
			input: 'select',
			inputOptions: kitsList,
			inputPlaceholder: 'Please select a kit'
		}).then(function (kit) {
			$scope.$apply(function () {
				$scope.importKit($scope.kits.find(function (k) {
					return k.id === parseInt(kit);
				}));
			});
		});
	};

	$scope.importKit = function (kit) {
		if ($scope.user.admin) {
			kit._products.forEach(function (p, i) {
				$scope.importProduct(p, kit.products[i].pivot.quantity);
			});
		} else {
			kit._products.forEach(function (p, i) {
				if ($scope.user.group && $scope.user.group.type) {
					var found = $scope.user.group.type.products.find(function (prod) {
						return p.id == prod.id;
					});

					var alreadyAdded = $scope.selectedProducts.find(function (sp) {
						return sp.product ? sp.product.id == p.id : false;
					});

					if (found && !alreadyAdded) {
						$scope.importProduct(p, kit.products[i].pivot.quantity);
					}
				}
			});
		}

		$scope.trimProducts();
	};

	$scope.importProduct = function (product, quantity) {
		$scope.selectedProducts.push({
			quantity: quantity, product: $scope.products.find(function (p) {
				return p.id == product.id;
			})
		});
	};

	$scope.book = function () {
		$scope.createBooking();
		$location.path('/book/confirm');
	};

	$scope.createBooking = function () {
		var payload = [];

		_.forEach($scope.selectedProducts, function (selected) {
			if (parseInt(selected.quantity) > 0 || selected.product.limitless) {
				if (selected.product) {
					payload.push({
						id: selected.product.id,
						quantity: selected.quantity,
						limitless: selected.product.limitless
					});
				}
			}
		});

		$store.setBooking({
			due_at: $scope.booking.due_at,
			pickup_at: $scope.booking.pickup_at,
			products: payload,
			_user: $scope.booking._user
		});
	};

	// calculate the max quantity allowed for a product
	$scope.max = function (product) {
		if (!product) return 1;

		return product._max;
	};

	// load all the products allowed based on the current users group.
	if ($store.user.group_id) {
		$scope.group = $store.get('groups', $store.user.group_id);

		// if the group exists, and has a type, then get all the products from the type
		if ($scope.group && $scope.group.type) {
			$scope.products = $scope.group.type.products;

			_.forEach($scope.products, function (product) {
				console.log('product', product);
				product._max = product.pivot.quantity;
			});
		}

		// if the current user doesn't have a group, check if they are an admin
	} else {
		// if they are one, then give them all the products
		if ($scope.user.admin) {
			$scope.products = $store.products;

			_.forEach($scope.products, function (product) {
				product._max = product.units.length;

				if ($scope.booking.products && $scope.booking.products.length) {
					var booking = _.find($scope.booking.products, function (p) {
						return p.id == product.id;
					});

					if (booking) product._quantity = booking.quantity;
				}
			});
		} else {
			$scope.products = [];
		}
	}

	if ($store.booking && $store.booking.products && $store.booking.products.length) {
		$scope.selectedProducts = [];

		$store.booking.products.forEach(function (p) {
			$scope.selectedProducts.push({
				// product: $store.get('products', p.id),
				product: $scope.products.find(function (prod) {
					return p.id == prod.id;
				}),
				quantity: p.quantity
			});
		});
	}
}]);
'use strict';

angular.module('app.controllers').controller('bookingsManageCtrl', ["$scope", "$store", "$load", "$stateParams", "$timeout", "$prepare", "Booking", function ($scope, $store, $load, $stateParams, $timeout, $prepare, Booking) {

	window.$scope = $scope;

	$scope.users = $store.users;
	$scope.groups = $store.groups;

	$scope.statuses = [{ text: 'Closed' }, { text: 'Overdue' }, { text: 'Issued' }, { text: 'Booked' }];

	$scope.dayFilters = [{ text: 'Tomorrow' }, { text: 'Today' }, { text: 'Yesterday' }];

	$scope.dayFormatter = function (date) {
		if (!date) return '';

		var suffix = '';
		var target = moment(date);
		var today = moment();
		var tomorrow = moment().add(1, 'd');
		var yesterday = moment().subtract(1, 'd');

		if (target.isSame(tomorrow, 'day')) {
			suffix = 'Tomorrow';
		} else if (target.isSame(today, 'day')) {
			suffix = 'Today';
		} else if (target.isSame(yesterday, 'day')) {
			suffix = 'Yesterday';
		}

		if (suffix) suffix = ' (' + suffix + ')';

		return target.format('YYYY-MM-DD') + suffix;
	};

	$scope.bookings = Booking.query({
		// after: moment().subtract(3, 'months').format('YYYY-MM-DD'),
		with: 'user'
	});

	$scope.bookings.$promise.then($prepare.bookings).then(function (bookings) {
		return bookings.map(function (b) {
			return {
				name: b.name,
				created_at: b.created_at,
				issued_at: b.issued_at,
				due_at: b.due_at,
				closed_at: b.closed_at,
				_status: b._status,
				user: {
					name: b.user.name
				}
			};
		});
	});

	$scope.dataTable = {
		items: $scope.bookings,
		buttons: ['view'],
		slug: 'booking',
		orderBys: [],
		cols: [{
			name: 'User',
			prop: function prop(x) {
				return x.user ? x.user.name : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.users,
				value: $store.get('users', $stateParams.user) || null,
				config: {
					text: 'name',
					id: 'id',
					multiple: true,
					clearable: true,
					small: true,
					orders: [function (x) {
						return x.text;
					}]
				}
			}
		}, {
			name: 'Pickup',
			// prop: x => x.pickup_at ? moment(x.pickup_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.pickup_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Issued',
			// prop: x => x.taken_at ? moment(x.taken_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.taken_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Due',
			// prop: x => x.due_at ? moment(x.due_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.due_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Closed',
			// prop: x => x.closed_at ? moment(x.closed_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.closed_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters.filter(function (x) {
					return x.text !== 'Tomorrow';
				}),
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Status',
			prop: '_status',
			indicator: function indicator(x) {
				if (x.Status === 'Booked') return '#2ECC71';
				if (x.Status === 'Issued') return '#F39C12';
				if (x.Status === 'Overdue') return '#E74C3C';
				if (x.Status === 'Closed') return '#ddd';
			},
			filter: {
				type: 'dropdown2',
				items: $scope.statuses,
				value: function () {
					var arr = [$scope.statuses[1], $scope.statuses[2], $scope.statuses[3]];
					if ($stateParams.closed) {
						arr.push($scope.statuses[0]);
					}
					return arr;
				}(),
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('returnCtrl', ["$scope", "$stateParams", "$store", "$location", "$http", "$invalidate", "$load", function ($scope, $stateParams, $store, $location, $http, $invalidate, $load) {
	$scope.errors = [];
	$scope.booking = $load.booking($stateParams.id);

	$scope.booking.$promise.then(function (b) {
		b.products.map(function (p) {
			console.log(p);
			p.returned = !!p.pivot.returned_at;
			p.locked = !!p.pivot.returned_at;
		});
	}, function (err) {
		$scope.errors.push({ message: err.data.error });
	});

	$scope.unit = function (id) {
		return $store.get('units', id);
	};

	$scope.close = function () {

		if ($scope.booking.products.length == _.filter($scope.booking.products, function (p) {
			return p.returned;
		}).length) {
			$scope.booking.closed_at = new Date();
			$scope.booking.closed_by_id = $store.user.id;
		}

		_.forEach($scope.booking.products, function (product) {
			if (product.returned) product.returned_at = new Date();
		});

		// console.log($scope.booking.products); return;
		$scope.booking._req_type = 'return';

		// console.log('close?')
		// console.log($scope.booking)
		// return

		$http.put('/api/booking/' + $scope.booking.id, $scope.booking).then(function (res) {
			$store.bookings = _.map($store.bookings, function (booking, i) {
				if (!booking) return;
				if (booking.id == res.id) $store.bookings[i] = res;
			});

			$load.booking_count();

			$location.path('/bookings');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('successCtrl', ["$scope", "$store", function ($scope, $store) {}]);
'use strict';

angular.module('app.controllers').controller('viewBookingCtrl', ["$scope", "$stateParams", "$store", "$location", "$http", "$invalidate", "Booking", "$prepare", "$merge", "sweetAlert", function ($scope, $stateParams, $store, $location, $http, $invalidate, Booking, $prepare, $merge, sweetAlert) {
	$scope.user = $store.user;
	$scope.errors = [];

	window.$scope = $scope;

	$scope.unit = function (id) {
		return $store.get('units', id);
	};

	$scope.booking = Booking.get({ id: $stateParams.id, with: 'user|products', token: localStorage.satellizer_token });

	$scope.booking.$promise.then($prepare.booking).then(function (booking) {
		$merge.bookings([booking]);
		$scope.return_difference = moment().diff(new Date($scope.booking.closed_at), 'hours');
		$scope.dataTable = {
			items: $scope.booking.products,
			limit: 25,
			cols: [{
				name: 'Name',
				prop: 'name'
			}, {
				name: 'Unit',
				prop: function prop(x) {
					if (x.limitless) return 'N/A';

					if (x.pivot) {
						if (x.pivot.unit_id) {
							return $store.get('units', x.pivot.unit_id).unit_number;
						}
					}
					return '';
				}
			}, {
				name: 'Notes',
				prop: function prop(x) {
					if (x.pivot) {
						return x.pivot.notes;
					}
					return '';
				}
			}, {
				name: 'Returned',
				prop: function prop(x) {
					if (x.pivot) {
						if (x.pivot.returned_at) {
							return moment(x.pivot.returned_at).format('YYYY-MM-DD');
						}
					}
					return '';
				}
			}]
		};
	}, function (err) {
		$scope.errors.push({ message: err.data.error });
	});

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$http.delete('/api/booking/' + $scope.booking.id).then(function () {
				$invalidate.add('booking_count');
				$location.path('/bookings');
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classTypeProductCtrl', ["$scope", "$stateParams", "$store", "$load", "$location", "$http", "$timeout", "$invalidate", "sweetAlert", function ($scope, $stateParams, $store, $load, $location, $http, $timeout, $invalidate, sweetAlert) {

	$scope.selectedProducts = [{ quantity: 1, days_allowed: 1 }];
	$scope.user = $store.user;
	$scope.kits = $store.kits;
	$scope.products = $store.products;

	window.$scope = $scope;

	$scope.group_type = $load.group_type($stateParams.id);

	$scope.group_type.$promise.then(function (res) {
		console.log('res', res);

		if ($scope.group_type.products.length) {
			$scope.selectedProducts = $scope.group_type.products.map(function (p) {
				return {
					quantity: p.pivot.quantity,
					days_allowed: p.pivot.days_allowed,
					product: p
				};
			});
		}
	});

	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.filterAdded = function (value, index, array) {
		if (value.limitless) return true;
		var found = false;

		$scope.selectedProducts.forEach(function (v) {
			if (v.product && v.product.id == value.id) {
				found = true;
			}
		});

		return !found;
	};

	$scope.addProduct = function () {
		$scope.selectedProducts.push({ quantity: 1, days_allowedI: 1 });
	};

	$scope.removeProduct = function (product, index) {
		$scope.selectedProducts.splice(index, 1);

		if (!$scope.selectedProducts.length) {
			$scope.addProduct();
		}
	};

	$scope.trimProducts = function () {
		$scope.selectedProducts = $scope.selectedProducts.filter(function (p) {
			return !!p.product;
		});
	};

	$scope.addKit = function () {

		var kitsList = {};

		$scope.kits.forEach(function (k) {
			kitsList[k.id] = k.name;
		});

		sweetAlert.swal({
			title: 'Which kit?',
			showCancelButton: true,
			input: 'select',
			inputOptions: kitsList,
			inputPlaceholder: 'Please select a kit'
		}).then(function (kit) {
			$scope.$apply(function () {
				$scope.importKit($scope.kits.find(function (k) {
					return k.id === parseInt(kit);
				}));
			});
		});
	};

	$scope.importKit = function (kit) {
		if ($scope.user.admin) {
			kit._products.forEach(function (p, i) {
				$scope.importProduct(p, kit.products[i].pivot.quantity);
			});
		}

		$scope.trimProducts();
	};

	$scope.importProduct = function (product, quantity) {
		$scope.selectedProducts.push({
			quantity: quantity, product: product, days_allowed: 1
		});
	};

	// calculate the max quantity allowed for a product
	$scope.max = function (product) {
		if (!product) return 1;

		return product._max;
	};

	$scope.save = function () {
		$http.post('/api/group_type/' + $scope.group_type.id + '/products', $scope.selectedProducts).then(function (res) {
			$invalidate.add('group_types');
			$location.path('/class-type/' + $scope.group_type.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classTypeEditCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Group_Type", function ($scope, $stateParams, $store, $location, $invalidate, Group_Type) {
	$scope.type = _.clone($store.get('group_types', $stateParams.id));

	$scope.save = function () {
		Group_Type.update({ id: $scope.type.id }, $scope.type).$promise.then(function (res) {
			$invalidate.add('group_types');

			$location.path('/class-type/' + $scope.type.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classTypeManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.group_types,
		buttons: ['view', 'edit'],
		slug: 'class-type',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Code',
			prop: 'code'
		}, {
			name: 'Number of classes',
			prop: function prop(x) {
				return x.groups ? x.groups.length : 0;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('classTypeNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Group_Type", function ($scope, $stateParams, $store, $location, $invalidate, Group_Type) {
	$scope.save = function () {
		var gt = new Group_Type();

		gt.code = $scope.code;
		gt.name = $scope.name;

		gt.$save().then(function (res) {
			$invalidate.add(['group_types', 'groups']);

			$location.path('/class-type');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classTypeViewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "sweetAlert", function ($scope, $stateParams, $store, $location, $invalidate, sweetAlert) {
	$scope.type = $store.get('group_types', $stateParams.id);

	window.$scope = $scope;

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.type.$delete().then(function () {
				$invalidate.add('group_types');

				$location.path('/class-type');
			});
		});
	};

	$scope.classesDataTable = {
		items: $scope.type.groups,
		buttons: ['view', 'edit'],
		slug: 'class',
		cols: [{
			name: 'Code',
			prop: 'code'
		}, {
			name: 'Tutors',
			prop: function prop(x) {
				return x.tutors ? x.tutors.reduce(function (s, t) {
					s.push(t.name);
					return s;
				}, []).join(', ') : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.users.filter(function (u) {
					return u.admin;
				}).sort(function (u) {
					return u.name;
				}),
				config: {
					text: 'name',
					id: 'id',
					multiple: true,
					small: true,
					clearable: true

				}
			}
		}, {
			name: 'Number of Students',
			prop: function prop(x) {
				return x.users ? x.users.length : 0;
			}
		}]
	};

	$scope.productsDataTable = {
		items: $scope.type.products,
		buttons: ['view', 'edit'],
		slug: 'product',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Quantity',
			prop: function prop(x) {
				return x.limitless ? 'N/A' : parseInt(x.pivot.quantity);
			}
		}, {
			name: 'Days',
			prop: function prop(x) {
				return parseInt(x.pivot.days_allowed);
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('classEditCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Group", function ($scope, $stateParams, $store, $location, $invalidate, Group) {
	$scope.group = _.clone($store.get('groups', $stateParams.id));
	$scope.users = $store.users;
	$scope.types = $store.group_types;
	$scope.type = $scope.group.type ? $store.get('group_types', $scope.group.type.id) : null;
	$scope.tutors = $scope.group.tutors.length ? $scope.group.tutors : [null];
	$scope.staff = $scope.users.filter(function (u) {
		return u.admin > 0;
	});

	if ($scope.groups) {
		$scope.groups = $scope.groups.map(function (g) {
			g._code_name = g.code + ' - ' + g.name;
			return g;
		});
	}

	$scope.addTutor = function () {
		$scope.tutors.push(null);
	};

	$scope.removeTutor = function (index) {
		$scope.tutors.splice(index, 1);

		if (!$scope.tutors.length) {
			$scope.addTutor();
		}
	};

	$scope.save = function () {
		$scope.group.group_type_id = $scope.group.type ? $scope.group.type.id : '';
		$scope.group.tutors = [];

		_.forEach($scope.tutors, function (tutor) {
			if (tutor !== null && tutor.id) {
				$scope.group.tutors.push({ id: tutor.id });
			}
		});

		Group.update({ id: $scope.group.id }, $scope.group).$promise.then(function (res) {
			$invalidate.add(['groups', 'users']);

			$location.path('/class/' + $scope.group.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.groups,
		buttons: ['view', 'edit'],
		slug: 'class',
		cols: [{
			name: 'Code',
			prop: 'code'
		}, {
			name: 'Type',
			prop: function prop(x) {
				return x.type ? x.type.code : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.group_types,
				config: {
					text: 'code',
					id: 'id',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}, {
			name: 'Tutors',
			prop: function prop(x) {
				return x.tutors ? x.tutors.reduce(function (s, t) {
					s.push(t.name);
					return s;
				}, []).join(', ') : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.users.filter(function (u) {
					return u.admin;
				}).sort(function (u) {
					return u.name;
				}),
				config: {
					text: 'name',
					id: 'id',
					multiple: true,
					small: true,
					clearable: true

				}
			}
		}, {
			name: 'Number of students',
			prop: function prop(x) {
				return x.users ? x.users.length : 0;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('classNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Group", function ($scope, $stateParams, $store, $location, $invalidate, Group) {
	var type = $stateParams.type;
	var code = $stateParams.code;

	$scope.users = $store.users;
	$scope.types = $store.group_types;
	$scope.type = null;
	$scope.tutors = [null];
	$scope.staff = $scope.users.filter(function (u) {
		return u.admin > 0;
	});

	if (type) $scope.type = $store.get('group_types', { code: type });
	if (code) {
		$scope.code = code;
		$store.group_types.forEach(function (gt) {
			if (code.indexOf(gt.code) !== -1) {
				$scope.type = gt;
			}
		});
	}

	$scope.tutorRole = function (value, index, array) {
		return value.admin > 0;
	};

	$scope.addTutor = function () {
		$scope.tutors.push(null);
	};

	$scope.removeTutor = function (index) {
		$scope.tutors.splice(index, 1);

		if (!$scope.tutors.length) {
			$scope.addTutor();
		}
	};

	$scope.save = function () {
		var g = new Group();

		g.code = $scope.code;
		g.group_type_id = $scope.type ? $scope.type.id : '';

		g.tutors = [];

		_.forEach($scope.tutors, function (tutor) {
			if (tutor !== null && tutor.id) {
				g.tutors.push(tutor.id);
			}
		});

		g.$save().then(function (res) {
			$invalidate.add(['groups', 'users']);

			$location.path('/class');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('classViewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "$q", "Group", "User", "sweetAlert", function ($scope, $stateParams, $store, $location, $invalidate, $q, Group, User, sweetAlert) {
	$scope.group = $store.get('groups', $stateParams.id);

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.group.$delete().then(function () {
				$invalidate.add('groups');

				$location.path('/class');
			});
		});
	};

	$scope.retire = function () {
		sweetAlert.swal({
			text: 'This will set this class as inactive, as well as all students in this class',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			var promises = [];
			$scope.loading = true;

			$scope.group.active = false;
			var groupPromise = Group.update({ id: $scope.group.id }, $scope.group).$promise;

			$scope.group.users.forEach(function (u) {
				u.active = false;
				var userPromise = User.update({ id: u.id }, u).$promise;

				promises.push(userPromise);
			});

			promises.push(groupPromise);

			$q.all(promises).then(function (res) {
				$invalidate.add('users', 'groups', 'group_types');
				$location.path('/class');
			});
		});
	};

	$scope.reactivate = function () {
		sweetAlert.swal({
			text: 'This will set this class as active, as well as all students in this class',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			var promises = [];
			$scope.loading = true;

			$scope.group.active = true;
			var groupPromise = Group.update({ id: $scope.group.id }, $scope.group).$promise;

			$scope.group.users.forEach(function (u) {
				u.active = true;
				var userPromise = User.update({ id: u.id }, u).$promise;

				promises.push(userPromise);
			});

			promises.push(groupPromise);

			$q.all(promises).then(function (res) {
				$invalidate.add('users', 'groups', 'group_types');
				$location.path('/class');
			});
		});
	};

	$scope.dataTable = {
		items: $scope.group.users,
		buttons: ['view', 'edit'],
		slug: 'user',
		cols: [{
			name: 'ID Number',
			prop: 'id_number'
		}, {
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Email',
			prop: 'email'
		}, {
			name: 'Phone',
			prop: 'phone'
		}, {
			name: 'DOB',
			prop: function prop(x) {
				return x.dob ? moment(x.dob).format('YYYY-MM-DD') + (isNaN(x._age) ? '' : ' (' + parseInt(x._age) + ')') : '';
			}
		}, {
			name: 'Can Book',
			prop: function prop(x) {
				return x.can_book ? 'Yes' : 'No';
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('kitEditCtrl', ["$scope", "$store", "$stateParams", "$location", "$load", "$invalidate", "Kit", function ($scope, $store, $stateParams, $location, $load, $invalidate, Kit) {

	$scope.selectedProducts = [{ quantity: 1 }];
	$scope.products = $store.products;
	$scope.kit = $load.kit($stateParams.id);

	$scope.kit.$promise.then(function (k) {
		$scope.selectedProducts = k.products.map(function (p) {
			var o = { quantity: p.pivot.quantity };

			o.product = $store.get('products', p.id);

			return o;
		});
	});

	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.addProduct = function () {
		$scope.selectedProducts.push({ quantity: 1 });
	};

	$scope.removeProduct = function (product, index) {
		$scope.selectedProducts.splice(index, 1);

		if (!$scope.selectedProducts.length) {
			$scope.addProduct();
		}
	};

	$scope.save = function () {
		$scope.kit.items = $scope.selectedProducts;

		$scope.kit.$update(function (res) {
			$invalidate.add('kits');
			$location.path('/kit');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('kitManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.kits,
		buttons: ['view', 'edit'],
		slug: 'kit',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Number of Products',
			prop: function prop(x) {
				return x.products ? x.products.length : 0;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('kitNewCtrl', ["$scope", "$store", "$location", "$invalidate", "Kit", function ($scope, $store, $location, $invalidate, Kit) {

	$scope.selectedProducts = [{ quantity: 1 }];
	$scope.products = $store.products;
	$scope.kit = new Kit();

	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.addProduct = function () {
		$scope.selectedProducts.push({ quantity: 1 });
	};

	$scope.removeProduct = function (product, index) {
		$scope.selectedProducts.splice(index, 1);

		if (!$scope.selectedProducts.length) {
			$scope.addProduct();
		}
	};

	$scope.save = function () {

		$scope.kit.items = $scope.selectedProducts;

		$scope.kit.$save(function (res) {
			$invalidate.add('kits');
			$location.path('/kit');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('kitViewCtrl', ["$scope", "$stateParams", "$store", "$invalidate", "$location", "sweetAlert", function ($scope, $stateParams, $store, $invalidate, $location, sweetAlert) {
	$scope.kit = $store.get('kits', $stateParams.id);

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.kit.$delete().then(function () {
				$invalidate.add('kits');

				$location.path('/kit');
			});
		});
	};

	$scope.dataTable = {
		items: $scope.kit.products,
		buttons: ['view', 'edit'],
		slug: 'product',
		cols: [{
			name: 'Product',
			prop: 'name'
		}, {
			name: 'Quantity',
			prop: function prop(x) {
				return x.limitless ? 'N/A' : x.pivot.quantity;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('manageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.user = $store.user;
	$scope.store = $store;
}]);
'use strict';

angular.module('app.controllers').controller('productTypeEditCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Product_Type", function ($scope, $stateParams, $store, $location, $invalidate, Product_Type) {
	$scope.type = _.clone($store.get('product_types', $stateParams.id));

	$scope.save = function () {
		Product_Type.update({ id: $scope.type.id }, $scope.type).$promise.then(function (res) {
			$invalidate.add('product_types');

			$location.path('/product-type/' + $scope.type.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('productTypeManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.product_types,
		buttons: ['view', 'edit'],
		slug: 'product-type',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Number of products',
			prop: function prop(x) {
				return x.products ? x.products.length : 0;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('productTypeNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Product_Type", function ($scope, $stateParams, $store, $location, $invalidate, Product_Type) {
	$scope.save = function () {
		var pt = new Product_Type();

		pt.code = $scope.code;
		pt.name = $scope.name;

		pt.$save().then(function (res) {
			$invalidate.add('product_types');

			$location.path('/product-type');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('productTypeViewCtrl', ["$scope", "$stateParams", "$store", "$invalidate", "$location", "sweetAlert", function ($scope, $stateParams, $store, $invalidate, $location, sweetAlert) {
	$scope.type = $store.get('product_types', $stateParams.id);

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.type.$delete().then(function () {
				$invalidate.add('product_types');

				$location.path('/product-type');
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('productEditCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Product", function ($scope, $stateParams, $store, $location, $invalidate, Product) {
	$scope.product = $store.get('products', $stateParams.id);

	$scope.types = $store.product_types;
	$scope.type = $scope.product.type ? $store.get('product_types', $scope.product.type.id) : null;

	$scope.save = function () {
		$scope.product.product_type_id = $scope.type ? $scope.type.id : '';
		console.log('type id', $scope.product.type_id);

		Product.update({ id: $scope.product.id }, $scope.product).$promise.then(function (res) {
			$invalidate.add('products');

			$location.path('/product/' + $scope.product.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('productManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.products,
		buttons: ['view', 'edit'],
		slug: 'product',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Type',
			prop: function prop(x) {
				return x.type ? x.type.name : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.product_types,
				config: {
					text: 'name',
					id: 'id',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}, {
			name: 'Number of units',
			prop: function prop(x) {
				return x.units ? x.units.length : 0;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('productNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Product", function ($scope, $stateParams, $store, $location, $invalidate, Product) {
	var type = $stateParams.type;

	$scope.types = $store.product_types;
	$scope.type = type ? $store.get('product_types', { name: type }) : null;
	$scope.name = $stateParams.name || '';

	$scope.save = function () {
		var p = new Product();

		p.name = $scope.name;
		p.product_type_id = $scope.type ? $scope.type.id : '';
		p.limitless = $scope.limitless;

		p.$save().then(function (res) {
			$invalidate.add('products');

			$location.path('/product');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('productViewCtrl', ["$scope", "$stateParams", "$state", "$store", "$location", "$invalidate", "sweetAlert", function ($scope, $stateParams, $state, $store, $location, $invalidate, sweetAlert) {
	$scope.product = $store.get('products', $stateParams.id);

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.product.$delete().then(function () {
				$invalidate.add(['products', 'product_types', 'units']);

				$location.path('/product');
			});
		});
	};

	$scope.unitsDataTable = {
		items: $scope.product.units,
		buttons: ['view', 'edit'],
		slug: 'unit',
		orderBys: [function (x) {
			return parseInt(x['Unit No.']);
		}],
		cols: [{
			name: 'Unit No.',
			prop: 'unit_number'
		}, {
			name: 'Serial No.',
			prop: 'serial_number'
		}, {
			name: 'Asset No.',
			prop: 'asset_number'
		}]
	};

	$scope.classTypesDataTable = {
		items: $scope.product.group_types,
		buttons: ['view', 'edit'],
		slug: 'class_type',
		cols: [{
			name: 'Code',
			prop: 'code',
			filter: {
				type: 'dropdown2',
				items: $store.group_types,
				config: {
					text: 'code',
					id: 'id',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}, {
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Quantity allowed',
			prop: function prop(x) {
				return $scope.product.limitless ? 'N/A' : x.pivot.quantity;
			}
		}, {
			name: 'Days allowed',
			prop: function prop(x) {
				return x.pivot.days_allowed;
			}
		}]
	};

	$scope.kitsDataTable = {
		items: $scope.product.kits,
		buttons: ['view', 'edit'],
		slug: 'kit',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Quantity',
			prop: function prop(x) {
				return $scope.product.limitless ? 'N/A' : x.pivot.quantity;
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('unitEditCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Unit", function ($scope, $stateParams, $store, $location, $invalidate, Unit) {
	$scope.products = $store.products;

	$scope.unit = _.clone($store.get('units', $stateParams.id));
	$scope.product = $scope.unit.product ? $store.get('products', $scope.unit.product.id) : null;

	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.save = function () {
		$scope.unit.product_id = $scope.product ? $scope.product.id : '';

		Unit.update({ id: $scope.unit.id }, $scope.unit).$promise.then(function (res) {
			$invalidate.add('units');

			$location.path('/unit/' + $scope.unit.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('unitExportCtrl', ["$scope", "$http", function ($scope, $http) {

	$http.get('/api/export/units').then(function (res) {
		$scope.csv = res.data;
	});
}]);
'use strict';

angular.module('app.controllers').controller('unitImportCtrl', ["$scope", "$q", "$invalidate", "$store", "$location", "$csv", "$xlsx", "sweetAlert", "Unit", function ($scope, $q, $invalidate, $store, $location, $csv, $xlsx, sweetAlert, Unit) {

	$scope.units = [];
	$scope.errors = [];
	$scope.skips = [];
	$scope.loader = {};
	$scope.reloading = false;

	function getValue(cols, line, col) {
		var index = _.indexOf(cols, col);

		return line[index];
	}

	$scope.reload = function () {
		$scope.reloading = true;
		$invalidate.add('products');

		$q.all($invalidate.load()).then(function () {
			if ($scope.loader.load) $scope.loader.load();
			$scope.reloading = false;
		});
	};

	$scope.encode = function (s) {
		return encodeURIComponent(s);
	};

	$scope.$watch('units', function (newVal, oldVal) {
		$scope.calculateErrors();
	}, true);

	$scope.calculateErrors = function () {
		var errors = [];

		$scope.units.filter(function (u) {
			return u._add;
		}).forEach(function (unit) {
			if (unit._noproduct) {
				var error = _.find(errors, { message: 'Product "' + unit._noproduct + '" not found' });

				if (!error) {
					errors.push({ message: 'Product "' + unit._noproduct + '" not found', count: 1, type: 'product', product_name: unit._noproduct });
				} else {
					error.count++;
				}
			}
		});

		$scope.errors = errors;
	};

	$scope.loader.loaded = function (file, type) {
		var data;

		if (file && type == 'csv') {
			data = $csv.parse(file);
		} else if (file && type == 'xlsx') {
			data = $xlsx.parse(file);
		}

		// remove blank lines
		data = data.filter(function (r) {
			return r.unit_number !== '';
		});

		$scope.units = [];
		$scope.skips = [];

		data.forEach(function (row) {
			var unit = new Unit();

			// standard stuff
			unit.unit_number = row.unit_number;
			unit.serial_number = row.serial_number;
			unit.asset_number = row.asset_number;
			unit._add = true;

			// product stuff
			var product = $store.get('products', { name: row.product_name });

			if (product) {
				unit._product = product;
				unit.product_id = unit._product.id;

				var unitExists = product.units.find(function (u) {
					return u.unit_number == unit.unit_number || u.serial_number == unit.serial_number || u.asset_number == unit.asset_number;
				});

				if (unitExists) {
					$scope.skips.push(unit);

					return;
				}
			} else {
				unit._noproduct = row.product_name;
			}

			$scope.units.push(unit);
		});
	};

	$scope.import = function () {
		if (!$scope.units.length) return;

		if ($scope.errors.length) {
			sweetAlert.swal({
				titleText: 'Unresolved Issues',
				html: 'Do you still want to import all these units?',
				showCancelButton: true,
				cancelButtonText: "I'll fix the issues",
				confirmButtonText: "Yeah it's fine"
			}).then(go);
		} else {
			sweetAlert.swal({
				titleText: 'Good to go',
				html: 'You are about to import <b>' + $scope.units.filter(function (u) {
					return u._add;
				}).length + '</b> ' + ($scope.units.filter(function (u) {
					return u._add;
				}).length == 1 ? ' unit' : ' units'),
				showCancelButton: true,
				cancelButtonText: "Not yet",
				confirmButtonText: "Sweet let's do it"
			}).then(go);
		}

		function go() {
			var promises = $scope.units.filter(function (u) {
				return u._add;
			}).map(function (u) {
				return u.$save().$promise;
			});

			$q.all(promises).then(function (values) {
				$invalidate.add('units');
				$location.path('/unit');
			});
		}
	};

	$scope.checkedUnits = function () {
		return $scope.units.filter(function (u) {
			return u._add;
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('unitManageCtrl', ["$scope", "$store", function ($scope, $store) {
	$scope.dataTable = {
		items: $store.units,
		buttons: ['view', 'edit'],
		slug: 'unit',
		orderBys: [function (x) {
			return x['product_id'];
		}, function (x) {
			return parseInt(x['Unit No.']);
		}],
		additionalProps: [{
			name: 'product_id',
			prop: function prop(x) {
				return x.product ? x.product.id : '';
			}
		}],
		cols: [{
			name: 'Product',
			prop: function prop(x) {
				return x.product ? x.product.name : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.products,
				config: {
					text: 'name',
					id: 'name',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}, {
			name: 'Unit No.',
			prop: 'unit_number'
		}, {
			name: 'Serial No.',
			prop: 'serial_number'
		}, {
			name: 'Asset No.',
			prop: 'asset_number'
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('unitNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Unit", function ($scope, $stateParams, $store, $location, $invalidate, Unit) {
	$scope.products = $store.products;
	var product_id = $stateParams.product;

	$scope.product = product_id ? $store.get('products', product_id) : null;

	$scope.product_type = function (product) {
		return product.type ? product.type.name : '';
	};

	$scope.save = function () {
		var u = new Unit();

		u.serial_number = $scope.serial_number;
		u.asset_number = $scope.asset_number;
		u.unit_number = $scope.unit_number;
		u.product_id = $scope.product.id;
		u.notes = $scope.notes;

		u.$save().then(function (res) {
			$invalidate.add('units');

			$location.path('/unit');
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('unitViewCtrl', ["$scope", "$stateParams", "$state", "$store", "$load", "$prepare", "$invalidate", "$location", "sweetAlert", function ($scope, $stateParams, $state, $store, $load, $prepare, $invalidate, $location, sweetAlert) {
	window.$scope = $scope;
	$scope.unit = $load.unit($stateParams.id, { with: 'bookings' });

	$scope.unit.$promise.then(function (u) {
		u._bookings = $prepare.bookings(u.bookings);
	}).then(function () {
		$scope.dataTable = {
			items: $scope.unit.bookings,
			buttons: ['view', 'edit'],
			slug: 'booking',
			cols: [{
				name: 'User',
				prop: function prop(x) {
					return x.user.name;
				}
			}, {
				name: 'Issued',
				prop: function prop(x) {
					return x.taken_at ? moment(x.taken_at).format('YYYY-MM-DD') : '';
				}
			}, {
				name: 'Returned',
				prop: function prop(x) {
					return x.pivot.returned_at ? moment(x.pivot.returned_at).format('YYYY-MM-DD') : '';
				}
			}, {
				name: 'Notes',
				prop: function prop(x) {
					return x.pivot.notes;
				}
			}]
		};
	});

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.unit.$delete().then(function () {
				$invalidate.add(['units', 'products']);

				$location.path('/unit');
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userEditNoteCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "Note", function ($scope, $stateParams, $store, $location, $invalidate, Note) {

	$scope.user = _.clone($store.get('users', $stateParams.id));
	// $scope.note = _.find($scope.user.notes, (note) => note.id == $stateParams.id2)
	$scope.note = $store.get('notes', $stateParams.id2);

	if (!$scope.note) $location.path('/user/' + $scope.user.id);

	$scope.save = function () {
		Note.update({ id: $scope.note.id }, $scope.note).$promise.then(function () {
			$invalidate.add('notes');

			$location.path('/user/' + $scope.user.id);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userEditCtrl', ["$scope", "$stateParams", "$state", "$store", "$location", "$invalidate", "User", function ($scope, $stateParams, $state, $store, $location, $invalidate, User) {

	$scope.roles = [{ level: 0, text: 'Student' }, { level: 1, text: 'Staff' }, { level: 2, text: 'Manager' }];

	$scope.errors = [];

	if ($state.current.data.edit_profile) {
		$scope.user = _.clone($store.user);
		$scope.profileMode = true;
	} else {
		$scope.user = _.clone($store.get('users', $stateParams.id));
		$scope.you = $store.user;
	}

	$scope.curUser = $store.user;

	if ($scope.curUser.admin < 2 && $scope.user.admin > 0 && $scope.user.id !== $scope.curUser.id) {
		$location.path('/user');
	}

	if ($scope.user.admin == 1 && $scope.user.group && !$scope.user.group._isTutor($store.user.id)) {
		$location.path('/user');
	}

	$scope.groups = $store.groups.filter(function (g) {
		return g.active;
	});

	if ($store.user.admin === 1) {
		$scope.groups = $store.user.tutors_groups;
	}

	$scope.group = $scope.user.group ? $store.get('groups', $scope.user.group.id) : null;

	$scope.role = _.find($scope.roles, function (r) {
		return r.level == $scope.user.admin;
	});

	$scope.save = function () {
		if ($scope.password !== $scope.confirm_password) {
			$scope.errors.push({
				message: 'The passwords do not match'
			});
			return;
		} else {
			$scope.user.password = $scope.password;
		}

		$scope.user.group_id = $scope.group ? $scope.group.id : '';
		$scope.user.admin = $scope.role.level;

		console.log(JSON.stringify($scope.user));

		User.update({ id: $scope.user.id }, $scope.user).$promise.then(function (res) {
			if ($store.user.admin) {
				$invalidate.add(['users', 'groups']);
			} else {
				$invalidate.add(['groups']);
			}

			$location.path('/user/' + $scope.user.id);
		}, function (res) {
			$scope.errors.push({
				message: res.data.error
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userExportCtrl', ["$scope", "$http", function ($scope, $http) {

	$http.get('/api/export/users').then(function (res) {
		$scope.csv = res.data;
	});
}]);
'use strict';

angular.module('app.controllers').controller('userImportCtrl', ["$scope", "$q", "$invalidate", "$store", "$location", "$csv", "$xlsx", "sweetAlert", "User", function ($scope, $q, $invalidate, $store, $location, $csv, $xlsx, sweetAlert, User) {

	$scope.users = [];
	$scope.errors = [];
	$scope.skips = [];
	$scope.loader = {};
	$scope.reloading = false;

	function getValue(cols, line, col) {
		var index = _.indexOf(cols, col);

		return line[index];
	}

	$scope.reload = function () {
		$scope.reloading = true;
		$invalidate.add('groups');

		$q.all($invalidate.load()).then(function () {
			if ($scope.loader.load) $scope.loader.load();
			$scope.reloading = false;
		});
	};

	$scope.$watch('users', function (newVal, oldVal) {
		$scope.calculateErrors();
	}, true);

	$scope.calculateErrors = function () {
		var errors = [];

		$scope.users.filter(function (u) {
			return u._add;
		}).forEach(function (user) {
			if (user._nogroup) {
				var error = _.find(errors, { message: 'Class "' + user._nogroup + '" not found' });

				if (!error) {
					errors.push({ message: 'Class "' + user._nogroup + '" not found', count: 1, type: 'group', group_code: user._nogroup });
				} else {
					error.count++;
				}
			}
		});

		$scope.errors = errors;
	};

	$scope.loader.loaded = function (file, type) {
		var data;

		if (file && type == 'csv') {
			data = $csv.parse(file);
		} else if (file && type == 'xlsx') {
			data = $xlsx.parse(file);
		}

		$scope.users = [];
		$scope.skips = [];

		data.forEach(function (row) {
			var user = new User();

			// standard stuff
			if (row['Full Name']) {
				user.name = row['Full Name'];
			} else {
				user.name = row['Preferred Name (Student) (Contact)'] + ' ' + row['Last Name (Student) (Contact)'];
			}

			user.email = row['Email (Student) (Contact)'];
			user.phone = row['Mobile Phone (Student) (Contact)'];
			user.id_number = row['Take2 ID (Student) (Contact)'];
			user.password = 'Yoobee01';
			user._add = true;

			if (row.Admin) {
				user.admin = row.Admin;
			}

			// date stuff
			var date = row['Date of Birth - New (Student) (Contact)'];

			if (type == 'xlsx') {
				if (date.indexOf('/') !== -1) {
					user.dob = moment(date, 'MM-DD-YYYY')._d;
				} else {
					date = XLSX.SSF.parse_date_code(date);
					user.dob = new Date([date.y, date.m, date.d].join('-'));
				}
			} else {
				user.dob = moment(date, 'DD-MM-YYYY')._d;
			}

			// group stuff
			var group = $store.get('groups', { code: row.Intake });

			if (group) {
				user._group = group;
				user.group_id = user._group.id;
			} else {
				user._nogroup = row.Intake;
			}

			// skip stuff
			var userExists = $store.users.find(function (u) {
				return u.id_number == user.id_number;
			});

			if (userExists) {
				$scope.skips.push(user);

				return;
			}

			$scope.users.push(user);
		});
	};

	$scope.import = function () {
		if (!$scope.users.length) return;

		if ($scope.errors.length) {
			sweetAlert.swal({
				titleText: 'Unresolved Issues',
				html: 'Do you still want to import all these users?',
				showCancelButton: true,
				cancelButtonText: "I'll fix the issues",
				confirmButtonText: "Yeah it's fine"
			}).then(go);
		} else {
			sweetAlert.swal({
				titleText: 'Good to go',
				html: 'You are about to import <b>' + $scope.users.filter(function (u) {
					return u._add;
				}).length + '</b> ' + ($scope.users.filter(function (u) {
					return u._add;
				}).length == 1 ? ' user' : ' users'),
				showCancelButton: true,
				cancelButtonText: "Not yet",
				confirmButtonText: "Sweet let's do it"
			}).then(go);
		}

		function go() {
			var promises = $scope.users.filter(function (u) {
				return u._add;
			}).map(function (u) {
				return u.$save().$promise;
			});

			$q.all(promises).then(function (values) {
				$invalidate.add('users');
				$location.path('/user');
			});
		}
	};

	$scope.checkedUsers = function () {
		return $scope.users.filter(function (u) {
			return u._add;
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userManageCtrl', ["$scope", "$store", "$location", function ($scope, $store, $location) {
	$scope.dataTable = {
		items: $store.users,
		buttons: ['view', 'edit'],
		slug: 'user',
		cols: [{
			name: 'Name',
			prop: 'name'
		}, {
			name: 'Role',
			prop: '_role',
			filter: {
				type: 'dropdown2',
				items: [{ name: 'Manager' }, { name: 'Staff' }, { name: 'Student' }],
				config: {
					text: 'name',
					id: 'name',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}, {
			name: 'Class',
			prop: function prop(x) {
				return x.group ? x.group.code : '';
			},
			filter: {
				type: 'dropdown2',
				items: $store.groups,
				config: {
					text: 'code',
					id: 'code',
					multiple: true,
					small: true,
					clearable: true
				}
			}
		}]
	};
}]);
'use strict';

angular.module('app.controllers').controller('userNewNoteCtrl', ["$scope", "$stateParams", "$store", "$location", "$invalidate", "User", "Note", function ($scope, $stateParams, $store, $location, $invalidate, User, Note) {

	$scope.content = '';
	$scope.user = _.clone($store.get('users', $stateParams.id));

	$scope.save = function () {
		var n = new Note();

		n.content = $scope.content;
		n.user_id = $scope.user.id;

		n.$save().then(function (res) {
			$invalidate.add('notes');

			$location.path('/user/' + $scope.user.id);
		}).catch(function (res) {
			console.log('save err', res);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userNewCtrl', ["$scope", "$stateParams", "$store", "$location", "$auth", "$invalidate", "User", function ($scope, $stateParams, $store, $location, $auth, $invalidate, User) {
	var group = $stateParams['class'];

	$scope.roles = [{ level: 0, text: 'Student' }, { level: 1, text: 'Staff' }, { level: 2, text: 'Manager' }];

	$scope.groups = $store.groups;
	$scope.user = $store.user;
	$scope.errors = [];

	if ($store.user.admin === 1) {
		$scope.groups = $store.user.tutors_groups;
	}

	$scope.group = $stateParams['class'] ? $store.get('groups', { code: group }) : null;
	$scope.role = $scope.roles[0];

	$scope.save = function () {
		if ($scope.password !== $scope.confirm_password) {
			$scope.errors.push({
				message: 'The passwords do not match'
			});
			return;
		}

		if (!$scope.password) {
			$scope.errors.push({
				message: 'You need to set a password'
			});
			return;
		}

		var u = new User();

		u.dob = $scope.dob;
		u.name = $scope.name;
		u.email = $scope.email;
		u.phone = $scope.phone;
		u.group_id = $scope.group ? $scope.group.id : '';
		u.password = $scope.password;
		u.id_number = $scope.id_number;
		u.admin = $scope.role ? $scope.role.level : 0;

		u.$save().then(function (res) {
			$invalidate.add(['groups', 'users']);

			$location.path('/user');
		}).catch(function (res) {
			console.log('save err', res);
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userViewNoteCtrl', ["$scope", "$stateParams", "$store", "$invalidate", "$location", "Note", "sweetAlert", function ($scope, $stateParams, $store, $invalidate, $location, Note, sweetAlert) {

	$scope.user = _.clone($store.get('users', $stateParams.id));
	$scope.note = $store.get('notes', $stateParams.id2);

	$scope.notes = $store.notes;

	$scope.dateify = function (str) {
		return new Date(str);
	};

	$scope.deleteNote = function (note) {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			Note.delete({ id: note.id }).$promise.then(function () {
				$invalidate.add('notes');
				$location.path('/user/' + $scope.user.id);
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('userViewCtrl', ["$scope", "$stateParams", "$store", "$invalidate", "$location", "Note", "User", "sweetAlert", function ($scope, $stateParams, $store, $invalidate, $location, Note, User, sweetAlert) {
	$scope.user = $store.get('users', $stateParams.id);
	$scope.you = $store.user;

	if ($scope.user.admin == 1 && $scope.user.group && !$scope.user.group._isTutor($store.user.id)) {
		$location.path('/user');
	}

	$scope.filterOutRevisions = function (note) {
		var isOld = false;

		_.forEach($scope.user.notes, function (n) {
			if (note.id == n.revision_of) isOld = true;
		});

		return isOld;
	};

	$scope.delete = function () {
		sweetAlert.swal({
			text: 'Are you sure you want to delete this?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			$scope.user.$delete().then(function () {
				$invalidate.add(['users', 'groups', 'bookings']);

				$location.path('/user');
			});
		});
	};

	$scope.deleteNote = function (note) {
		sweetAlert.swal({
			text: 'Are you sure you want to delete that note?',
			showCancelButton: true,
			type: 'warning'
		}).then(function () {
			Note.delete({ id: note.id }).$promise.then(function () {
				$store.notes = _.reject($scope.user.notes, function (n) {
					return n.id == note.id;
				});
			});
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('homeCtrl', ["$scope", "$store", "$load", "$prepare", "$stateParams", "$timeout", "Booking", function ($scope, $store, $load, $prepare, $stateParams, $timeout, Booking) {
	$scope.user = $store.user;
	$scope.bookings = [];
	$scope.loading = true;

	$scope.bookings = Booking.query({ user_id: $store.user.id });

	$scope.bookings.$promise.then($prepare.bookings).then(function (res) {
		return $scope.loading = false;
	});

	$scope.statuses = [{ text: 'Closed' }, { text: 'Overdue' }, { text: 'Issued' }, { text: 'Booked' }];

	$scope.dayFilters = [{ text: 'Tomorrow' }, { text: 'Today' }, { text: 'Yesterday' }];

	$scope.dayFormatter = function (date) {
		if (!date) return '';

		var suffix = '';
		var target = moment(date);
		var today = moment();
		var tomorrow = moment().add(1, 'd');
		var yesterday = moment().subtract(1, 'd');

		if (target.isSame(tomorrow, 'day')) {
			suffix = 'Tomorrow';
		} else if (target.isSame(today, 'day')) {
			suffix = 'Today';
		} else if (target.isSame(yesterday, 'day')) {
			suffix = 'Yesterday';
		}

		if (suffix) suffix = ' (' + suffix + ')';

		return target.format('YYYY-MM-DD') + suffix;
	};

	$scope.dataTable = {
		items: $scope.bookings,
		buttons: ['view'],
		slug: 'booking',
		orderBys: [],
		cols: [{
			name: 'Pickup',
			// prop: x => x.pickup_at ? moment(x.pickup_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.pickup_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Issued',
			// prop: x => x.taken_at ? moment(x.taken_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.taken_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Due',
			// prop: x => x.due_at ? moment(x.due_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.due_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Closed',
			// prop: x => x.closed_at ? moment(x.closed_at).format('MMM Do') : '',
			prop: function prop(x) {
				return $scope.dayFormatter(x.closed_at);
			},
			filter: {
				type: 'dropdown2',
				items: $scope.dayFilters,
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}, {
			name: 'Status',
			prop: '_status',
			indicator: function indicator(x) {
				if (x.Status === 'Booked') return '#2ECC71';
				if (x.Status === 'Issued') return '#F39C12';
				if (x.Status === 'Overdue') return '#E74C3C';
				if (x.Status === 'Closed') return '#7F8C8D';
			},
			filter: {
				type: 'dropdown2',
				items: $scope.statuses,
				value: [$scope.statuses[1], $scope.statuses[2], $scope.statuses[3]],
				config: {
					text: 'text',
					id: 'text',
					multiple: true,
					small: true
				}
			}
		}]
	};
}]);
'use strict';

// https://github.com/HackedByChinese/ng-idle

var idleTimeout = 5; // this is how long (in seconds) to give warning for

angular.module('app.controllers').config(["IdleProvider", "KeepaliveProvider", function (IdleProvider, KeepaliveProvider) {
	// configure Idle settings
	IdleProvider.idle(15 * 60); // in seconds (15 minutes)
	IdleProvider.timeout(idleTimeout);
	KeepaliveProvider.interval(2); // in seconds (2 seconds)
}]).run(["$auth", "Idle", function ($auth, Idle) {
	// start watching when the app runs. also starts the Keepalive service by default.

	// only start watching if the user is currently logged in
	if ($auth.isAuthenticated()) {
		Idle.watch();
	}
}]).controller('idleCtrl', ["$scope", "$location", "$state", "$http", "$store", "$auth", "Idle", function ($scope, $location, $state, $http, $store, $auth, Idle) {

	window.$state = $state;

	setInterval(function () {
		if (!$state.$current.self.data) return;
		if (!$auth.isAuthenticated() && $state.$current.self.data.conditions.indexOf('auth') !== -1) {
			$location.path('login');
		}
	}, 1000);

	$scope.$on('IdleStart', function () {
		// the user appears to have gone idle
		// console.log('IdleStart')
	});

	$scope.$on('IdleWarn', function (e, countdown) {
		// follows after the IdleStart event, but includes a countdown until the user is considered timed out
		// the countdown arg is the number of seconds remaining until then.
		// you can change the title or display a warning dialog from here.
		// you can let them resume their session by calling Idle.watch()
		$scope.$apply(function () {
			$scope.showWarnDialog(countdown);
		});
	});

	$scope.$on('IdleTimeout', function () {
		// the user has timed out (meaning idleDuration + timeout has passed without any activity)
		// this is where you'd log them

		$auth.logout().then(function () {
			$scope.hideDialog();
			$store.user = {};
			$store.resetBooking();
			$http.get('/api/logout');
			$location.path('login');
		});
	});

	$scope.$on('IdleEnd', function () {
		// the user has come back from AFK and is doing stuff. if you are warning them, you can use this to hide the dialog
		$scope.$apply(function () {
			$scope.hideDialog();
		});
	});

	$scope.$on('Keepalive', function () {
		// do something to keep the user's session alive
		// console.log('Keepalive')
	});

	$scope.dialog = {
		show: false,
		title: '',
		text: '',
		progressBar: 100
	};

	$scope.showWarnDialog = function (countdown) {
		var progressScaler = scale().domain(1, idleTimeout).range(0, 100);

		$scope.dialog.show = true;
		$scope.dialog.title = 'You are idle';
		$scope.dialog.text = 'You will be logged out in <strong>' + countdown + '</strong> seconds';
		$scope.dialog.progressBar = progressScaler(countdown);
	};

	$scope.hideDialog = function () {
		$scope.dialog.show = false;
	};
}]);

// https://gist.github.com/dsuket/51129efc9f20b9a0dd18
/**
Usage:
```javascript
	var userScale = scale()
		.domain(0, 10)
		.range(0,100);
	userScale(2);
	// => 20

	userScale.range(100, 0);
	userScale(2);
	// => 80
```
*/
function scale() {
	var domain = [];
	var range = [];

	var _scale = function _scale(x) {
		if (domain.length < 2) {
			return _scale;
		}
		if (range.length < 2) {
			return _scale;
		}

		x = Math.max(x, domain.min);
		x = Math.min(x, domain.max);
		var x2 = distance(domain[0], x);
		var rangeVal = x2 / domain.distance * range.distance;
		return range[0] + rangeVal;
	};
	function distance(x1, x2) {
		if (x1 instanceof Array) {
			x2 = x1[1];
			x1 = x1[0];
		}
		// return Math.max(x1, x2) - Math.min(x1, x2);
		return x2 - x1;
	}

	function initDistance(obj) {
		obj.distance = distance(obj);
		obj.min = Math.min.apply(Math, obj);
		obj.max = Math.max.apply(Math, obj);
		return obj;
	}
	_scale.domain = function () /* start, end */{
		domain = Array.prototype.slice.call(arguments, 0, 2);
		initDistance(domain);
		return _scale;
	};
	_scale.range = function () /* start, end */{
		range = Array.prototype.slice.call(arguments, 0, 2);
		initDistance(range);
		return _scale;
	};
	return _scale;
}
'use strict';

angular.module('app.controllers').controller('loginCtrl', ["$scope", "$auth", "$store", "$state", "$location", "$invalidate", "$load", "User", "Idle", function ($scope, $auth, $store, $state, $location, $invalidate, $load, User, Idle) {
	$scope.$watch('email', reset);
	$scope.$watch('password', reset);

	function reset() {
		$scope.error = '';
	}

	$scope.login = function () {
		if (!$scope.email || !$scope.password) {
			return false;
		}

		var credentials = {
			email: $scope.email,
			password: $scope.password
		};

		$auth.login(credentials).then(function (res) {
			$store.user = new User(res.data.user);

			$load.trigger('user', $store.user);

			$invalidate.all();

			Idle.watch();

			$location.path('/home');
		}).catch(function (res) {
			console.log(res.data);
			if (res.data.error == 'invalid_credentials') {
				$scope.error = 'Email or password is invalid.';
			} else if (res.data.error == 'user_is_inactive') {
				$scope.error = 'Your user account is marked as closed.';
			} else {
				$scope.error = 'Unknown error';
			}
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('resetCtrl', ["$scope", "$http", function ($scope, $http) {

	$scope.submit = function () {
		$http.post('/password/email', {
			email: $scope.email
		}).then(function (res) {
			$scope.message = 'Password Reset email sent. Please check your inbox.';
		});
	};
}]);
'use strict';

angular.module('app.controllers').controller('siteSettingsCtrl', ["$scope", "$store", "$q", "Setting", function ($scope, $store, $q, Setting) {

	$scope.tinymceOptions = {
		baseURL: '/components/tinymce/',
		menubar: false,
		statusbar: false,
		plugins: 'lists',
		toolbar: 'formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist'
	};

	$scope.settings = $store.settings;
	$scope.thinking = false;
	$scope.saved = false;

	$scope.$watch('settings', function (newVal) {
		$scope.saved = false;
	}, true);

	$scope.save = function () {
		var promises = [];
		$scope.thinking = true;

		$scope.settings.forEach(function (setting) {
			var promise = Setting.update({ id: setting.id }, setting).$promise;

			promise.then(function (res) {
				console.log(res);
			});

			promises.push(promise);
		});

		$q.all(promises).then(function () {
			$scope.thinking = false;
			$scope.saved = true;
			console.log('all saved');
		});
	};
}]);
'use strict';

// based on http://codepen.io/juliangarnier/pen/gmOwJX

Mousetrap.bindGlobal(['up up down down left right left right b a'], function () {
	window.konami = true;
	document.body.classList.add('konami-code');
	return false;
});

$(document).on('click', function (event) {
	if (window.konami) {
		if (event.clientX && event.clientY) {
			explode(event);
		}
	}
});

function explode(e) {
	var x = e.pageX;
	var y = e.pageY;
	var c = document.createElement('canvas');
	var ctx = c.getContext('2d');
	var ratio = window.devicePixelRatio;
	var particles = [];
	var rings = [];
	var colors = ['#FF1461', '#18FF92', '#5A87FF', '#FBF38C'];

	var options = {
		numParticles: 30,
		scale: 1,
		radiusMin: 60,
		radiusMax: 100,
		speedMin: 8,
		speedMax: 16,
		accel: 0.95,
		ringFade: 0.03,
		ringAccel: 20,
		ringAccelShrink: 0.8,
		ringMinAccel: 0.6,
		ringWidth: 1,
		gravity: 0
	};

	document.body.appendChild(c);

	var w = 600;
	var h = 600;

	c.style.position = 'absolute';
	c.style.left = x - w / 2 + 'px';
	c.style.top = y - h / 2 + 'px';
	c.style.pointerEvents = 'none';
	c.style.width = w + 'px';
	c.style.height = h + 'px';
	c.style.zIndex = 9999;
	c.width = w * ratio;
	c.height = h * ratio;

	for (var i = 0; ++i < options.numParticles + 1;) {
		particles.push({
			x: c.width / 2,
			y: c.height / 2,
			radius: r(options.radiusMin * options.scale, options.radiusMax * options.scale),
			color: colors[parseInt(Math.random() * colors.length)],
			rotation: r(0, 360, true),
			speed: r(options.speedMin * options.scale, options.speedMax * options.scale),
			yVel: 0,
			gravity: options.gravity * options.scale,
			accel: options.accel,
			shrink: 0.875
		});
	}

	rings.push({
		x: c.width / 2,
		y: c.height / 2,
		radius: 0,
		accel: options.ringAccel * options.scale,
		alpha: 1
	});

	function render() {
		ctx.clearRect(0, 0, c.width, c.height);

		rings.forEach(function (ring, i) {
			ring.radius += ring.accel;

			ring.accel -= options.ringAccelShrink * options.scale;

			if (ring.accel < options.ringMinAccel) ring.accel = options.ringMinAccel;

			ring.alpha -= options.ringFade;

			ctx.strokeStyle = 'rgba(0, 0, 0, ' + ring.alpha + ')';
			ctx.lineWidth = options.ringWidth * options.scale;

			ctx.beginPath();
			ctx.arc(ring.x, ring.y, ring.radius, 0, 2 * Math.PI, false);
			ctx.stroke();
		});

		particles.forEach(function (p, i) {
			p.radius *= p.shrink;

			if (p.radius < 0) return;

			var step = at.step(p.rotation, p.speed);

			p.x += step.x;
			p.y += step.y;

			p.speed *= p.accel;

			p.yVel += p.gravity;
			p.y += p.yVel;

			ctx.beginPath();
			ctx.fillStyle = p.color;
			ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI, false);
			ctx.fill();
		});
	}

	;(function renderLoop() {
		requestAnimationFrame(renderLoop);
		render();
	})();

	setTimeout(function () {
		document.body.removeChild(c);
	}, 1000);
}

var at = {
	angle: function angle(a, b) {
		return Math.atan2(b.y - a.y, b.x - a.x) / Math.PI * 180;
	},
	dist: function dist(a, b) {
		return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));
	},
	step: function step(a, s) {
		return { x: s * Math.cos(a * Math.PI / 180), y: s * Math.sin(a * Math.PI / 180) };
	}
};

function r(a, b, c) {
	return parseFloat((Math.random() * ((a ? a : 1) - (b ? b : 0)) + (b ? b : 0)).toFixed(c ? c : 0));
}
'use strict';

angular.module('app.resources').factory('Booking', ["$resource", function ($resource) {
	var url = '/api/booking/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Group_Type', ["$resource", function ($resource) {
	var url = '/api/group_type/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Group', ["$resource", function ($resource) {
	var url = '/api/group/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Kit', ["$resource", function ($resource) {
	var url = '/api/kit/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Note', ["$resource", function ($resource) {
	var url = '/api/note/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Product_Type', ["$resource", function ($resource) {
	var url = '/api/product_type/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Product', ["$resource", function ($resource) {
	var url = '/api/product/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Setting', ["$resource", function ($resource) {
	var url = '/api/setting/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('Unit', ["$resource", function ($resource) {
	var url = '/api/unit/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.resources').factory('User', ["$resource", function ($resource) {
	var url = '/api/user/:id';

	var defaults = {
		'id': '@id'
	};

	var methods = {
		update: {
			method: 'PUT'
		},
		getWithToken: {
			method: 'GET',
			url: '/api/auth',
			params: { with: 'tutors_groups.type' }
		}
	};

	return $resource(url, defaults, methods);
}]);
'use strict';

angular.module('app.services').factory('$csv', function () {
	function CSVToArray(strData, strDelimiter) {
		// Check to see if the delimiter is defined. If not,
		// then default to comma.
		strDelimiter = strDelimiter || ",";

		// Create a regular expression to parse the CSV values.
		var objPattern = new RegExp(
		// Delimiters.
		"(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +

		// Quoted fields.
		"(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +

		// Standard fields.
		"([^\"\\" + strDelimiter + "\\r\\n]*))", "gi");

		// Create an array to hold our data. Give the array
		// a default empty first row.
		var arrData = [[]];

		// Create an array to hold our individual pattern
		// matching groups.
		var arrMatches = null;

		// Keep looping over the regular expression matches
		// until we can no longer find a match.
		while (arrMatches = objPattern.exec(strData)) {

			// Get the delimiter that was found.
			var strMatchedDelimiter = arrMatches[1];

			// Check to see if the given delimiter has a length
			// (is not the start of string) and if it matches
			// field delimiter. If id does not, then we know
			// that this delimiter is a row delimiter.
			if (strMatchedDelimiter.length && strMatchedDelimiter !== strDelimiter) {

				// Since we have reached a new row of data,
				// add an empty row to our data array.
				arrData.push([]);
			}

			var strMatchedValue;

			// Now that we have our delimiter out of the way,
			// let's check to see which kind of value we
			// captured (quoted or unquoted).
			if (arrMatches[2]) {

				// We found a quoted value. When we capture
				// this value, unescape any double quotes.
				strMatchedValue = arrMatches[2].replace(new RegExp("\"\"", "g"), "\"");
			} else {

				// We found a non-quoted value.
				strMatchedValue = arrMatches[3];
			}

			// Now that we have our value string, let's add
			// it to the data array.
			arrData[arrData.length - 1].push(strMatchedValue);
		}

		// Return the parsed data.
		return arrData;
	}

	var service = {
		parse: function parse(text) {
			var arr = CSVToArray(text);

			var cols = arr.shift();

			var rows = arr.map(function (row) {
				var obj = {};

				cols.forEach(function (col, i) {
					obj[col] = row[i];
				});

				return obj;
			});

			return rows;
		}
	};

	return service;
});
'use strict';

angular.module('app.services').factory('$invalidate', ["$rootScope", "$auth", "$store", "$interval", "$load", function ($rootScope, $auth, $store, $interval, $load) {
	var service = {
		invalidated: []
	};

	service.add = function (type) {
		if (type instanceof Array) {
			_.forEach(type, function (t) {
				if (service.invalidated.indexOf(t) === -1) {
					service.invalidated.push(t);
				}
			});
		} else {
			service.invalidated.push(type);
		}
	};

	service.all = function () {
		if ($auth.getPayload() && $auth.getPayload().admin) {
			// if logged in as admin
			service.add(['user', 'users', 'groups', 'group_types', 'product_types', 'products', 'units', 'notes', 'booking_count', 'settings', 'kits']);
		} else {
			// if not logged in, or logged in as student
			service.add(['user', 'groups', 'group_types', 'products', 'units', 'settings', 'kits']);
		}
	};

	service.except = function (types) {
		service.all();

		types.forEach(function (type) {
			service.invalidated = _.reject(service.invalidated, function (t) {
				return t == type;
			});
		});
	};

	service.load = function () {
		var invalid = [];

		_.forEach(service.invalidated, function (i) {
			var thing;

			switch (i) {
				case 'user':
					thing = $load.user();
					$store.user = thing;
					invalid.push(thing.$promise);
					break;
				case 'users':
					thing = $load.users();
					$store.users = thing;
					invalid.push(thing.$promise);
					break;
				case 'units':
					thing = $load.units();
					$store.units = thing;
					invalid.push(thing.$promise);
					break;
				case 'groups':
					thing = $load.groups();
					$store.groups = thing;
					invalid.push(thing.$promise);
					break;
				case 'products':
					thing = $load.products();
					$store.products = thing;
					invalid.push(thing.$promise);
					break;
				case 'bookings':
					thing = $load.bookings();
					$store.bookings = thing;
					invalid.push(thing.$promise);
					break;
				case 'group_types':
					thing = $load.group_types();
					$store.group_types = thing;
					invalid.push(thing.$promise);
					break;
				case 'product_types':
					thing = $load.product_types();
					$store.product_types = thing;
					invalid.push(thing.$promise);
					break;
				case 'notes':
					thing = $load.notes();
					$store.notes = thing;
					invalid.push(thing.$promise);
					break;
				case 'booking_count':
					thing = $load.booking_count();
					thing.then(function (res) {
						return $store.notes = res.data.total;
					});
					invalid.push(thing);
					break;
				case 'settings':
					thing = $load.settings();
					$store.settings = thing;
					invalid.push(thing.$promise);
					break;
				case 'kits':
					thing = $load.kits();
					$store.kits = thing;
					invalid.push(thing.$promise);
					break;
			}
		});

		service.invalidated = [];

		return invalid;
	};

	service.add(['groups']);

	if ($auth.isAuthenticated()) {
		service.all();
	}

	// invalidate everything every 5 minutes
	$interval(function () {
		service.all();
	}, 5 * 60 * 1000);

	return service;
}]);
'use strict';

angular.module('app.services').factory('$load', ["$prepare", "$auth", "$http", "User", "Group", "Group_Type", "Product_Type", "Product", "Unit", "Booking", "Note", "Setting", "Kit", function ($prepare, $auth, $http, User, Group, Group_Type, Product_Type, Product, Unit, Booking, Note, Setting, Kit) {
	var service = {};
	var events = [];

	service.user = function () {
		var resource = User.getWithToken();

		resource.$promise.then($prepare.user).then(service.notify('user'));

		return resource;
	};

	service.users = function () {
		var resource = User.query({ 'with': 'tutors_groups.type' });

		resource.$promise.then($prepare.users).then(service.notify('users'));

		return resource;
	};

	service.group_types = function () {
		var resource = Group_Type.query({ with: 'products' });

		resource.$promise.then($prepare.group_types).then(service.notify('group_types'));

		return resource;
	};

	service.group_type = function (id) {
		var resource = Group_Type.get({ id: id, with: 'products' });

		resource.$promise.then($prepare.group_type).then(service.notify('group_type'));

		return resource;
	};

	service.group = function (id) {
		var query = { 'with': 'type' };

		if ($auth.getPayload() && $auth.getPayload().admin) {
			query.with = 'tutors';
		}

		query.id = id;

		var resource = Group.get(query);

		resource.$promise.then($prepare.group).then(service.notify('group'));

		return resource;
	};

	service.groups = function () {
		var query = { 'with': 'type' };

		if ($auth.getPayload() && $auth.getPayload().admin) {
			query.with = 'tutors';
		}

		var resource = Group.query(query);

		resource.$promise.then($prepare.groups).then(service.notify('groups'));

		return resource;
	};

	service.product_types = function () {
		var resource = Product_Type.query();

		resource.$promise.then($prepare.product_types).then(service.notify('product_types'));

		return resource;
	};

	service.products = function () {
		var resource = Product.query({ 'with': 'group_types|kits' });

		resource.$promise.then($prepare.products).then(service.notify('products'));

		return resource;
	};

	service.units = function () {
		var resource = Unit.query();

		resource.$promise.then($prepare.units).then(service.notify('units'));

		return resource;
	};

	service.unit = function (id, extra) {
		var resource = Unit.get({ id: id, 'with': extra.with ? extra.with : undefined });

		resource.$promise.then($prepare.unit).then(service.notify('unit'));

		return resource;
	};

	service.booking = function (id) {
		var resource = Booking.get({ id: id, 'with': 'products' });

		resource.$promise.then($prepare.booking).then(service.notify('bookings'));

		return resource;
	};

	service.bookings = function (limit, page) {
		var resource = Booking.query({ limit: limit, page: page, 'with': 'products' });

		resource.$promise.then($prepare.bookings).then(service.notify('bookings'));

		return resource;
	};

	service.notes = function () {
		var resource = Note.query({});

		resource.$promise.then($prepare.notes).then(service.notify('notes'));

		return resource;
	};

	service.booking_count = function () {
		var resource = $http.get('/api/booking/count');

		resource.then(service.notify('booking_count'));

		return resource;
	};

	service.settings = function () {
		var resource = Setting.query();

		resource.$promise.then(service.notify('settings'));

		return resource;
	};

	service.kits = function () {
		var resource = Kit.query();

		resource.$promise.then($prepare.kits).then(service.notify('kits'));

		return resource;
	};

	service.kit = function (id) {
		var resource = Kit.get({ id: id, 'with': 'products' });

		resource.$promise.then($prepare.kit).then(service.notify('kit'));

		return resource;
	};

	service.listen = function (event, callback) {
		events.push({
			name: event,
			callback: callback
		});
	};

	service.notify = function (eventName) {
		return function (resource) {
			return service.trigger(eventName, resource);
		};
	};

	service.trigger = function (eventName, data) {
		_.forEach(events, function (event) {
			if (event.name == eventName) {
				event.callback(data);
			}
		});
	};

	return service;
}]);
'use strict';

angular.module('app.services').factory('$merge', ["$store", function ($store) {
	var service = {};

	service.bookings = function (newBookings) {
		newBookings.forEach(function (booking) {
			if (!_.find($store.bookings, { id: booking.id })) {
				$store.bookings.push(booking);
			}
		});

		// sort by id
		$store.bookings.sort(function (a, b) {
			return a.id - b.id;
		});
	};

	return service;
}]);
'use strict';

angular.module('app.services').factory('$message', function () {
	var service = {};

	service.data = {};

	service.set = function (name, val) {
		return service.data[name] = val;
	};

	service.get = function (name) {
		return service.data[name];
	};

	service.flash = function (name) {
		var val = service.data[name];

		if (val) {
			delete service.data[name];
			return val;
		} else {
			return undefined;
		}
	};

	return service;
});
'use strict';

angular.module('app.services')

/**
*	This service's job is to take an object, or array of objects, and decorate them.
*	Some of that includes adding custom properties, which we prepend with an underscore.
*	eg.
*		user._age
*
*	But it also adds getters to the objects, so that we may link objects to one another.
*	eg.
*		We want to be able to use the following syntax to get the groups code: user.group.code
*		To do that we add a getter that searches all the groups for one that has the same id as the
*		user's group_id value, and returns that object.
*
*	Some getters have enumerable: true, which means any filters will be able to view the data of the
*	linked objects. For example, viewing all users, you may filter by group code, because the
*	user.group getter is enumerable.
*
*	Be careful with this, as you can end up with infinite loops if two objects reference eachother
*	with getters and both have enumerable: true
*
*	See: http://javascriptplayground.com/blog/2013/12/es5-getters-setters/
**/

.factory('$prepare', ["$store", function ($store) {
	var service = {};

	var enumerable = true;
	var configurable = true;

	service.users = function (users) {
		_.forEach(users, service.user);

		return users;
	};

	service.user = function (user) {
		if (user.admin === 2) user._role = 'Manager';
		if (user.admin === 1) user._role = 'Staff';
		if (user.admin === 0) user._role = 'Student';

		var duration = moment.duration(moment().diff(moment(user.dob)));

		user._age = duration.asYears().toFixed(0);

		if (user.dob) user.dob = new Date(user.dob);

		Object.defineProperty(user, 'group', {
			enumerable: enumerable,
			configurable: configurable,
			get: function get() {
				return _.find($store.groups, { id: user.group_id });
			}
		});

		Object.defineProperty(user, 'bookings', {
			get: function get() {
				return _.filter($store.bookings, { user_id: user.id });
			}
		});

		Object.defineProperty(user, 'notes', {
			get: function get() {
				return _.filter($store.notes, { user_id: user.id });
			}
		});

		return user;
	};

	service.group = function (group) {
		group._isTutor = function (id) {
			return !!_.find(group.tutors, { id: $store.user.id });
		};

		Object.defineProperty(group, 'type', {
			enumerable: enumerable,
			configurable: configurable,
			get: function get() {
				return _.find($store.group_types, { id: group.group_type_id });
			}
		});

		Object.defineProperty(group, 'users', {
			get: function get() {
				return _.filter($store.users, { group_id: group.id });
			}
		});

		return group;
	};

	service.groups = function (groups) {
		_.forEach(groups, service.group);

		return groups;
	};

	service.group_types = function (group_types) {
		_.forEach(group_types, function (type) {

			Object.defineProperty(type, 'groups', {
				get: function get() {
					return _.filter($store.groups, { group_type_id: type.id });
				}
			});
		});

		return group_types;
	};

	service.products = function (products) {
		_.forEach(products, function (product) {
			product._quantity = '';

			Object.defineProperty(product, 'type', {
				enumerable: enumerable,
				configurable: configurable,
				get: function get() {
					return _.find($store.product_types, { id: product.product_type_id });
				}
			});

			Object.defineProperty(product, 'units', {
				get: function get() {
					return _.filter($store.units, { product_id: product.id });
				}
			});
		});

		return products;
	};

	service.product_types = function (product_types) {
		_.forEach(product_types, function (type) {

			Object.defineProperty(type, 'products', {
				get: function get() {
					return _.filter($store.products, { product_type_id: type.id });
				}
			});
		});

		return product_types;
	};

	service.unit = function (unit) {
		if (unit.bookings) {
			unit.bookings = unit.bookings.map(function (b) {
				if (b.pivot.returned_at) b.pivot.returned_at = new Date(b.pivot.returned_at);
				return b;
			});
		}

		Object.defineProperty(unit, 'product', {
			enumerable: enumerable,
			configurable: configurable,
			get: function get() {
				return _.find($store.products, { id: unit.product_id });
			}
		});
	};

	service.units = function (units) {
		_.forEach(units, service.unit);

		return units;
	};

	service.booking = function (booking) {
		function transformDate(originalDate) {
			if (!originalDate) return undefined;
			if (originalDate instanceof Date) return originalDate;
			// Transform date string into what looks like an ISO string
			var iso = originalDate.replace(' ', 'T').concat('.000Z');

			// Transform that into a unix timestamp
			var unix = moment(originalDate).add(moment().utcOffset(), 'minutes').format('x');

			// Return a date object based on the timestamp
			return new Date(parseInt(unix));
		}

		if (booking.created_at) booking.created_at = transformDate(booking.created_at);
		if (booking.due_at) booking.due_at = transformDate(booking.due_at);
		if (booking.pickup_at) booking.pickup_at = transformDate(booking.pickup_at);
		if (booking.taken_at) booking.taken_at = transformDate(booking.taken_at);
		if (booking.closed_at) booking.closed_at = transformDate(booking.closed_at);
		if (booking.cancelled_at) booking.cancelled_at = transformDate(booking.cancelled_at);

		// low is top of table
		booking._priority = 0;

		if (!booking.taken_at) {
			booking._priority = 1;
			booking._status = 'Booked';
		}

		if (booking.taken_at && !booking.returned_at) {
			booking._priority = 2;
			booking._status = 'Issued';

			if (booking.due_at.valueOf() < new Date().valueOf()) {
				booking._overdue = true;
				booking._status = 'Overdue';
				booking._timeoverdue = moment().diff(booking.due_at, 'days');
			}
		}

		if (booking.closed_at) {
			booking._priority = 3;
			booking._status = 'Closed';
		}

		if (booking.cancelled_at) {
			booking._priority = 4;
			booking._status = 'Cancelled';
		}

		_.forEach(booking.products, function (product) {
			if (product.pivot.returned_at) product.pivot.returned_at = new Date(product.pivot.returned_at);
		});

		if (!booking.user) {
			Object.defineProperty(booking, 'user', {
				enumerable: enumerable,
				configurable: configurable,
				get: function get() {
					return _.find($store.users, { id: booking.user_id });
				}
			});
		}

		Object.defineProperty(booking, 'created_by', {
			get: function get() {
				return _.find($store.users, { id: booking.created_by_id });
			}
		});

		Object.defineProperty(booking, 'issued_by', {
			get: function get() {
				return _.find($store.users, { id: booking.issued_by_id });
			}
		});

		Object.defineProperty(booking, 'closed_by', {
			get: function get() {
				return _.find($store.users, { id: booking.closed_by_id });
			}
		});

		Object.defineProperty(booking, '_products', {
			get: function get() {
				var products = [];

				_.forEach(booking.products, function (product) {
					products.push(_.find($store.products, { id: product.id }));
				});

				return products;
			}
		});

		return booking;
	};

	service.bookings = function (bookings) {
		_.forEach(bookings, service.booking);

		return bookings;
	};

	service.notes = function (notes) {
		_.forEach(notes, function (note) {

			Object.defineProperty(note, 'history', {
				enumerable: enumerable,
				configurable: configurable,
				get: function get() {
					function getParent(a, n) {
						if (n.revision_of) {
							var parent = _.find($store.notes, { id: n.revision_of });

							a.push(parent);

							return getParent(a, parent);
						} else {
							return a;
						}
					}

					return _.sortBy(getParent([], note), function (note) {
						return -new Date(note.created_at).valueOf();
					});
				}
			});

			Object.defineProperty(note, 'user', {
				get: function get() {
					return _.find($store.users, { id: note.user_id });
				}
			});

			Object.defineProperty(note, 'writer', {
				get: function get() {
					return _.find($store.users, { id: note.writer_id });
				}
			});
		});

		return notes;
	};

	service.kit = function (kit) {

		Object.defineProperty(kit, '_products', {
			get: function get() {
				var products = [];

				_.forEach(kit.products, function (product) {
					products.push(_.find($store.products, { id: product.id }));
				});

				return products;
			}
		});

		return kit;
	};

	service.kits = function (kits) {
		_.forEach(kits, service.kit);

		return kits;
	};

	return service;
}]);
'use strict';

angular.module('app.services').factory('$pretend', ["$q", "$timeout", function ($q, $timeout) {
	var service = {
		wait: function wait(time) {
			return $q(function (resolve, reject) {
				$timeout(function () {
					resolve();
				}, time);
			});
		}
	};

	return service;
}]);
'use strict';

angular.module('app.services').factory('$queryString', ["$store", function ($store) {

	var service = function service(obj, begin) {
		var str = '';

		for (var prop in obj) {
			var val = obj[prop];

			if (val === false || val === '' || val === undefined || val === null) continue;
			if (prop === 'page' && val === 1) continue;

			if (val === true) val = 'true';
			if (val instanceof Date) val = val.valueOf();

			str += prop + '=' + val + '&';
		}

		return str.length ? (begin ? '?' : '') + str.substring(0, str.length - 1) : '';
	};

	return service;
}]);
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

angular.module('app.services').factory('$store', ["Booking", function (Booking) {
	var service = {
		user: {},
		kits: [],
		units: [],
		users: [],
		notes: [],
		groups: [],
		booking: {},
		settings: [],
		products: [],
		bookings: [],
		group_types: [],
		product_types: [],
		booking_count: 0
	};

	window.$store = service;

	service.setBooking = function (booking) {
		localStorage.booking = JSON.stringify(booking);
		service.booking = booking;
	};

	service.resetBooking = function () {
		localStorage.removeItem('booking');
		service.booking = {};
	};

	service.clear = function (things) {
		if (things instanceof Array) {
			_.forEach(things, function (thing) {
				service[thing] = {};
			});
		} else {
			service[things] = {};
		}
	};

	service.get = function (type, id) {
		var item = _.find(service[type], (typeof id === 'undefined' ? 'undefined' : _typeof(id)) == 'object' && id !== null ? id : { id: parseInt(id) });

		return item;
	};

	service.filter = function (type, expression) {
		var items = _.filter(service[type], (typeof expression === 'undefined' ? 'undefined' : _typeof(expression)) == 'object' && expression !== null ? expression : expression());

		return items;
	};

	if (localStorage.booking) {
		service.booking = JSON.parse(localStorage.booking);

		if (service.booking.pickup_at) {
			service.booking.pickup_at = new Date(service.booking.pickup_at);
		}

		if (service.booking.due_at) {
			service.booking.due_at = new Date(service.booking.due_at);
		}
	}

	return service;
}]);
'use strict';

angular.module('app.services').factory('$title', ["$rootScope", function ($rootScope) {
	var service = function service(title) {
		$rootScope.pageTitle = title + ' - Quartermaster';
	};

	return service;
}]);
'use strict';

angular.module('app.services').factory('$xlsx', function () {
	var service = {
		parse: function parse(binaryData) {
			var workbook = XLSX.read(binaryData, { type: 'binary', cellDates: true });
			var worksheet = workbook.Sheets[workbook.SheetNames[0]];
			return XLSX.utils.sheet_to_json(worksheet);
		}
	};

	return service;
});
"use strict";

//jscs:disable
angular.module("app.views").run(["$templateCache", function ($templateCache) {
  $templateCache.put("directives/alert/alert.html", "<div class=\"alert alert-{{ type }}\"><p layout=\"row\" align=\"center\" justify=\"between\"><span><i class=\"fa fa-fw fa-{{ icon }}\" ng-if=\"icon\"></i><span ng-bind-html=\"text\"></span></span><ng-transclude></ng-transclude></p></div>");
  $templateCache.put("directives/breadcrumbs/breadcrumbs.html", "<div class=\"breadcrumbs\"><ul layout=\"row\"><li class=\"default-crumb\"><i class=\"fa fa-fw fa-home\"></i></li><li ng-repeat=\"crumb in crumbs\" layout=\"row\"><a href=\"{{ fix(crumb.url) }}\"> {{ crumb.data.title }}</a></li><li><span>{{ state.current.data.title }}</span></li></ul></div>");
  $templateCache.put("directives/btn/btn.html", "<span><button type=\"button\" ng-show=\"!url\" class=\"btn btn-{{ type }} btn-sm\" ng-class=\"{\'btn-sm\': small,\'btn-large\': large,\'btn-circle\': circle,\'btn-icon\': icon && hasTranscluded}\" ng-disabled=\"disable\"><i class=\"fa fa-fw fa-{{ icon }}\" ng-class=\"{\'fa-spin\': spin}\" ng-show=\"icon\"></i><ng-transclude></ng-transclude></button><a href=\"{{ url }}\" ng-show=\"url\" class=\"btn btn-{{ type }} btn-sm\" ng-class=\"{\'btn-sm\': small,\'btn-large\': large,\'btn-circle\': circle,\'btn-icon\': icon && hasTranscluded}\" ng-disabled=\"disable\"><i class=\"fa fa-fw fa-{{ icon }}\" ng-class=\"{\'fa-spin\': spin}\" ng-show=\"icon\"></i><ng-transclude></ng-transclude></a></span>");
  $templateCache.put("directives/data-table/data-table.html", "<div class=\"data-table\"><div class=\"data-table-pagination\" layout=\"row\" justify=\"between\" align=\"center\"><label>Show <select ng-model=\"data.limit\" ng-options=\"value for value in limits\" class=\"data-table-limit-select\"></select> Entries</label><pagination page=\"data.page\" data=\"filtered\" limit=\"data.limit\"></pagination></div><table class=\"table table-hover\"><thead><tr><th class=\"button-col\" ng-if=\"data.buttons.length\"></th><th ng-click=\"sort()\" ng-repeat=\"col in cols track by $index\"><span class=\"sorter\" ng-class=\"{\'sorter-active\': col.sorter.dir}\" ng-click=\"col.sorter.switch()\" layout=\"row\" justify=\"between\">{{ col.name }} <span class=\"sorter-icon\"><i class=\"fa fa-sort\"      ng-if=\"!col.sorter.dir\"></i><i class=\"fa fa-sort-desc\" ng-if=\"col.sorter.dir == \'-\'\"></i><i class=\"fa fa-sort-asc\"  ng-if=\"col.sorter.dir == \'+\'\"></i></span></span></th></tr><tr><td ng-if=\"data.buttons.length\"></td><td ng-repeat=\"col in cols track by $index\"><span ng-if=\"col.filter.type === \'dropdown\'\"><dropdown ng-model=\"col.filter.value\" data=\"col.filter.items\" display=\"col.filter.display\" small nullable></dropdown></span><span ng-if=\"col.filter.type === \'dropdown2\'\"><dropdown2 ng-model=\"col.filter.value\" items=\"col.filter.items\" config=\"col.filter.config\"></dropdown2></span><span ng-if=\"col.filter.type === \'checkbox-dropdown\'\"><dropdown ng-model=\"col.filter.value\" data=\"col.filter.items\" display=\"col.filter.display\" small checkboxes></dropdown></span><span ng-if=\"col.filter.type === \'date\'\"><input type=\"date\" class=\"form-control form-control-sm\" ng-model=\"col.filter.value\" placeholder=\"Choose date...\"></span><span ng-if=\"col.filter.type === \'string\'\"><input type=\"text\" class=\"form-control form-control-sm\" ng-model=\"col.filter.value\" placeholder=\"Filter...\"></span></td></tr></thead><tr ng-repeat=\"item in filtered | page: data.page : data.limit as paged\"><td class=\"button-col\" ng-if=\"data.buttons.length\"><a href=\"/{{ data.slug }}/{{ item.id }}\" ng-if=\"buttons.view\"><i class=\"fa fa-fw fa-eye\"></i></a> <a href=\"/{{ data.slug }}/{{ item.id }}/edit\" ng-if=\"buttons.edit\"><i class=\"fa fa-fw fa-pencil\"></i></a> <button ng-click=\"delete()\" class=\"btn-link\" ng-if=\"buttons.delete\"><i class=\"fa fa-fw fa-trash-o\"></i></button> </td><td ng-repeat=\"col in cols\"><span class=\"data-table-indicator\" ng-if=\"col.indicator(item)\" ng-style=\"{\'background-color\': col.indicator(item)}\"></span> {{ item[col.name] }} </td></tr><tr ng-if=\"!paged.length\" class=\"no-records\"><td colspan=\"{{ cols.length + (data.buttons.length ? 1 : 0)}}\">No records to show</td></tr></table><div class=\"data-table-count\" layout=\"row\" justify=\"between\" align=\"start\"><div><p>Displaying <b>{{ filtered.indexOf(paged[0]) + 1 }}</b> - <b>{{ filtered.indexOf(paged[paged.length - 1]) + 1 }}</b> out of <b>{{ filtered.length }}</b> entries</p><p ng-if=\"filtered.length !== data.items.length\">(<b>{{ data.items.length - filtered.length }}</b> {{ data.items.length - filtered.length === 1 ? \'entry\' : \'entries\' }} hidden by filters)</p></div><pagination page=\"data.page\" data=\"filtered\" limit=\"data.limit\"></pagination></div></div>");
  $templateCache.put("directives/date-input/date-input.html", "<div class=\"date-input\"><input type=\"text\" ng-model=\"model\" ng-change=\"change()\" class=\"form-control\" uib-datepicker-popup=\"{{ dateOptions.format }}\" is-open=\"open\" datepicker-options=\"dateOptions\" ng-click=\"toggle()\"><i class=\"fa fa-calendar\"></i><button class=\"close\" ng-click=\"clear()\" ng-show=\"model\"><i class=\"fa fa-times-circle\"></i></button></div>");
  $templateCache.put("directives/dropdown/dropdown.html", "<div class=\"ns-dropdown\" ng-class=\"{\'ns-dropdown-small\': small, \'ns-dropdown-checkboxes\': checkboxes}\"><input type=\"text\" ng-model=\"filter_text\" placeholder=\"{{ ngModel ? text(ngModel) : placeholder }}\" class=\"form-control ns-dropdown-input\" ng-class=\"{\'ns-dropdown-input-has-icon\': icon, \'form-control-sm\': small}\"><div class=\"icons\"><i class=\"fa fa-{{ icon }} ns-dropdown-input-icon\" ng-show=\"icon\"></i><i class=\"fa fa-chevron-down ns-dropdown-arrow\"></i><i class=\"fa fa-times-circle ns-dropdown-close\" ng-if=\"nullable && ngModel\" ng-click=\"clear()\"></i></div><ul class=\"ns-dropdown-list ns-dropdown-hide\"><li ng-repeat=\"item in data | filter: hideFunc | orderBy: orderFunc | filter: primaryFilter | filter: filter_val as filtered\" class=\"ns-dropdown-item\" ng-class=\"{focused: ngModel ? (item == ngModel) : false}\" ng-click=\"select(item)\" data-id=\"{{ item.id }}\"><div layout=\"row\" align=\"center\"><input type=\"checkbox\" ng-model=\"item.checked\" ng-if=\"checkboxes\" class=\"ns-dropdown-checkbox\"><div><span class=\"ns-dropdown-item-field text\">{{ text(item) }}</span><span class=\"ns-dropdown-item-field subtext\" ng-show=\"display.subtext\">{{ subtext(item) }}</span></div></div></li></ul></div>");
  $templateCache.put("directives/dropdown2/dropdown2.html", "<div class=\"ns-dropdown2\" id=\"dropdown-{{ unique }}\"><input type=\"text\" class=\"form-control ns-dropdown2-input\" ng-model=\"input\" placeholder=\"{{ config.placeholder }}\" ng-class=\"{\'form-control-sm\': config.small}\"><div class=\"ns-dropdown2-controls\"><span ng-click=\"clear()\" ng-if=\"config.clearable && hasSelected()\" class=\"ns-dropdown2-icon ns-dropdown2-clear\"><i class=\"fa fa-times-circle\"></i></span><span class=\"ns-dropdown2-icon ns-dropdown2-chevron\"><i class=\"fa fa-chevron-down\"></i></span></div><div class=\"ns-dropdown2-list\" ng-if=\"isFocused()\"><ul><li ng-repeat=\"item in simpleItems | filter: input | orderBy: config.orders\" class=\"ns-dropdown2-item\"><div ng-click=\"choose(item)\" class=\"ns-dropdown2-item-clickable\"><input type=\"checkbox\" ng-checked=\"isSelected(item)\" ng-if=\"config.multiple\" class=\"ns-dropdown2-checkbox\">{{ item.text }}</div></li></ul></div></div>");
  $templateCache.put("directives/filter/filter.html", "<div class=\"filter\" ng-class=\"{ active: model.length, nomatch: model.length && !filtered.length }\"><input type=\"search\" ng-model=\"model\" class=\"form-control\" placeholder=\"filter...\"><i class=\"fa fa-search\"></i><div class=\"output\"><span ng-show=\"model.length && filtered.length\">{{ filtered.length }}</span><span ng-show=\"model.length && !filtered.length\">No matches</span></div></div>");
  $templateCache.put("directives/loader/loader.html", "<div class=\"loader\" ng-class=\"{\'loader-show\': loader}\"><div class=\"icon\"><img src=\"/images/LoadingWheel.svg\" alt=\"\" class=\"loader-img loader-spin\"></div></div>");
  $templateCache.put("directives/navLink/navLink.html", "<a href=\"{{ url }}\" layout=\"row\" align=\"center\" justify=\"between\"><div layout=\"row\" align=\"center\"><i class=\"fa {{ \'fa-\' + icon }}\" ng-show=\"icon\"></i><span ng-show=\"!!navLink\">{{ navLink }}</span></div><span ng-if=\"loading\" class=\"count\"><i class=\"fa fa-circle-o-notch fa-spin fa-fw\"></i></span><span ng-if=\"!loading\" class=\"count\">{{ number }}</span></a>");
  $templateCache.put("directives/pageHeader/pageHeader.html", "<header class=\"page-header\" layout=\"col\" align=\"stretch\"><breadcrumbs ng-show=\"showBreadcrumbs\"></breadcrumbs><div class=\"title-holder\" layout=\"row\" align=\"center\" justify=\"between\"><div layout=\"row\" align=\"center\"><h1>{{ text }}</h1><span class=\"count\" ng-if=\"count !== undefined\">{{ count }}</span></div></div><div class=\"page-header-transcluder\"><ng-transclude></ng-transclude></div></header>");
  $templateCache.put("directives/pager/pager.html", "<nav class=\"pagination-container\" layout=\"row\" justify=\"center\"><ul class=\"pagination\"><li class=\"page-item\" ng-class=\"{disabled: getCurrent() == 1}\"><span class=\"page-link\" ng-click=\"setCurrent(1)\"><i class=\"fa fa-step-backward\"></i></span></li><li class=\"page-item\" ng-class=\"{disabled: getCurrent() == 1}\"><span class=\"page-link\" ng-click=\"setCurrent(getCurrent() - 1)\"><i class=\"fa fa-chevron-left\"></i></span></li><li class=\"page-item\" ng-repeat=\"page in pages\" ng-class=\"{active: getCurrent() == page}\"><span class=\"page-link\" ng-click=\"setCurrent(page)\">{{ page }}</span></li><li class=\"page-item\" ng-class=\"{disabled: getCurrent() == totalpages}\"><span class=\"page-link\" ng-click=\"setCurrent(getCurrent() + 1)\"><i class=\"fa fa-chevron-right\"></i></span></li><li class=\"page-item\" ng-class=\"{disabled: getCurrent() == totalpages}\"><span class=\"page-link\" ng-click=\"setCurrent(totalpages)\"><i class=\"fa fa-step-forward\"></i></span></li></ul><select ng-model=\"current\" ng-change=\"updateOld()\" ng-options=\"(\'goto: \' + num) for num in allpages\" class=\"form-control page-picker\"></select></nav>");
  $templateCache.put("directives/pagination/pagination.html", "<nav class=\"data-table-pagination-container\" layout=\"row\" justify=\"end\"><ul class=\"data-table-pagination\"><li class=\"pagination-item\" ng-class=\"{disabled: page === first(totalPages).number}\"><span class=\"pagination-link\" ng-click=\"goto(first(totalPages))\">First</span></li><li class=\"pagination-item\" ng-repeat=\"p in pages\" ng-class=\"{active: p.number == page}\"><span class=\"pagination-link\" ng-click=\"goto(p)\">{{ p.number }}</span></li><li class=\"pagination-item\" ng-class=\"{disabled: page === last(totalPages).number}\"><span class=\"pagination-link\" ng-click=\"goto(last(totalPages))\">Last <span ng-show=\"totalPages.length\">({{ last(totalPages).number }})</span></span></li><li class=\"pagination-item\" ng-class=\"{disabled: page === first(totalPages).number}\"><span class=\"pagination-link\" ng-click=\"goto(prev(page))\"><i class=\"fa fa-fw fa-chevron-left\"></i></span></li><li class=\"pagination-item\" ng-class=\"{disabled: page === last(totalPages).number}\"><span class=\"pagination-link\" ng-click=\"goto(next(page))\"><i class=\"fa fa-fw fa-chevron-right\"></i></span></li></ul><!-- <select ng-model=\"current\" ng-change=\"updateOld()\" ng-options=\"(\'goto: \' + num) for num in allpages\" class=\"form-control page-picker\"></select> --></nav>");
  $templateCache.put("directives/sidebar/sidebar.html", "<div class=\"sidebar\" layout=\"col sm-row\"><div class=\"site-logo\" layout=\"row\" justify=\"center\" align=\"center\"><!-- <img src=\"/images/logo2.svg\" alt=\"\" class=\"logo\" height=\"50\"> --><div class=\"logo\"><img src=\"/images/yoobee_logo_light.svg\" alt=\"\"><!-- <span class=\"caption\">Equipment Booking</span> --></div><!-- <h1>Booking System</h1> --></div><nav layout=\"col sm-row\"><!-- guest --><ul layout=\"col sm-row\" ng-if=\"!auth.isAuthenticated()\"><li class=\"title\"></li><li nav-link=\"Login\" url=\"/login\"></li><li nav-link=\"Reset My Password\" url=\"/reset-password\"></li><!-- <li nav-link=\"Register\" url=\"/register\"></li> --></ul><!-- student --><ul layout=\"col sm-row\" ng-if=\"auth.isAuthenticated() && user.admin == 0\"><li class=\"title\">Bookings</li><li nav-link=\"My Bookings\" url=\"/\"></li><li nav-link=\"Make a Booking\" url=\"/book\"></li><li class=\"title\">Settings</li><li nav-link=\"My Profile\" url=\"home/edit-profile\"></li><li nav-link=\"Logout ({{ user.name }})\" url=\"/logout\"></li></ul><!-- staff --><ul layout=\"col sm-row\" ng-if=\"auth.isAuthenticated() && user.admin == 1\"><li class=\"title\">Bookings</li><li nav-link=\"My Bookings\" url=\"/\"></li><li nav-link=\"Make a Booking\" url=\"/book\"></li><li nav-link=\"All Bookings\" url=\"/bookings\"></li><li class=\"title\">Manage</li><li nav-link=\"Users\" url=\"/user\" number=\"{{ store.users.length }}\"></li><li class=\"title\">Settings</li><li nav-link=\"My Profile\" url=\"home/edit-profile\"></li><li nav-link=\"Logout ({{ user.name }})\" url=\"/logout\"></li></ul><!-- manager --><ul layout=\"col sm-row\" ng-if=\"auth.isAuthenticated() && user.admin == 2\"><li class=\"title\">Bookings</li><li nav-link=\"My Bookings\" url=\"/\"></li><li nav-link=\"Make a Booking\" url=\"/book\"></li><li nav-link=\"All Bookings\" url=\"/bookings\" number=\"{{ bookings_count }}\" loading=\"loading_bookings\"></li><li class=\"title\">Manage</li><li nav-link=\"Manage\" url=\"/manage\" show-only-sm></li><li nav-link=\"Users\" url=\"/user\" number=\"{{ store.users.length }}\" loading=\"!store.users.$resolved\" class=\"sm-hide\"></li><!-- <li nav-link=\"Class Types\" url=\"/class-type\" number=\"{{ store.group_types.length }}\" loading=\"!store.group_types.$resolved\" class=\"sm-hide\"></li> --><li nav-link=\"Classes\" url=\"/class\" number=\"{{ store.groups.length }}\" loading=\"!store.groups.$resolved\" class=\"sm-hide\"></li><!-- <li nav-link=\"Product Types\" url=\"/product-type\" number=\"{{ store.product_types.length }}\" loading=\"!store.product_types.$resolved\" class=\"sm-hide\"></li> --><li nav-link=\"Products\" url=\"/product\" number=\"{{ store.products.length }}\" loading=\"!store.products.$resolved\" class=\"sm-hide\"></li><li nav-link=\"Units\" url=\"/unit\" number=\"{{ store.units.length }}\" loading=\"!store.units.$resolved\" class=\"sm-hide\"></li><li nav-link=\"Kits\" url=\"/kit\" number=\"{{ store.kits.length }}\" loading=\"!store.kits.$resolved\" class=\"sm-hide\"></li><li class=\"title\">Settings</li><li nav-link=\"My Profile\" url=\"home/edit-profile\"></li><li nav-link=\"Site Settings\" url=\"site-settings\"></li><li nav-link=\"Logout ({{ user.name }})\" url=\"/logout\"></li></ul></nav></div>");
  $templateCache.put("pages/booking/confirm/confirm.html", "<page-header text=\"Confirm booking\"></page-header><div class=\"page-content\" ng-show=\"user.can_book\"><div class=\"info-table-wrapper\"><p>Does this look right?</p><p>If not, you can <a href=\"/book\">go back</a> and modify it first.</p><!-- <alert type=\"danger\" icon=\"exclamation-triangle\" ng-show=\"!overallAllowed\" text=\"Some of your chosen items are unavailable during your chosen time period\"></alert> --><table class=\"info-table\"><tr><td class=\"row-property\">User</td><td class=\"row-value\">{{ booking._user.name }}</td></tr><tr><td class=\"row-property\">Pick Up</td><td class=\"row-value\"><span ng-show=\"booking.pickup_at\">{{ booking.pickup_at | date }}</span><alert type=\"danger\" text=\"You don\'t have a pickup date\" icon=\"exclamation-circle\" ng-show=\"!booking.pickup_at\"></alert></td></tr><tr><td class=\"row-property\">Due</td><td class=\"row-value\"><span ng-show=\"booking.due_at\">{{ booking.due_at | date }}</span><alert type=\"danger\" text=\"You don\'t have a return date\" icon=\"exclamation-circle\" ng-show=\"!booking.due_at\"></alert></td></tr><tr><td class=\"row-property\">Items</td><td class=\"row-value\"><ul ng-show=\"booking.products.length\"><li ng-repeat=\"item in booking.products\" ng-class=\"{\'not-allowed\': !allowed(item.id)}\"><i class=\"fa fa-exclamation-triangle\" ng-show=\"!allowed(item.id)\"></i>&nbsp;{{ product(item.id).name }}<b ng-hide=\"product(item.id).limitless\"> x{{ item.quantity }}</b><p ng-show=\"!allowed(item.id)\">{{ reason(item.id) }}</p></li></ul><alert type=\"danger\" text=\"You aren\'t booking any products\" icon=\"exclamation-circle\" ng-show=\"!booking.products.length\"></alert></td></tr><tr><td class=\"row-property\">Terms</td><td class=\"row-value\"><div class=\"settings-terms\" ng-bind-html=\"terms.val\"></div><label class=\"settings-terms-check\"><input type=\"checkbox\" ng-model=\"readTerms\">I have read and agree to the <strong>terms and conditions</strong> above.</label></td></tr></table><btn class=\"bump-down\" type=\"success\" icon=\"check\" ng-click=\"confirm()\" disable=\"disableSubmit()\">Make Booking</btn></div></div><div class=\"page-content\" ng-show=\"!user.can_book\"><alert type=\"danger\" icon=\"exclamation-triangle\" text=\"You are not allowed to make bookings\"></alert><p>Reason: <strong>{{ user.can_book_reason }}</strong></p><p>Please talk to your tutor to resolve this issue.</p></div>");
  $templateCache.put("pages/booking/edit/edit.html", "<page-header text=\"Edit Booking\"><btn icon=\"check\" ng-click=\"save()\">Done</btn></page-header><div class=\"page-dates\"><div layout=\"row sm-col\" class=\"space-row\"><div ratio=\"1\"><label for=\"pickup_at\">Pickup date</label><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.pickup_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div><div ratio=\"1\"><label for=\"due_at\">Return date</label><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.due_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div></div></div><div class=\"page-content\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><div><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"product in products track by $index\"><dropdown ng-model=\"products[$index]\" data=\"allProducts\" display=\"{text: \'name\'}\" clone change=\"setupAllUnits\"></dropdown><div class=\"issue-subvalue\" ng-show=\"!product.limitless && booking._priority > 1\"><dropdown ng-model=\"product._unit\" data=\"product._units\" display=\"{text: \'unit_number\', primary: \'unit_number\'}\" order-by=\"unit_number\" placeholder=\"\" short></dropdown></div><div class=\"issue-subvalue\" ng-show=\"product.limitless\"></div><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn></div></div>");
  $templateCache.put("pages/booking/issue/issue.html", "<page-header text=\"Issue equipment\"><btn icon=\"check\" ng-click=\"issue()\">Done</btn></page-header><div class=\"page-dates\"><div layout=\"row sm-col\" class=\"space-row\"><div ratio=\"1\"><label for=\"pickup_at\">Pickup date</label><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.pickup_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div><div ratio=\"1\"><label for=\"due_at\">Return date</label><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.due_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div></div></div><div class=\"page-content\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><div><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"product in products track by $index\"><dropdown ng-model=\"products[$index]\" data=\"allProducts\" display=\"{text: \'name\'}\" clone change=\"setupAllUnits\"></dropdown><div class=\"issue-subvalue\"><dropdown ng-model=\"product._unit\" data=\"product._units\" display=\"{text: \'unit_number\', primary: \'unit_number\'}\" order-by=\"unit_number\" ng-show=\"!product.limitless\" placeholder=\"\" short></dropdown><input type=\"checkbox\" ng-model=\"product._taken\" ng-show=\"product.limitless\"></div><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn></div></div>");
  $templateCache.put("pages/booking/make/make.html", "<page-header text=\"Book equipment\"><div class=\"btn-group\" ng-show=\"user.can_book\"><button class=\"btn btn-primary btn-icon btn-sm\" ng-click=\"book()\"><i class=\"fa fa-book\"></i>Make Booking</button><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"reset()\"><i class=\"fa fa-undo\"></i>Reset</span></div></div></page-header><div class=\"page-content\" ng-show=\"user.can_book\"><div class=\"info-table-wrapper\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><div ng-show=\"user.admin\"><dropdown ng-model=\"booking._user\" data=\"users\" display=\"{text: \'name\', subtext: user_group}\"></dropdown></div><span ng-show=\"!user.admin\">{{ user.name }}</span></div></div><div class=\"tr\"><div class=\"td row-property center\">Pick Up</div><div class=\"td row-value\"><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.pickup_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div></div><div class=\"tr\"><div class=\"td row-property center\">Due At</div><div class=\"td row-value\"><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"booking.due_at\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div></div><div class=\"tr\"><div class=\"td row-property\">Items</div><div class=\"td row-value\"><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"product in selectedProducts\"><dropdown ng-model=\"selectedProducts[$index].product\" data=\"products\" hide=\"filterAdded\" display=\"{text: \'name\', subtext: product_type}\"></dropdown><input type=\"number\" class=\"form-control form-control-short\" min=\"1\" max=\"{{ product.product._max }}\" step=\"1\" ng-model=\"selectedProducts[$index].quantity\" ng-show=\"!product.product.limitless\" /><span class=\"product-quantity-na\" ng-show=\"product.product.limitless\">N/A</span><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></li></ul><div class=\"button-row\"><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn><btn type=\"info\" icon=\"plus\" ng-click=\"addKit()\">Add Kit</btn></div></div></div></div></div></div><div class=\"page-content\" ng-show=\"!user.can_book\"><alert type=\"danger\" icon=\"exclamation-triangle\" text=\"You are not allowed to make bookings\"></alert><p>Reason: <strong>{{ user.can_book_reason }}</strong></p><p>Please talk to your tutor to resolve this issue.</p></div>");
  $templateCache.put("pages/booking/manage/manage.html", "<page-header text=\"All Bookings\"></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/booking/return/return.html", "<page-header text=\"Return equipment\"><btn icon=\"check\" ng-click=\"close()\" disable=\"errors.length\">Done</btn></page-header><!-- <filter model=\"filter\" filtered=\"filtered\"></filter> --><div class=\"page-content\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><table class=\"table table-hover booking-table table-filtered\" ng-show=\"filtered.length\"><thead><tr><th class=\"table-col-checkbox\"></th><th class=\"booking-heading-product\">Product</th><th class=\"table-col-select-medium\">Unit</th><th class=\"table-col-medium-input\">Notes</th></tr></thead><tr ng-repeat=\"product in booking.products | filter: filter as filtered  track by $index\"><td><input type=\"checkbox\" ng-model=\"product.returned\" id=\"returned-{{ $index }}\" ng-disabled=\"product.locked\"></td><td><label for=\"returned-{{ $index }}\">{{ product.name }}</label></td><td><label for=\"returned-{{ $index }}\">{{ unit(product.pivot.unit_id).unit_number }}</label><span ng-show=\"product.limitless\">N/A</span></td><td><input type=\"text\" ng-model=\"product.pivot.notes\" class=\"form-control\"></td></tr></table></div>");
  $templateCache.put("pages/booking/success/success.html", "<page-header text=\"Booking made!\"></page-header><div class=\"page-content\" ratio=\"1\"><h2>Woo!</h2><p>You just made a booking!</p></div>");
  $templateCache.put("pages/booking/view/view.html", "<page-header text=\"Booking: {{ booking.pickup_at | date }}\" breadcrumbs=\"user.admin\"><div class=\"btn-group\" ng-show=\"booking._priority == 2 && user.admin\"><a href=\"booking/{{ booking.id }}/return\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-arrow-left\"></i>Return</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><a href=\"booking/{{ booking.id }}/edit\" class=\"dropdown-item btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div><div class=\"btn-group\" ng-show=\"booking._priority == 1 && user.admin\"><a href=\"booking/{{ booking.id }}/issue\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-arrow-right\"></i>Issue</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><a href=\"booking/{{ booking.id }}/edit\" class=\"dropdown-item btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div><btn icon=\"trash\" type=\"danger\" ng-click=\"delete()\" ng-show=\"(booking._status === \'Closed\' && user.admin) || (user.id == booking.user.id && booking._priority == 1 && !user.admin)\">Delete</btn></page-header><div class=\"page-content\" ratio=\"1\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><div class=\"info-table-wrapper\" ng-show=\"!errors.length\"><table class=\"info-table\"><tr><td class=\"row-property\">User</td><td class=\"row-value\"><a href=\"/user/{{ booking.user.id }}\" ng-if=\"user.admin\">{{ booking.user.name }}</a><span ng-if=\"!user.admin\">{{ booking.user.name }}</span></td></tr><tr class=\"print-hide\"><td class=\"row-property\">Status</td><td class=\"row-value\">{{ booking._status }}</td></tr><tr><td class=\"row-property\">Created</td><td class=\"row-value\">{{ booking.created_at | date }}</td></tr><tr class=\"print-date-row\" ng-if=\"booking.taken_at\"><td class=\"row-property\">Issued</td><td class=\"row-value\">{{ booking.taken_at | date }}</td></tr><tr ng-show=\"booking.issued_by\"><td class=\"row-property\">Issued By</td><td class=\"row-value\"><a href=\"/user/{{ booking.issued_by.id }}\" ng-if=\"user.admin\">{{ booking.issued_by.name }}</a><span ng-if=\"!user.admin\">{{ booking.issued_by.name }}</span></td></tr><tr class=\"print-date-row\" ng-if=\"booking.closed_at\"><td class=\"row-property\">Closed</td><td class=\"row-value\">{{ booking.closed_at | date }}</td></tr><tr ng-show=\"booking.closed_by\"><td class=\"row-property\">Closed By</td><td class=\"row-value\"><a href=\"/user/{{ booking.closed_by.id }}\" ng-if=\"user.admin\">{{ booking.closed_by.name }}</a><span ng-if=\"!user.admin\">{{ booking.closed_by.name }}</span></td></tr></table><div class=\"date-row\" layout=\"row sm-col md-col\"><div class=\"pickup\" ratio=\"1\" layout=\"row md-col sm-col\"><div layout=\"row\" justify=\"center\" align=\"center\" class=\"icon\"><i class=\"fa fa-upload\"></i></div><div layout=\"col\"><div layout=\"row\"><h2>Pickup</h2><p>{{ booking.pickup_at | date }}</p></div><div layout=\"row\"><h2>Issued</h2><p ng-show=\"booking.taken_at\">{{ booking.taken_at | date }}</p><p ng-show=\"!booking.taken_at\">-</p></div></div></div><div class=\"due\" ratio=\"1\" layout=\"row md-col sm-col\"><div layout=\"row\" justify=\"center\" align=\"center\" class=\"icon\"><i class=\"fa fa-download\"></i></div><div layout=\"col\"><div layout=\"row\"><h2>Due</h2><p>{{ booking.due_at | date }}</p></div><div layout=\"row\"><h2>Returned</h2><p ng-show=\"booking.closed_at\">{{ booking.closed_at | date }}</p><p ng-show=\"!booking.closed_at\">-</p></div></div></div></div></div><hr class=\"section-separator\"><h2>Products</h2><my-table data=\"dataTable\" ng-if=\"booking.$resolved\"></my-table></div>");
  $templateCache.put("pages/manage/manage/manage.html", "<page-header text=\"Manage Data\"></page-header><div class=\"page-content\"><p>Here you can manage aspects of the booking system.</p><div ng-show=\"user.admin === 2\" style=\"list-group\"><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/user\"><span><i class=\"fa fa-wrench push-right\"></i> Users</span><span class=\"label label-dark label-pill\">{{ store.users.length }}</span></a><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/class-type\"><span><i class=\"fa fa-wrench push-right\"></i> Class Types</span><span class=\"label label-dark label-pill\">{{ store.group_types.length }}</span></a><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/class\"><span><i class=\"fa fa-wrench push-right\"></i> Classes</span><span class=\"label label-dark label-pill\">{{ store.groups.length }}</span></a><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/product-type\"><span><i class=\"fa fa-wrench push-right\"></i> Product Types</span><span class=\"label label-dark label-pill\">{{ store.product_types.length }}</span></a><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/product\"><span><i class=\"fa fa-wrench push-right\"></i> Products</span><span class=\"label label-dark label-pill\">{{ store.products.length }}</span></a><a class=\"list-group-item list-group-item-action\" layout=\"row\" justify=\"between\" href=\"/unit\"><span><i class=\"fa fa-wrench push-right\"></i> Units</span><span class=\"label label-dark label-pill\">{{ store.units.length }}</span></a></div><div ng-show=\"user.admin === 1\" style=\"list-group\"><li class=\"list-group-item\"><a href=\"/user\">Manage Users</a></li></div></div>");
  $templateCache.put("pages/misc/home/home.html", "<page-header text=\"Welcome, {{ user.name }}\"></page-header><div class=\"page-content\"><hr><h2>Your booking history</h2><my-table data=\"dataTable\"></my-table></div><!-- <div class=\"page-content\"><div ng-show=\"bookings.length && !loading\"><h2>My Bookings</h2><a ng-repeat=\"booking in bookings | orderBy: \'-id\' | page: page : advFilter.props.limit : 30 as filtered\" href=\"booking/{{ booking.id }}\" class=\"booking filterable-row list-item\" layout=\"row sm-col\" align=\"center sm-stretch\"><div class=\"col-status status-{{ booking._status.toLowerCase() }}\" ratio=\"1\"><div class=\"title\">Status</div><div class=\"content\">{{ booking._status }}</div></div><div class=\"col-status2\" ratio=\"1\" ng-show=\"booking._priority == 1\"><div class=\"title\">Pickup</div><div class=\"content\" ng-show=\"diff(booking.pickup_at) > 1\"><span class=\"pip pip-warning\">in {{ diff(booking.pickup_at) }} days</span></div><div class=\"content\" ng-show=\"diff(booking.pickup_at) == 1\"><span class=\"pip pip-warning\">Tomorrow</span></div><div class=\"content\" ng-show=\"diff(booking.pickup_at) == 0\"><span class=\"pip pip-success\">Today</span></div><div class=\"content\" ng-show=\"diff(booking.pickup_at) == -1\"><span class=\"pip pip-danger\">Yesterday</span></div><div class=\"content\" ng-show=\"diff(booking.pickup_at) < -1\"><span class=\"pip pip-danger\">{{ diff(booking.pickup_at) * -1 }} days ago</span></div></div><div class=\"col-status2\" ratio=\"1\" ng-show=\"booking._priority == 2\"><div class=\"title\" ng-show=\"diff(booking.due_at) > -1\">Due</div><div class=\"title\" ng-show=\"diff(booking.due_at) < 0\">Overdue</div><div class=\"content\" ng-show=\"diff(booking.due_at) > 1\"><span class=\"pip pip-warning\">in {{ diff(booking.due_at) }} days</span></div><div class=\"content\" ng-show=\"diff(booking.due_at) == 1\"><span class=\"pip pip-warning\">Tomorrow</span></div><div class=\"content\" ng-show=\"diff(booking.due_at) == 0\"><span class=\"pip pip-success\">Today</span></div><div class=\"content\" ng-show=\"diff(booking.due_at) == -1\"><span class=\"pip pip-danger\">Yesterday</span></div><div class=\"content\" ng-show=\"diff(booking.due_at) < -1\"><span class=\"pip pip-danger\">by {{ diff(booking.due_at) * -1 }} days</span></div></div><div class=\"col-status2\" ratio=\"1\" ng-show=\"booking._priority == 3\"><div class=\"title\">Closed</div><div class=\"content\" ng-show=\"diff(booking.closed_at) == 0\">Today</div><div class=\"content\" ng-show=\"diff(booking.closed_at) == -1\">Yesterday</div><div class=\"content\" ng-show=\"diff(booking.closed_at) < -1\">{{ diff(booking.closed_at) * -1 }} days ago</div></div></a></div><div ng-show=\"!bookings.length && !loading\"><alert type=\"secondary\" icon=\"exclamation-triangle\" text=\"You have no bookings\"></alert></div><pager current=\"page\" limit=\"advFilter.props.limit\" data=\"bookings\" filtered=\"filtered\" filter=\"filter\" ng-show=\"!filter && bookings.length >= 30 && !loading\"></pager><div class=\"loading\" ng-show=\"loading\" layout=\"col\" justify=\"center\" align=\"center\"><img src=\"/images/LoadingWheel.svg\" alt=\"\" class=\"loader-img loader-spin\"></div></div> -->");
  $templateCache.put("pages/misc/login/login.html", "<page-header text=\"Login\" breadcrumbs=\"false\"></page-header><div class=\"page-content\"><alert type=\"danger\" icon=\"exclamation-circle\" text=\"{{ error }}\" ng-show=\"error\"></alert><form ng-submit=\"login()\"><div class=\"form-group\"><label for=\"email\">Email or Student ID Number</label><input type=\"text\" id=\"email\" ng-model=\"email\" class=\"form-control\"></div><div class=\"form-group\"><label for=\"password\">Password</label><input type=\"password\" id=\"password\" ng-model=\"password\" class=\"form-control\"></div><div class=\"form-group\" layout=\"row\" justify=\"between\" align=\"center\"><input type=\"submit\" class=\"btn btn-primary\" value=\"Login\"><a href=\"/reset_password\" class=\"push-left\">I forgot my password</a></div></form></div>");
  $templateCache.put("pages/misc/reset/reset.html", "<page-header text=\"Reset My Password\" breadcrumbs=\"false\"></page-header><div class=\"page-content\"><alert type=\"success\" icon=\"check\" ng-show=\"message\" text=\"{{ message }}\"></alert><form ng-submit=\"submit()\" ng-hide=\"message\"><div class=\"form-group\"><label for=\"email\">Account Email Address</label><input type=\"text\" id=\"email\" ng-model=\"email\" class=\"form-control\"></div><div class=\"form-group\"><input type=\"submit\" class=\"btn btn-primary\" value=\"Send me a reset link\"></div></form></div>");
  $templateCache.put("pages/misc/site-settings/site-settings.html", "<page-header text=\"Site Settings\"><!-- <btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn> --><button class=\"btn btn-icon btn-sm\" ng-class=\"{\'btn-primary\': !saved, \'btn-success\': saved}\" ng-click=\"save()\"><i class=\"fa fa-fw fa-floppy-o\" ng-show=\"!thinking && !saved\"></i><i class=\"fa fa-fw fa-circle-o-notch fa-spin\" ng-show=\"thinking\"></i><i class=\"fa fa-fw fa-check\" ng-show=\"!thinking && saved\"></i>Save</button></page-header><div class=\"page-content\"><div ng-repeat=\"setting in settings\" class=\"form-group\"><label>{{ setting.label }}</label><textarea ng-if=\"setting.field === \'textarea\'\" ng-model=\"setting.val\" class=\"form-control\"></textarea><textarea ng-if=\"setting.field === \'wysiwyg\'\" ui-tinymce=\"tinymceOptions\" ng-model=\"setting.val\" class=\"settings-wysiwyg\"></textarea><input type=\"text\" ng-if=\"setting.field === \'text\'\" ng-model=\"setting.val\" class=\"form-control\"><input type=\"number\" ng-if=\"setting.field === \'number\'\" ng-model=\"setting.val\" class=\"form-control\"></div></div>");
  $templateCache.put("pages/manage/class-types/allowed_products/allowed_products.html", "<page-header text=\"{{ group_type.code }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><table class=\"table info-table\"><tr><th>Product</th><th>Quantity</th><th>Days</th><th></th></tr><tr ng-repeat=\"product in selectedProducts\"><td class=\"table-col-widest\"><dropdown ng-model=\"selectedProducts[$index].product\" data=\"products\" hide=\"filterAdded\" display=\"{text: \'name\', subtext: product_type}\"></dropdown></td><td><input type=\"number\" class=\"form-control form-control-short\" min=\"1\" max=\"{{ max(product.product) }}\" step=\"1\" ng-model=\"selectedProducts[$index].quantity\" ng-show=\"!product.product.limitless\" /><span class=\"product-quantity-na\" ng-show=\"product.product.limitless\">N/A</span></td><td><input type=\"number\" class=\"form-control form-control-short\" min=\"1\" step=\"1\" ng-model=\"selectedProducts[$index].days_allowed\" /></td><td><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></td></tr></table><div class=\"button-row\"><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn><btn type=\"info\" icon=\"plus\" ng-click=\"addKit()\">Add Kit</btn></div></div>");
  $templateCache.put("pages/manage/class-types/manage/manage.html", "<page-header text=\"All Class Types\"><div class=\"button-row\"><btn icon=\"bars\" url=\"/class\" type=\"secondary\">Classes</btn><btn icon=\"plus\" url=\"/class-type/new\">New Class</btn></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/class-types/edit/edit.html", "<page-header text=\"{{ type.name }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Code</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"type.code\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"type.name\" class=\"form-control\"></div></div></div></form></div>");
  $templateCache.put("pages/manage/class-types/new/new.html", "<page-header text=\"New Class Type\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Code</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"code\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"name\" class=\"form-control\"></div></div></div></form></div>");
  $templateCache.put("pages/manage/class-types/view/view.html", "<page-header text=\"{{ type.code }} - {{ type.name }}\"><div class=\"btn-group\"><a href=\"/class-type/{{ type.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><a href=\"/class-type/{{ type.id }}/products\" class=\"dropdown-item btn-icon\"><i class=\"fa fa-camera\"></i>Allowed Products</a><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><div class=\"info-table-wrapper\"><table class=\"info-table\"><tr><td class=\"row-property\">Code</td><td class=\"row-value\">{{ type.code }}</td></tr><tr><td class=\"row-property\">Name</td><td class=\"row-value\">{{ type.name }}</td></tr></table></div><hr class=\"section-separator\"><h2>Classes</h2><my-table data=\"classesDataTable\"></my-table><hr class=\"section-separator\"><h2>Allowed Products</h2><my-table data=\"productsDataTable\"></my-table></div>");
  $templateCache.put("pages/manage/classes/edit/edit.html", "<page-header text=\"{{ group.code }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Code</div><div class=\"td row-value\"><input type=\"text\" id=\"code\" ng-model=\"group.code\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Type</div><div class=\"td row-value\"><dropdown ng-model=\"group.type\" data=\"types\" display=\"{text: \'name\', subtext: \'code\'}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property\">Tutors</div><div class=\"td row-value\"><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"tutor in tutors\"><dropdown ng-model=\"tutors[$index]\" data=\"staff\" display=\"{text: \'name\'}\"></dropdown><btn type=\"danger\" icon=\"times\" ng-click=\"removeTutor($index)\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addTutor()\">Add Tutor</btn></div></div></div></form><!-- <form ng-submit=\"save()\"><div class=\"form-group\"><label for=\"code\">Code</label><input type=\"text\" id=\"code\" ng-model=\"group.code\" class=\"form-control\"></div><div class=\"form-group\"><label for=\"type\">Type</label><dropdown ng-model=\"group.type\" data=\"types\" display=\"{text: \'name\', subtext: \'code\'}\" nullable></dropdown></div><section><div class=\"form-group\"><label>Tutors</label><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"tutor in tutors\"><dropdown ng-model=\"tutors[$index]\" data=\"staff\" display=\"{text: \'name\'}\" nullable></dropdown><btn type=\"danger\" icon=\"times\" ng-click=\"removeTutor($index)\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addTutor()\">Add Tutor</btn></div></section></form> --></div>");
  $templateCache.put("pages/manage/classes/manage/manage.html", "<page-header text=\"All Classes\"><div class=\"button-row\"><btn icon=\"bars\" url=\"/class-type\" type=\"secondary\">Class Types</btn><btn icon=\"plus\" url=\"/class/new\">New Class Type</btn></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/classes/new/new.html", "<page-header text=\"New Class\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Code</div><div class=\"td row-value\"><input type=\"text\" id=\"code\" ng-model=\"code\" class=\"form-control\" placeholder=\"eg. 16ADWE02B\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Type</div><div class=\"td row-value\"><dropdown ng-model=\"type\" data=\"types\" display=\"{text: \'name\', subtext: \'code\'}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property\">Tutors</div><div class=\"td row-value\"><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"tutor in tutors track by $index\"><dropdown ng-model=\"tutors[$index]\" data=\"staff\" display=\"{text: \'name\'}\" nullable></dropdown><btn type=\"danger\" icon=\"times\" ng-click=\"removeTutor($index)\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addTutor()\">Add Tutor</btn></div></div></div></form><!-- <form ng-submit=\"save()\"><div class=\"form-group\"><label for=\"code\">Code</label><input type=\"text\" id=\"code\" ng-model=\"code\" class=\"form-control\" placeholder=\"eg. 16ADWE02B\"></div><div class=\"form-group\"><label for=\"type\">Type</label><dropdown ng-model=\"type\" data=\"types\" display=\"{text: \'name\', subtext: \'code\'}\" nullable></dropdown></div><section><div class=\"form-group\"><label>Tutors</label><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"tutor in tutors track by $index\"><dropdown ng-model=\"tutors[$index]\" data=\"staff\" display=\"{text: \'name\'}\" nullable></dropdown><btn type=\"danger\" icon=\"times\" ng-click=\"removeTutor($index)\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addTutor()\">Add Tutor</btn></div></section></form> --></div>");
  $templateCache.put("pages/manage/classes/view/view.html", "<page-header text=\"{{ group.code }}\"><div class=\"btn-group\"><a href=\"/class/{{ group.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil fa-fw\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"retire()\" ng-show=\"group.active\"><i class=\"fa fa-user-times fa-fw\"></i>Retire Group</span><span class=\"dropdown-item btn-icon\" ng-click=\"reactivate()\" ng-show=\"!group.active\"><i class=\"fa fa-user-plus fa-fw\"></i>Reactivate Group</span><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash fa-fw\"></i>Delete</span></div></div></page-header><div class=\"page-content\" ng-show=\"!loading\"><div class=\"info-table-wrapper\"><table class=\"info-table\"><tr><td class=\"row-property\">Code</td><td class=\"row-value\">{{ group.code }}</td></tr><tr><td class=\"row-property\">Type</td><td class=\"row-value\"><a href=\"/class-type/{{ group.type.id }}\">{{ group.type.name }}</a></td></tr><tr><td class=\"row-property\">Status</td><td class=\"row-value\">{{ group.active ? \'Active\' : \'Inactive\' }}</td></tr><tr><td class=\"row-property\">Tutor<span ng-show=\"group.tutors.length > 1\">s</span></td><td class=\"row-value\"><ul ng-show=\"group.tutors.length > 1\"><li ng-repeat=\"user in group.tutors\"><a href=\"/user/{{ user.id }}\">{{ user.name }}</a></li></ul><a href=\"/user/{{ group.tutors[0].id }}\" ng-show=\"group.tutors.length == 1\">{{ group.tutors[0].name }}</a></td></tr></table></div><hr class=\"section-separator\"><h2>Students</h2><my-table data=\"dataTable\"></my-table></div><div ng-show=\"loading\"><div class=\"loading\" ng-show=\"loading\" layout=\"col\" justify=\"center\" align=\"center\"><img src=\"/images/LoadingWheel.svg\" alt=\"\" class=\"loader-img loader-spin\"></div></div>");
  $templateCache.put("pages/manage/kits/edit/edit.html", "<page-header text=\"Edit kit: {{ kit.name }}\" breadcrumbs=\"false\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" class=\"form-control\" ng-model=\"kit.name\"></div></div><div class=\"tr\"><div class=\"td row-property\">Items</div><div class=\"td row-value\"><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"product in selectedProducts\"><dropdown ng-model=\"selectedProducts[$index].product\" data=\"products\" hide=\"filterAdded\" display=\"{text: \'name\', subtext: product_type}\"></dropdown><input type=\"number\" class=\"form-control form-control-short\" min=\"1\" max=\"{{ max(product.product) }}\" step=\"1\" ng-model=\"selectedProducts[$index].quantity\" ng-show=\"!product.product.limitless\" /><span class=\"product-quantity-na\" ng-show=\"product.product.limitless\">N/A</span><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn></div></div></div></div>");
  $templateCache.put("pages/manage/kits/manage/manage.html", "<page-header text=\"All Kits\"><btn icon=\"plus\" url=\"/kit/new\">New Kit</btn></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/kits/new/new.html", "<page-header text=\"New Kit\" breadcrumbs=\"false\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" class=\"form-control\" ng-model=\"kit.name\"></div></div><div class=\"tr\"><div class=\"td row-property\">Items</div><div class=\"td row-value\"><ul class=\"no-bullets\"><li layout=\"row\" class=\"spaced-row pad-down\" ng-repeat=\"product in selectedProducts\"><dropdown ng-model=\"selectedProducts[$index].product\" data=\"products\" hide=\"filterAdded\" display=\"{text: \'name\', subtext: product_type}\"></dropdown><input type=\"number\" class=\"form-control form-control-short\" min=\"1\" max=\"{{ max(product.product) }}\" step=\"1\" ng-model=\"selectedProducts[$index].quantity\" ng-show=\"!product.product.limitless\" /><span class=\"product-quantity-na\" ng-show=\"product.product.limitless\">N/A</span><btn type=\"danger\" icon=\"times\" ng-click=\"removeProduct(product, $index)\" class=\"nudge-down\"></btn></li></ul><btn type=\"info\" icon=\"plus\" ng-click=\"addProduct()\">Add Item</btn></div></div></div></div>");
  $templateCache.put("pages/manage/kits/view/view.html", "<page-header text=\"{{ kit.name }}\"><div class=\"btn-group\"><a href=\"/kit/{{ kit.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><div class=\"info-table-wrapper\"><table class=\"info-table\"><tr><td class=\"row-property\">Name</td><td class=\"row-value\">{{ kit.name }}</td></tr><!-- <tr><td class=\"row-property\">Products ({{ kit.products.length }})</td><td class=\"row-value\"><ul><li ng-repeat=\"product in kit.products\"><a href=\"/product/{{ product.id }}\">{{ product.name }}</a> <strong>x{{ product.pivot.quantity }}</strong></li></ul></td></tr> --></table></div><hr class=\"section-separator\"><h2>Products</h2><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/product-types/edit/edit.html", "<page-header text=\"{{ type.name }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"type.name\" class=\"form-control\"></div></div></div></form></div>");
  $templateCache.put("pages/manage/product-types/manage/manage.html", "<page-header text=\"All Product Types\"><div class=\"button-row\"><btn icon=\"bars\" url=\"/product\" type=\"secondary\">Products</btn><btn icon=\"plus\" url=\"/product-type/new\">New Product Type</btn></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/product-types/new/new.html", "<page-header text=\"New Product Type\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"name\" class=\"form-control\"></div></div></div></form></div>");
  $templateCache.put("pages/manage/product-types/view/view.html", "<page-header text=\"{{ type.name }}\"><div class=\"btn-group\"><a href=\"/product-type/{{ type.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><table class=\"table info-table\"><tr><td class=\"row-property\">Name</td><td class=\"row-value\">{{ type.name }}</td></tr><tr><td class=\"row-property\">Products ({{ type.products.length }})<br><a href=\"/product/new?type={{ type.name }}\" class=\"btn push-down btn-primary btn-sm\"><i class=\"fa fa-plus\"></i></a></td><td class=\"row-value\"><ul><li ng-repeat=\"product in type.products\"><a href=\"/product/{{ product.id }}\">{{ product.name }}</a></li></ul><alert type=\"info\" text=\"No products with this type\" icon=\"exclamation-circle\" ng-if=\"!type.products.length\"><btn url=\"/product/new?type={{ type.name }}\" small icon=\"plus\">Create one</btn></alert></td></tr></table></div>");
  $templateCache.put("pages/manage/products/edit/edit.html", "<page-header text=\"{{ product.name }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"product.name\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Type</div><div class=\"td row-value\"><dropdown ng-model=\"type\" data=\"types\" display=\"{text: \'name\'}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property center\">Limitless</div><div class=\"td row-value\"><label><input type=\"checkbox\" ng-model=\"product.limitless\" ng-true-value=\"1\" ng-false-value=\"0\" class=\"push-left push-right\"> {{ product.limitless ? \'Yes\' : \'No\' }}</label></div></div></div></form></div>");
  $templateCache.put("pages/manage/products/manage/manage.html", "<page-header text=\"All Products\"><div class=\"button-row\"><btn icon=\"bars\" url=\"/product-type\" type=\"secondary\">Product Types</btn><btn icon=\"plus\" url=\"/product/new\">New Product</btn></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/products/new/new.html", "<page-header text=\"New Product\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"name\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Type</div><div class=\"td row-value\"><dropdown ng-model=\"type\" data=\"types\" display=\"{text: \'name\'}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property center\">Limitless</div><div class=\"td row-value\"><label><input type=\"checkbox\" ng-model=\"limitless\" ng-true-value=\"1\" ng-false-value=\"0\" class=\"push-left push-right\"> {{ limitless ? \'Yes\' : \'No\' }}</label></div></div></div></form></div>");
  $templateCache.put("pages/manage/products/view/view.html", "<page-header text=\"{{ product.name }}\"><div class=\"btn-group\"><a href=\"/product/{{ product.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><div class=\"info-table-wrapper\"><table class=\"info-table\"><tr><td class=\"row-property\">Name</td><td class=\"row-value\">{{ product.name }}</td></tr><tr><td class=\"row-property\">Type</td><td class=\"row-value\"><a href=\"/product-type/{{ product.type.id }}\">{{ product.type.name }}</a></td></tr><tr><td class=\"row-property\">Limitless</td><td class=\"row-value\">{{ product.limitless ? \'Yes\' : \'No\' }}</td></tr></table></div><hr class=\"section-separator\"><h2>Units</h2><my-table data=\"unitsDataTable\"></my-table><hr class=\"section-separator\"><h2>Class Types</h2><my-table data=\"classTypesDataTable\"></my-table><hr class=\"section-separator\"><h2>Kits</h2><my-table data=\"kitsDataTable\"></my-table></div>");
  $templateCache.put("pages/manage/units/edit/edit.html", "<page-header text=\"{{ unit.product.name }}: {{ unit.unit_number }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Unit No</div><div class=\"td row-value\"><input type=\"text\" id=\"unit_number\" ng-model=\"unit.unit_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Serial No</div><div class=\"td row-value\"><input type=\"text\" id=\"serial_number\" ng-model=\"unit.serial_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Asset No</div><div class=\"td row-value\"><input type=\"text\" id=\"asset_number\" ng-model=\"unit.asset_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Product</div><div class=\"td row-value\"><dropdown ng-model=\"product\" data=\"products\" display=\"{text: \'name\', subtext: product_type}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property\">Notes</div><div class=\"td row-value\"><textarea id=\"notes\" ng-model=\"unit.notes\" class=\"form-control\"></textarea></div></div></div></form></div>");
  $templateCache.put("pages/manage/units/export/export.html", "<page-header text=\"Export Units\"></page-header><div class=\"page-content\"><textarea ng-model=\"csv\" readonly cols=\"30\" rows=\"20\" class=\"form-control\"></textarea></div>");
  $templateCache.put("pages/manage/units/import/import.html", "<page-header text=\"Import Units\"><btn type=\"primary\" icon=\"cloud-upload\" ng-click=\"import()\" disable=\"!checkedUnits().length\">Import</btn></page-header><div class=\"page-content\"><div class=\"importer\" layout=\"col\"><div layout=\"row\" align=\"center\"><input type=\"file\" class=\"form-control\" fileread=\"file\" loader=\"loader\" ratio=\"1\"><button class=\"btn btn-info\" ng-click=\"reload()\"><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\': reloading}\"></i></button></div><div ng-show=\"errors.length\"><h2>{{ errors.length }} Issues</h2><p ng-repeat=\"error in errors\" ratio=\"1\" layout=\"row\" justify=\"between\" align=\"center\"><span>{{ error.message }}</span><a class=\"btn btn-primary btn-sm btn-icon\" href=\"/product/new?name={{ encode(error.product_name) }}\" target=\"_blank\"><i class=\"fa fa-plus\"></i>Create {{ error.product_name }}</a></p></div><div ng-show=\"skips.length\"><hr>{{ skips.length }} duplicate item{{ skips.length > 1 ? \'s\' : \'\' }} will be skipped</div></div><div ng-show=\"units.length\"><!-- <alert type=\"success\" icon=\"check\" text=\"Found {{ units.length }} Users\"></alert> --><filter model=\"filter\" filtered=\"filtered\"></filter><table class=\"table\"><tr><th></th><th>Product</th><th>Unit No</th><th>Serial No</th><th>Asset No</th></tr><tr ng-repeat=\"unit in units | filter: filter as filtered\" class=\"importer-row\" box-checker=\"unit._add\" ng-class=\"{\'no-import\': !unit._add}\"><td><input type=\"checkbox\" ng-model=\"unit._add\" class=\"no-click\"></td><td><span ng-show=\"unit._product\">{{ unit._product.name }}</span><span ng-show=\"unit._noproduct\" class=\"pip pip-danger\">{{ unit._noproduct }}</span></td><td>{{ unit.unit_number }}</td><td>{{ unit.serial_number }}</td><td>{{ unit.asset_number }}</td></tr></table></div></div>");
  $templateCache.put("pages/manage/units/manage/manage.html", "<page-header text=\"All Units\"><div class=\"btn-group\"><a href=\"/unit/new\" class=\"btn btn-primary btn-icon btn-sm\"><i class=\"fa fa-plus\"></i>New Unit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><a class=\"dropdown-item btn-icon\" href=\"/unit/import\"><i class=\"fa fa-cloud-upload\"></i>Import Units</a><a class=\"dropdown-item btn-icon\" href=\"/unit/export\"><i class=\"fa fa-cloud-download\"></i>Export Units</a></div></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/units/new/new.html", "<page-header text=\"New Unit\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Unit No</div><div class=\"td row-value\"><input type=\"text\" id=\"unit_number\" ng-model=\"unit_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Serial No</div><div class=\"td row-value\"><input type=\"text\" id=\"serial_number\" ng-model=\"serial_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Asset No</div><div class=\"td row-value\"><input type=\"text\" id=\"asset_number\" ng-model=\"asset_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Product</div><div class=\"td row-value\"><dropdown ng-model=\"product\" data=\"products\" display=\"{text: \'name\', subtext: product_type}\" nullable></dropdown></div></div><div class=\"tr\"><div class=\"td row-property\">Notes</div><div class=\"td row-value\"><textarea id=\"notes\" ng-model=\"notes\" class=\"form-control\"></textarea></div></div></div></form></div>");
  $templateCache.put("pages/manage/units/view/view.html", "<page-header text=\"{{ unit.product.name }}: {{ unit.unit_number }}\"><div class=\"btn-group\"><a href=\"/unit/{{ unit.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><div class=\"info-table-wrapper\"><table class=\"table info-table\"><tr><td class=\"row-property\">Unit No</td><td class=\"row-value\">{{ unit.unit_number ? unit.unit_number : \'-\' }}</td></tr><tr><td class=\"row-property\">Serial No</td><td class=\"row-value\">{{ unit.serial_number ? unit.serial_number : \'-\' }}</td></tr><tr><td class=\"row-property\">Asset No</td><td class=\"row-value\">{{ unit.asset_number ? unit.asset_number : \'-\' }}</td></tr><tr><td class=\"row-property\">Product</td><td class=\"row-value\"><a href=\"/product/{{ unit.product.id }}\">{{ unit.product.name }}</a></td></tr><tr><td class=\"row-property\">Notes</td><td class=\"row-value\">{{ unit.notes ? unit.notes : \'-\' }}</td></tr></table></div><hr class=\"section-separator\"><h2>Booking history</h2><my-table data=\"dataTable\" ng-if=\"unit.bookings\"></my-table></div>");
  $templateCache.put("pages/manage/users/edit/edit.html", "<page-header text=\"{{ !profileMode ? user.name : \'Edit Profile\' }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\" ng-show=\"!profileMode || you.admin == 2\"><input type=\"text\" id=\"name\" ng-model=\"user.name\" class=\"form-control\"></div><div class=\"td row-value\" ng-show=\"profileMode\">{{ user.name }}</div></div><div class=\"tr\" ng-show=\"!profileMode\"><div class=\"td row-property center\">ID Number</div><div class=\"td row-value\" ng-show=\"!profileMode || you.admin == 2\"><input type=\"text\" id=\"id_number\" ng-model=\"user.id_number\" class=\"form-control\"></div><div class=\"td row-value\" ng-show=\"profileMode\">{{ user.id_number }}</div></div><div class=\"tr\"><div class=\"td row-property center\">Email Address</div><div class=\"td row-value\" ng-show=\"!profileMode || you.admin == 2\"><input type=\"email\" id=\"email\" ng-model=\"user.email\" class=\"form-control\"></div><div class=\"td row-value\" ng-show=\"profileMode\">{{ user.email }}</div></div><div class=\"tr\"><div class=\"td row-property center\">Phone Number</div><div class=\"td row-value\" ng-show=\"!profileMode || you.admin == 2\"><input type=\"text\" id=\"phone\" ng-model=\"user.phone\" class=\"form-control\"></div><div class=\"td row-value\" ng-show=\"profileMode\">{{ user.phone }}</div></div><div class=\"tr\"><div class=\"td row-property center\">DOB</div><div class=\"td row-value\" ng-show=\"!profileMode || you.admin == 2\"><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"user.dob\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div><div class=\"td row-value\" ng-show=\"profileMode\">{{ user.dob | date }}</div></div><div class=\"tr\"><div class=\"td row-property center\">Password</div><div class=\"td row-value\"><input type=\"password\" id=\"password\" ng-model=\"password\" class=\"form-control\" placeholder=\"\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Password repeat</div><div class=\"td row-value\"><input type=\"password\" id=\"confirm_password\" ng-model=\"confirm_password\" class=\"form-control\" placeholder=\"\"></div></div><div class=\"tr\" ng-hide=\"profileMode\"><div class=\"td row-property center\">Status</div><div class=\"td row-value\"><label><input type=\"checkbox\" ng-model=\"user.active\" ng-true-value=\"1\" ng-false-value=\"0\" class=\"push-right\"> {{ user.active ? \'Active\' : \'Inactive\' }}</label></div></div><div class=\"tr\" ng-hide=\"profileMode || you.id == user.id || you.admin !== 2\"><div class=\"td row-property center\">Role</div><div class=\"td row-value\"><dropdown ng-model=\"role\" data=\"roles\" display=\"{text: \'text\'}\"></dropdown></div></div><div class=\"tr\" ng-show=\"role.level === 0 && !profileMode\"><div class=\"td row-property center\">Class</div><div class=\"td row-value\"><dropdown ng-model=\"group\" data=\"groups\" display=\"{text: \'code\'}\"></dropdown></div></div><div class=\"tr\" ng-show=\"role.level === 0 && !profileMode\"><div class=\"td row-property center\">Can Book</div><div class=\"td row-value\"><label><input type=\"checkbox\" ng-model=\"user.can_book\" ng-change=\"syncUser()\" ng-true-value=\"1\" class=\"push-right\"> {{ user.can_book ? \'Yes\' : \'No\' }}</label></div></div><div class=\"tr\" ng-show=\"role.level === 0 && !profileMode && !user.can_book\"><div class=\"td row-property center\">Reason</div><div class=\"td row-value\"><input type=\"text\" ng-model=\"user.can_book_reason\" class=\"form-control\" id=\"can_book_reason\"></div></div></div></form><!-- <form ng-submit=\"save()\"><div layout=\"row sm-col\" class=\"spaced-row\"><div class=\"form-group\" ratio=\"1\"><label for=\"name\">Name</label><input type=\"text\" id=\"name\" ng-model=\"user.name\" class=\"form-control\"></div><div class=\"form-group\" ratio=\"1\"><label for=\"email\">Email Address</label><input type=\"email\" id=\"email\" ng-model=\"user.email\" class=\"form-control\"></div></div><div layout=\"row sm-col\" class=\"spaced-row\"><div class=\"form-group\" ratio=\"1\"><label for=\"phone\">Phone Number</label><input type=\"text\" id=\"phone\" ng-model=\"user.phone\" class=\"form-control\"></div><div class=\"form-group\" ratio=\"1\"><label for=\"dob\">DOB</label><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"user.dob\" class=\"form-control\"></div></div></div><div layout=\"row sm-col\" class=\"spaced-row\"><div class=\"form-group\" ratio=\"1\"><label for=\"password\">Password</label><input type=\"password\" id=\"password\" ng-model=\"password\" class=\"form-control\" placeholder=\"\"></div><div class=\"form-group\" ratio=\"1\"><label for=\"confirm_password\">Confirm Password</label><input type=\"password\" id=\"confirm_password\" ng-model=\"confirm_password\" class=\"form-control\" placeholder=\"\"></div></div><div layout=\"row sm-col\" class=\"spaced-row\" ng-hide=\"profileMode || you.id == user.id\"><div class=\"form-group\" ratio=\"1\"><label for=\"group\">Role</label><dropdown ng-model=\"role\" data=\"roles\" display=\"{text: \'text\'}\"></dropdown></div></div><div layout=\"row sm-col\" class=\"spaced-row\" ng-show=\"role.level === 0 && !profileMode\"><div class=\"form-group\" ratio=\"1\"><label for=\"id_number\">Student ID Number</label><input type=\"text\" id=\"id_number\" ng-model=\"user.id_number\" class=\"form-control\"></div><div class=\"form-group\" ratio=\"1\"><label for=\"group\">Class</label><dropdown ng-model=\"group\" data=\"groups\" display=\"{text: \'code\'}\" nullable></dropdown></div></div><div layout=\"row sm-row\" class=\"spaced-row\" ng-show=\"role.level === 0 && !profileMode\"><div class=\"form-group\"><label for=\"can_book\">Can Book</label><div class=\"push-left\"><label><input type=\"checkbox\" ng-model=\"user.can_book\" ng-change=\"syncUser()\" ng-true-value=\"1\" class=\"push-right\"> {{ user.can_book ? \'Yes\' : \'No\' }}</label></div></div><div class=\"form-group\" ng-show=\"!user.can_book\" ratio=\"1\"><label for=\"can_book_reason\">Reason</label><input type=\"text\" ng-model=\"user.can_book_reason\" class=\"form-control\" id=\"can_book_reason\"></div></div></form> --></div>");
  $templateCache.put("pages/manage/users/edit_note/edit_note.html", "<page-header text=\"Edit Note\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><label for=\"note-content\">Note Content</label><input type=\"text\" id=\"note-content\" class=\"form form-control\" ng-model=\"note.content\"></form></div>");
  $templateCache.put("pages/manage/users/export/export.html", "<page-header text=\"Export Users\"></page-header><div class=\"page-content\"><textarea ng-model=\"csv\" readonly cols=\"30\" rows=\"20\" class=\"form-control\"></textarea></div>");
  $templateCache.put("pages/manage/users/import/import.html", "<page-header text=\"Import Users\"><btn type=\"primary\" icon=\"cloud-upload\" ng-click=\"import()\" disable=\"!checkedUsers().length\">Import</btn></page-header><div class=\"page-content\"><div class=\"importer\" layout=\"col\"><div layout=\"row\" align=\"center\"><input type=\"file\" class=\"form-control\" fileread=\"file\" loader=\"loader\" ratio=\"1\"><button class=\"btn btn-info\" ng-click=\"reload()\"><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\': reloading}\"></i></button></div><div ng-show=\"errors.length\"><h2>{{ errors.length }} Issues</h2><p ng-repeat=\"error in errors\" ratio=\"1\" layout=\"row\" justify=\"between\" align=\"center\"><span>{{ error.message }}</span><a class=\"btn btn-primary btn-sm btn-icon\" href=\"/class/new?code={{ error.group_code }}\" target=\"_blank\"><i class=\"fa fa-plus\"></i>Create {{ error.group_code }}</a></p></div></div><div ng-show=\"users.length\"><!-- <alert type=\"success\" icon=\"check\" text=\"Found {{ users.length }} Users\"></alert> --><filter model=\"filter\" filtered=\"filtered\"></filter><table class=\"table\"><tr><th></th><th>Name</th><th>Email</th><th>ID Number</th><th>Phone</th><th>DOB</th><!-- <th>Password</th> --><th>Class</th></tr><tr ng-repeat=\"user in users | filter: filter as filtered\" class=\"importer-row\" box-checker=\"user._add\" ng-class=\"{\'no-import\': !user._add}\"><td><input type=\"checkbox\" ng-model=\"user._add\" class=\"no-click\"></td><td>{{ user.name }}</td><td>{{ user.email }}</td><td>{{ user.id_number }}</td><td>{{ user.phone }}</td><td>{{ user.dob | date }}</td><!-- <td>{{ user.password }}</td> --><td><span ng-show=\"user._group\">{{ user._group.code }}</span><span ng-show=\"user._nogroup\" class=\"pip pip-danger\">{{ user._nogroup }}</span></td></tr></table></div></div>");
  $templateCache.put("pages/manage/users/manage/manage.html", "<page-header text=\"All Users\"><div class=\"btn-group\"><a href=\"/user/new\" class=\"btn btn-primary btn-icon btn-sm\"><i class=\"fa fa-plus\"></i>New User</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><a class=\"dropdown-item btn-icon\" href=\"/user/import\"><i class=\"fa fa-cloud-upload\"></i>Import Users</a><a class=\"dropdown-item btn-icon\" href=\"/user/export\"><i class=\"fa fa-cloud-download\"></i>Export Users</a></div></div></page-header><div class=\"page-content\"><my-table data=\"dataTable\"></my-table></div>");
  $templateCache.put("pages/manage/users/new/new.html", "<page-header text=\"New User\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><div class=\"alert alert-danger\" ng-show=\"errors.length\"><p ng-repeat=\"error in errors\">Error: <b>{{ error.message }}</b></p></div><form ng-submit=\"save()\"><div class=\"fake-table info-table\"><div class=\"tr\"><div class=\"td row-property center\">Name</div><div class=\"td row-value\"><input type=\"text\" id=\"name\" ng-model=\"name\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">ID Number</div><div class=\"td row-value\"><input type=\"text\" id=\"id_number\" ng-model=\"id_number\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Email Address</div><div class=\"td row-value\"><input type=\"email\" id=\"email\" ng-model=\"email\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Phone Number</div><div class=\"td row-value\"><input type=\"text\" id=\"phone\" ng-model=\"phone\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">DOB</div><div class=\"td row-value\"><div class=\"input-group\"><span class=\"input-group-addon\" id=\"basic-addon1\"><i class=\"fa fa-calendar\"></i></span><input type=\"date\" ng-model=\"dob\" class=\"form-control\" placeholder=\"yyyy-mm-dd\"></div></div></div><div class=\"tr\"><div class=\"td row-property center\">Password</div><div class=\"td row-value\"><input type=\"password\" id=\"password\" ng-model=\"password\" class=\"form-control\"></div></div><div class=\"tr\"><div class=\"td row-property center\">Password repeat</div><div class=\"td row-value\"><input type=\"password\" id=\"confirm_password\" ng-model=\"confirm_password\" class=\"form-control\"></div></div><div class=\"tr\" ng-show=\"user.admin === 2\"><div class=\"td row-property center\">Role</div><div class=\"td row-value\"><dropdown ng-model=\"role\" data=\"roles\" display=\"{text: \'text\'}\"></dropdown></div></div><div class=\"tr\" ng-show=\"role.level === 0\"><div class=\"td row-property center\">Class</div><div class=\"td row-value\"><dropdown ng-model=\"group\" data=\"groups\" display=\"{text: \'code\'}\"></dropdown></div></div></div></form></div>");
  $templateCache.put("pages/manage/users/new_note/new_note.html", "<page-header text=\"New Note for {{ user.name }}\"><btn type=\"primary\" icon=\"floppy-o\" ng-click=\"save()\">Save</btn></page-header><div class=\"page-content\"><form ng-submit=\"save()\"><label for=\"note-content\">Note Content</label><input type=\"text\" id=\"note-content\" class=\"form form-control\" ng-model=\"content\"></form></div>");
  $templateCache.put("pages/manage/users/view/view.html", "<page-header text=\"User: {{ user.name }}\"><div class=\"btn-group\" ng-show=\"you.admin === 2 || user.admin === 0 || user.id === you.id\"><a href=\"/user/{{ user.id }}/edit\" class=\"btn btn-primary btn-icon btn-sm\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"delete()\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><div class=\"info-table-wrapper\"><table class=\"info-table\"><tr><td class=\"row-property\">Name</td><td class=\"row-value\">{{ user.name }}</td></tr><tr><td class=\"row-property\">Phone</td><td class=\"row-value\">{{ user.phone ? user.phone : \'-\' }}</td></tr><tr><td class=\"row-property\">Email</td><td class=\"row-value\"><a href=\"mailto:{{ user.email }}\" ng-show=\"user.email\">{{ user.email }}</a><span ng-if=\"!user.email\">-</span></td></tr><tr><td class=\"row-property\">ID Number</td><td class=\"row-value\">{{ user.id_number }}</td></tr><tr ng-show=\"user.dob\"><td class=\"row-property\">DOB</td><td class=\"row-value\">{{ user.dob | date }} ({{ user._age }} years old)</td></tr><tr ng-show=\"user.dob\"><td class=\"row-property\">Status</td><td class=\"row-value\">{{ user.active ? \'Active\' : \'Inactive\' }}</td></tr><tr><td class=\"row-property\">Role</td><td class=\"row-value\">{{ user._role }}</td></tr><tr ng-show=\"!user.admin\" ng-class=\"{\'bg-danger\': !user.can_book}\"><td class=\"row-property\">Can book</td><td class=\"row-value\">{{ user.can_book ? \'Yes\' : \'No\' }}<div class=\"bump-down\" ng-show=\"!user.can_book\"><p>Reason: <strong>{{ user.can_book_reason }}</strong></p></div></td></tr><tr><td class=\"row-property\">Bookings</td><td class=\"row-value\"><a href=\"bookings?user={{ user.id }}&closed=true\">View all bookings by this user</a></td></tr><tr ng-show=\"!user.admin\"><td class=\"row-property\">Class</td><td class=\"row-value\"><a href=\"/class/{{ user.group.id }}\">{{ user.group.code }}</a></td></tr><tr ng-show=\"user.admin && user.tutors_groups.length\"><td class=\"row-property\">Tutor of</td><td class=\"row-value\"><ul><li ng-repeat=\"group in user.tutors_groups\"><a href=\"/class/{{ group.id }}\">{{ group.code }}</a></li></ul></td></tr><tr ng-show=\"!user.admin\"><td class=\"row-property\">Notes<br><a href=\"/user/{{ user.id }}/note/new\" class=\"btn push-down btn-primary btn-sm\"><i class=\"fa fa-plus\"></i></a></td><td class=\"row-value\"><div class=\"list-group\"><div class=\"list-group-item user-note\" ng-repeat=\"note in user.notes\" layout=\"row\" ng-hide=\"note.is_old\"><div class=\"user-note-content\" ratio=\"1\"><a href=\"/user/{{ user.id }}/note/{{ note.id }}\">{{ note.content }}</a></div><div class=\"user-note-controls\"><btn icon=\"pencil\" type=\"info\" small url=\"/user/{{ user.id }}/note/{{ note.id }}/edit\">Edit</btn> <btn icon=\"trash\" type=\"danger\" small ng-click=\"deleteNote(note)\"></btn></div></div></div></td></tr></table></div></div>");
  $templateCache.put("pages/manage/users/view_note/view_note.html", "<page-header text=\"View Note\"><div class=\"btn-group\"><a href=\"/user/{{ user.id }}/note/{{ note.id }}/edit\" class=\"btn btn-primary btn-sm btn-icon\"><i class=\"fa fa-pencil\"></i>Edit</a><button type=\"button\" class=\"btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><span class=\"sr-only\">Toggle Dropdown</span></button><div class=\"dropdown-menu dropdown-menu-right\"><span class=\"dropdown-item btn-icon\" ng-click=\"deleteNote(note)\"><i class=\"fa fa-trash\"></i>Delete</span></div></div></page-header><div class=\"page-content\"><h2 class=\"center-text\">{{ note.content }}</h2><section><table class=\"table info-table\"><tr><td class=\"row-property\">Written by</td><td class=\"row-value\"><a href=\"/user/{{ note.writer.id }}\">{{ note.writer.name }}</a></td></tr><tr><td class=\"row-property\">Date</td><td class=\"row-value\">{{ dateify(note.created_at) | date: \'d/M/yy h:mm a\' }}</td></tr></table></section><div ng-show=\"note.history.length\"><h3>Note History</h3><ul class=\"list-group\"><li ng-repeat=\"version in note.history\" class=\"list-group-item\"><div layout=\"row\" justify=\"between\"><span>{{ version.content }}</span><span><a href=\"/user/{{ version.writer.id }}\">{{ version.writer.name }}</a> ({{ dateify(version.created_at) | date: \'d/M/yy h:mm a\' }})</span></div></li></ul></div></div>");
}]);